"use strict";

// keyboard
var keyboardButtons = document.querySelectorAll(".keyboard__btn");

// TYPABLE AREA
var typableChars = document.querySelectorAll(".typable__char");

// lang btn
var langBtns = document.querySelectorAll(".lang-ctrls__btn");
var languageButtons = document.querySelector(".lang-ctrls__body");

// START TYPING btn
var beginButton = document.getElementById("beginBtn");

// TEXT AREA
// textArea wrapper
var wrpTextArea = document.querySelector(".inputText");
// show textArea
var btnShow = document.getElementById("btnTextArea");
// insert from textArea
var btnTextAdding = document.getElementById("btnAddText");
// radio
var radioLang = document.querySelectorAll('input[name="langSelect"]');
// textarea
var elemTextArea = document.querySelector("textarea");

// clock
var clock = document.querySelector(".clock__time");
// timer
var speed = document.querySelector(".results__value--speed");
var errors = document.querySelector(".results__value--errors");

// modal
var modal = document.querySelector(".modal");
var modalP = document.querySelector(".modal > p");

// user
var user = document.getElementById("inputUsersNameID");
var sbmt = document.getElementById("submitUsersNameID");
// user-list
// const userList = document.querySelectorAll(".user-list");
// let userListScores;
var userListParent = document.querySelector(".user-list");
// const userNames = document.querySelectorAll(".user-list__name");
var sectionUser = document.querySelector(".user");
var userId = void 0; // document.getElementById('id-User');
'use strict';

var appData = {
    currentSetting: {
        lang: 'en',
        setKeyboard: function setKeyboard() {
            return appData.language[appData.currentSetting.lang];
        },
        setTypingText: function setTypingText() {
            return appData.typingText[appData.currentSetting.lang];
        }
    },
    currentType: {
        type: -1,
        text: '',
        errors: 0,
        position: 0
    },
    interval: 0,
    language: {
        en: "qwertyuiop[]asdfghjkl;'zxcvbnm,./ ",
        ua: "йцукенгшщзхїфівапролджєячсмитьбю. ",
        ru: "йцукенгшщзхъфывапролджэячсмитьбю. "
    },
    records: {},
    results: [],
    timerCurrent: 0,
    typingText: {
        en: "the quick brown fox jumps over the lazy dog.",
        ua: "хвацький юшковар філіп щодня готує сім'ї вечерю з жаб.",
        ru: "съешь же ещё этих мягких французских булок, да выпей чаю."
    },
    // currentUser
    userCurrent: {
        id: 'id-User',
        restID: -1,
        name: 'User',
        score: 0
    },
    // savedUser
    userSaved: false,
    url: 'http://fecore.net.ua/rest/'
};
"use strict";

init();
// addListeners();
"use strict";

var timer = {
    startTime: 0,
    stopTime: 0,
    interval: 0,

    start: function start() {
        this.startTime = new Date();
        this.interval = setInterval(function () {
            var tmp = new Date();
            var delta = tmp.getTime() - timer.startTime.getTime();
            var sec = dateFormat(delta);
            showTimer(sec);
        }, 40);
    },

    stop: function stop() {
        this.stopTime = new Date();
        var delta = this.stopTime.getTime() - this.startTime.getTime();
        var sec = dateFormat(delta);
        showTimer(sec);
        clearInterval(this.interval);
        this.startTime = 0;
        this.stopTime = 0;
        this.interval = 0;
        return sec;
    }
};
'use strict';

function addListeners() {

    activeBtn();

    /* ======================== смена языка раскладки ====================== */
    languageButtons.addEventListener('click', resetKeyboardLetters);

    /* ============= добавить пользователя ====================== */
    sbmt.addEventListener('click', addUser);

    /* ============= показать скрытое окно для ввода текста ============= */
    btnShow.addEventListener('click', showTextArea);

    /* ============= добавить новый текст ============= */
    btnTextAdding.addEventListener('click', setNewPhrase);

    /* ========================= начинаем сравнение кликов клавиш с текстом ========== */
    beginButton.addEventListener('click', beginType);
}
'use strict';

function addUser(e) {
    // TODO сделать проверку на уникальность имени
    e.preventDefault();
    var name = user.value;
    sectionUser.style.display = 'none';
    userId = document.getElementById('id-User');
    userId.textContent = name;
    paintUserScore();
    appData.userCurrent.name = name;
    appData.userCurrent.score = userId.nextSibling.textContent;
    createREST(appData.userCurrent);
    save('thisUser', appData.userCurrent);
}
'use strict';

function beginType() {
    // beginType () flag = true  -> stopType() flag = false
    // appData.currentType.typing = true;

    // beginType() add listener -> stopType() remove listener
    document.addEventListener('keypress', checkKey);

    //
    removeListeners();

    // beginType () appData.timer.start -> stopType() appData.timer.stop
    // appData.timer.start = window.performance.now();
    // console.log(appData.timer.start);


    // array из строки для проверки - pop()
    var tmp = appData.currentSetting.setTypingText();
    appData.currentType.text = tmp.split('').reverse();
    // console.log(appData.currentType.text);

    //timer
    timer.start();

    // Errors - показать текущее состояние
    errors.textContent = appData.currentType.errors;

    modal.style.transform = 'translateY(-110%)';
    modalP.textContent = '';
}
'use strict';

function checkKey(event) {
    // event.key

    var length = appData.currentType.text.length;

    if (length > 0) {
        // console.log(appData.currentType.text);
        if (appData.currentType.text[length - 1] === event.key) {
            nextTypeSymbol();
            appData.currentType.text.pop();
            var last = appData.currentType.text.length;
            // console.log(tmp);
            lightButton(appData.currentType.text[last - 1]);
            if (length === 1) {
                stopType();
            }
        } else {
            ++appData.currentType.errors;
            errorTypeSymbol();
        }

        return true;
    }
    return 'Error: appData.currentType.text.length = ' + appData.currentType.text.length;
}
'use strict';

function removeListeners() {
    // console.log('remove listeners');

    /* ======================== смена языка раскладки ====================== */
    languageButtons.removeEventListener('click', resetKeyboardLetters);

    /* ============= добавить пользователя ====================== */
    sbmt.removeEventListener('click', addUser);

    /* ============= показать скрытое окно для ввода текста ============= */
    btnShow.removeEventListener('click', showTextArea);

    /* ============= добавить новый текст ============= */
    btnTextAdding.removeEventListener('click', setNewPhrase);

    /* ========================= начинаем сравнение кликов клавиш с текстом ========== */
    beginButton.removeEventListener('click', beginType);

    desactiveBtn();
}
'use strict';

function resetKeyboardLetters(e) {
    appData.currentSetting.lang = e.target.textContent;
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);
    Array.from(langBtns, function (elem) {
        return elem.classList.remove('lang-ctrls__btn--active');
    });
    e.target.classList.add('lang-ctrls__btn--active');
    fillTypableChars(typableChars, appData.currentSetting.setTypingText());
    hideTypeElements(typableChars, appData.currentSetting.setTypingText());
    // clear();

    var text = appData.currentSetting.setTypingText();
    // подсветка текущей буквы
    // console.log(text);
    lightButton(text[0]);
}
'use strict';

function stopType() {

    document.removeEventListener('keypress', checkKey);

    addListeners();

    //timer
    var resultTime = timer.stop().split(':');
    appData.timerCurrent = +resultTime[0] + +resultTime[1] / 1000;

    // Расчитать Score  и показать на странице,
    var currentTextLength = appData.typingText[appData.currentSetting.lang].length;
    var currentScore = getScore(appData.timerCurrent, currentTextLength);
    speed.textContent = currentScore;

    // сравнить Score, перезаписать результаты
    if (appData.currentType.errors === 0) {
        // userScore.score = scr > userScore.score ? scr : userScore.score;
        if (currentScore > appData.userCurrent.score) {
            appData.userCurrent.score = currentScore;
            // console.log(`${currentScore}`);
            getRESTIdUser();
            save('thisUser', appData.userCurrent);
            updateREST(appData.userCurrent);
        }
        userId.nextSibling.textContent = appData.userCurrent.score;
        // пройтись по списку проверить score , переместить
        updateListByScore();
    }

    // Модальное окно при завершении
    modal.style.transform = 'translateY(-25%)';
    modalP.textContent = 'Fin';

    // Показать Errors на странице и обнулить
    appData.currentType.errors = 0;

    restoreView();
}
"use strict";

// key =  'thisUser'

function load(key) {
    return JSON.parse(localStorage.getItem(key));
}
"use strict";

// key =  'thisUser'

function remove(key) {
    localStorage.removeItem(key);
    // localStorage.removeItem('thisUser');
}
"use strict";

// key =  'thisUser'

function save(key, obj) {
    localStorage.setItem(key, JSON.stringify(obj));
}
"use strict";

function Result() {
    this.time = 0;
    this.err = 0;
    this.errorsLetters = [];
}
'use strict';

function User() {
    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'User';
    var speed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

    this.name = name;
    this.speed = speed;
    this.result = new Result();
}
"use strict";

function UserResult(name, score) {
    this.name = name;
    this.score = score;
}
"use strict";

function addtoResultsArray(array, object) {
    for (var key in object) {
        if (object.hasOwnProperty(key)) {
            array.push(new UserResult(key, object[key]));
        }
    }
}
"use strict";

function arrayToObj(arr) {
    var obj = {};
    arr.map(function (elem) {
        return obj[elem["name"]] = elem["score"];
    });
    return obj;
}
'use strict';

function dateFormat(digits) {
    var msc = void 0,
        sec = void 0,
        min = void 0,
        hour = void 0;

    msc = Math.floor(digits % 1000);
    if (msc > 99) {
        msc = ':' + msc;
    } else if (msc > 9) {
        msc = ':' + '0' + msc;
    } else {
        msc = ':' + '00' + msc;
    }

    sec = Math.floor(digits / 1000 % 60);
    if (sec > 9) {
        sec = sec;
    } else {
        sec = '0' + sec;
    }

    return sec + msc;
}
"use strict";

function filterTopResult(arr) {
    var tmp = [];
    if (arr.length > 10) {
        tmp = arr.slice(0, 9);
        return tmp;
    }
    return arr;
}
"use strict";

function getScore(sec, textLength) {
    return Math.round(60 * textLength / sec);
}
'use strict';

function init() {
    addListeners();
    showModal();
    /*
    задаем дефолтные значения выбору языка
     */
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);

    /*
      добавляет текст в  typable
    */
    fillTypableChars(typableChars, appData.currentSetting.setTypingText());
    hideTypeElements(typableChars, appData.currentSetting.setTypingText());
    console.log('1 ' + appData.userCurrent.score);
    appData.userSaved = load('thisUser');

    if (appData.userSaved) {
        appData.userCurrent.id = appData.userSaved.id;
        appData.userCurrent.name = appData.userSaved.name;
        appData.userCurrent.score = appData.userSaved.score;
        console.log('2 ' + appData.userCurrent.score);
        appData.userCurrent.restID = appData.userSaved.restID;
        appData.records[appData.userCurrent.name] = appData.userCurrent.score;
        sbmt.removeEventListener('click', addUser);
        hideElem(sectionUser);
        appData.userCurrent.id = 'id-' + appData.userCurrent.name;
        getRESTIdUser();
    } else {
        console.log('3 ' + appData.userCurrent.score);
        appData.records[appData.userCurrent.name] = appData.userCurrent.score;
    }

    readREST();
}
"use strict";

function setIdRESTByName(arr) {
    arr.map(function (elem) {
        if (elem.name === appData.userCurrent.name) {
            appData.userCurrent.restID = elem["id"];
        }
    });
}
"use strict";

function sortByScore(arr) {
    arr.sort(function (a, b) {
        return b.score - a.score;
    });
}
'use strict';

function createREST(obj) {
    var createUrl = appData.url + '?action=1&name=' + obj.name + '&score=' + obj.score;
    console.log(createUrl);

    fetch(createUrl, {
        metod: "post",
        mode: 'cors',
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    }).catch(function (error) {
        console.log('CreateREST: Fetch Error :-S', error);
    });
}
"use strict";

function deleteREST(obj) {
    var updateUrl = appData.url + "?action=3$id=" + obj.restID;

    // http://fecore.net.ua/rest/?action=3&id=63

    fetch(updateUrl, {
        metod: "post"
    }).catch(function (error) {
        console.log('deleteREST: Fetch Error : ', error);
    });
}
'use strict';

function getRESTIdUser() {
    fetch(appData.url, {
        metod: "get",
        mode: 'cors',
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    }).then(function (response) {
        var json = response.json();
        if (response.status >= 200 && response.status < 300) {
            return json;
        } else {
            return error;
        }
    }).then(function (json) {
        setIdRESTByName(json);
    }).catch(function (error) {
        console.log('Fetch Error :-S', error);
    });
}
'use strict';

function readREST() {
    fetch(appData.url, {
        metod: "get",
        mode: 'cors',
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    }).then(function (response) {
        var json = response.json();
        if (response.status >= 200 && response.status < 300) {
            return json;
        } else {
            return error;
        }
    }).then(function (json) {
        var tmp = arrayToObj(json);
        // если список больше 10, то сохраним userRec
        var userRec = appData.records;
        appData.records = Object.assign(appData.records, tmp);

        addtoResultsArray(appData.results, appData.records);
        sortByScore(appData.results);
        // получить список максимум из 10-ти топ результатов
        filterTopResult(appData.results);

        appData.records = Object.assign(appData.records, userRec);
        sortByScore(appData.results);

        appData.results.map(function (elem) {
            return addToScoreList(elem.name, elem.score, userListParent);
        });
        // console.log('appData.userCurrent.id = ', appData.userCurrent.id);
        userId = document.getElementById(appData.userCurrent.id);
        paintUserScore();
    }).catch(function (error) {
        console.log('Fetch Error :-S', error);
    });
}
'use strict';

function updateREST(obj) {

    var updateUrl = appData.url + '?action=2&id=' + obj.restID + '&name=' + obj.name + '&score=' + obj.score;
    console.log(updateUrl);
    fetch(updateUrl, {
        metod: "post",
        mode: 'cors',
        headers: {
            'Access-Control-Allow-Origin': '*'
        }

    }).catch(function (error) {
        console.log('updateREST: Fetch Error : ', error);
    });
}
"use strict";

function activeBtn() {
    languageButtons.style.opacity = 1;
    sbmt.style.opacity = 1;
    btnShow.style.opacity = 1;
    btnTextAdding.style.opacity = 1;
    beginButton.style.opacity = 1;
}
'use strict';

// addToList
function addToScoreList(name, score, parent) {
    var li = document.createElement('li');
    var pName = document.createElement('p');
    var pScore = document.createElement('p');
    li.className = 'user-list__item';
    pName.className = 'user-list__name';
    pName.id = 'id-' + name;
    pScore.className = 'user-list__score';
    pName.textContent = name;
    pScore.textContent = score;
    li.appendChild(pName);
    li.appendChild(pScore);
    parent.appendChild(li);
}
"use strict";

function desactiveBtn() {
    languageButtons.style.opacity = 0.5;
    sbmt.style.opacity = 0.5;
    btnShow.style.opacity = 0.5;
    btnTextAdding.style.opacity = 0.5;
    beginButton.style.opacity = 0.5;
}
'use strict';

function errorTypeSymbol() {
    typableChars[appData.currentType.position].classList.add('typable__char--error');
    errors.textContent = appData.currentType.errors;
}
"use strict";

/*
 Заполнение TYPABLE AREA текстом для набора
 */
function fillTypableChars(arr, str) {
  Array.from(arr, function (elem, i) {
    return elem.textContent = str[i];
  });
}
'use strict';

/*
   hideTextArea, modal
 */
function hideElem(elem) {
    elem.style.display = 'none';
}
'use strict';

/*
  Скрытие элементов без текста
 */

function hideTypeElements(arr, str) {
    Array.from(arr, function (elem, i) {
        if (i < str.length) {
            elem.classList.remove('hide');
            elem.textContent = str[i];
        } else {
            elem.classList.add('hide');
        }
        elem.classListadd = 'hide';
    });
}
'use strict';

/*
   Подсветка клавиатуры: клавиша, которую следует нажать.
 */

function lightButton(charText) {
    Array.from(keyboardButtons, function (elem) {
        if (elem.classList.contains('keyboard__btn--active')) {
            elem.classList.remove('keyboard__btn--active');
        }
        if (elem.textContent === charText) {
            elem.classList.add('keyboard__btn--active');
        }
    });
}
'use strict';

function nextTypeSymbol() {
    // область набора
    // console.log(typableChars[appData.currentType.position].textContent);
    typableChars[appData.currentType.position].classList.add('typable__char--success');
    typableChars[appData.currentType.position].classList.remove('typable__char--current');
    typableChars[++appData.currentType.position].classList.add('typable__char--current');

    // область клавиатуры

}
"use strict";

function paintUserScore() {
    userId.style.color = "#03A9F4";
}
'use strict';

function restoreView() {
    appData.currentType.position = 0;
    // remove old
    Array.from(keyboardButtons, function (elem) {
        elem.classList.remove('keyboard__btn--active');
        // elem.classList.remove('keyboard__btn--active');
    });
    Array.from(typableChars, function (elem) {
        elem.classList.remove('typable__char--error');
        elem.classList.remove('typable__char--success');
        elem.classList.remove('typable__char--current');
    });
    // default
    typableChars[0].classList.add('typable__char--current');
    // let currentChar = appData.typingText[appData.currentSetting.lang];
    // console.log()
    lightButton(appData.typingText[appData.currentSetting.lang][0]);
    // keyboardButtons[0].classList.add('keyboard__btn--active');
}
"use strict";

/*
  Запонение клавиатруы символами выбранного языка
 */

function setKeyboardLetters(language, buttons) {
    for (var i = 0, limit = buttons.length; i < limit; i = i + 1) {
        buttons[i].textContent = language[i];
    }
}
'use strict';

function setNewPhrase(event) {
    event.preventDefault();
    console.log('setNewPhrase');
    var lng = 'en';

    Array.from(radioLang, function (elem) {
        if (elem.checked) {
            lng = elem.value;
        }
    });

    appData.typingText[lng] = elemTextArea.value.toLocaleLowerCase();

    hideElem(wrpTextArea);

    /* ================== меняем раскладку клавиатуры ================*/
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);
    /* =================  добавляет текст в  typable ====================== */
    var text = appData.currentSetting.setTypingText();

    // подсветка текущей буквы
    lightButton(text[0]);

    fillTypableChars(typableChars, text);
    hideTypeElements(typableChars, text);
}
'use strict';

function showElem(elem) {
    elem.style.display = 'block';
}
'use strict';

function showModal() {
    modal.style.transform = 'translateY(-25%)';
    modalP.textContent = 'PRESS BUTTON "START TYPE"';
}
"use strict";

function showTextArea() {
  showElem(wrpTextArea);
}
"use strict";

function showTimer(txt) {
    clock.textContent = txt;
}
'use strict';

function updateListByScore() {
    // console.log('updateListByScore');
    var userListScores = document.querySelectorAll('.user-list__item');
    var tmp = Array.from(userListScores);
    tmp.sort(function (a, b) {
        return b.lastChild.textContent - a.lastChild.textContent;
    });
    Array.from(userListScores, function (elem) {
        return elem.remove();
    });
    tmp.map(function (elem) {
        return userListParent.appendChild(elem);
    });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbEVsZW1lbnRzLmpzIiwiYXBwRGF0YS5qcyIsImFwcFN0YXJ0LmpzIiwidGltZXIuanMiLCJDT05UUk9MTEVSL2FkZExpc3RlbmVycy5qcyIsIkNPTlRST0xMRVIvYWRkVXNlci5qcyIsIkNPTlRST0xMRVIvYmVnaW5UeXBlLmpzIiwiQ09OVFJPTExFUi9jaGVja0tleS5qcyIsIkNPTlRST0xMRVIvcmVtb3ZlTGlzdGVuZXJzLmpzIiwiQ09OVFJPTExFUi9yZXNldEtleWJvYXJkTGV0dGVycy5qcyIsIkNPTlRST0xMRVIvc3RvcFR5cGUuanMiLCJMT0NBTFNUT1JBR0UvbG9hZC5qcyIsIkxPQ0FMU1RPUkFHRS9yZW1vdmUuanMiLCJMT0NBTFNUT1JBR0Uvc2F2ZS5qcyIsIk1PREVML1Jlc3VsdC5qcyIsIk1PREVML1VzZXIuanMiLCJNT0RFTC9Vc2VyUmVzdWx0LmpzIiwiTU9ERUwvYWRkdG9SZXN1bHRzQXJyYXkuanMiLCJNT0RFTC9hcnJheVRvT2JqLmpzIiwiTU9ERUwvZGF0ZUZvcm1hdC5qcyIsIk1PREVML2ZpbHRlclRvcFJlc3VsdC5qcyIsIk1PREVML2dldFNjb3JlLmpzIiwiTU9ERUwvaW5pdC5qcyIsIk1PREVML3NldElkUkVTVEJ5TmFtZS5qcyIsIk1PREVML3NvcnRCeVNjb3JlLmpzIiwiUkVTVC9jcmVhdGVSRVNULmpzIiwiUkVTVC9kZWxldGVSRVNULmpzIiwiUkVTVC9nZXRSRVNUSWRVc2VyLmpzIiwiUkVTVC9yZWFkUkVTVC5qcyIsIlJFU1QvdXBkYXRlUkVTVC5qcyIsIlZJRVcvYWN0aXZlQnRuLmpzIiwiVklFVy9hZGRUb1Njb3JlTGlzdC5qcyIsIlZJRVcvZGVzYWN0aXZlQnRuLmpzIiwiVklFVy9lcnJvclR5cGVTeW1ib2wuanMiLCJWSUVXL2ZpbGxUeXBhYmxlQ2hhcnMuanMiLCJWSUVXL2hpZGVFbGVtLmpzIiwiVklFVy9oaWRlVHlwZUVsZW1lbnRzLmpzIiwiVklFVy9saWdodG5CdXR0b24uanMiLCJWSUVXL25leHRUeXBlU3ltYm9sLmpzIiwiVklFVy9wYWludFVzZXJTY29yZS5qcyIsIlZJRVcvcmVzdG9yZVZpZXcuanMiLCJWSUVXL3NldEtleWJvYXJkTGV0dGVycy5qcyIsIlZJRVcvc2V0TmV3UGhyYXNlLmpzIiwiVklFVy9zaG93RWxlbS5qcyIsIlZJRVcvc2hvd01vZGFsLmpzIiwiVklFVy9zaG93VGV4dEFyZWEuanMiLCJWSUVXL3Nob3dUaW1lci5qcyIsIlZJRVcvdXBkYXRlTGlzdEJ5U2NvcmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIGtleWJvYXJkXG52YXIga2V5Ym9hcmRCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5rZXlib2FyZF9fYnRuXCIpO1xuXG4vLyBUWVBBQkxFIEFSRUFcbnZhciB0eXBhYmxlQ2hhcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnR5cGFibGVfX2NoYXJcIik7XG5cbi8vIGxhbmcgYnRuXG52YXIgbGFuZ0J0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmxhbmctY3RybHNfX2J0blwiKTtcbnZhciBsYW5ndWFnZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmxhbmctY3RybHNfX2JvZHlcIik7XG5cbi8vIFNUQVJUIFRZUElORyBidG5cbnZhciBiZWdpbkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmVnaW5CdG5cIik7XG5cbi8vIFRFWFQgQVJFQVxuLy8gdGV4dEFyZWEgd3JhcHBlclxudmFyIHdycFRleHRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbnB1dFRleHRcIik7XG4vLyBzaG93IHRleHRBcmVhXG52YXIgYnRuU2hvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYnRuVGV4dEFyZWFcIik7XG4vLyBpbnNlcnQgZnJvbSB0ZXh0QXJlYVxudmFyIGJ0blRleHRBZGRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJ0bkFkZFRleHRcIik7XG4vLyByYWRpb1xudmFyIHJhZGlvTGFuZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWU9XCJsYW5nU2VsZWN0XCJdJyk7XG4vLyB0ZXh0YXJlYVxudmFyIGVsZW1UZXh0QXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ0ZXh0YXJlYVwiKTtcblxuLy8gY2xvY2tcbnZhciBjbG9jayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2xvY2tfX3RpbWVcIik7XG4vLyB0aW1lclxudmFyIHNwZWVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX192YWx1ZS0tc3BlZWRcIik7XG52YXIgZXJyb3JzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX192YWx1ZS0tZXJyb3JzXCIpO1xuXG4vLyBtb2RhbFxudmFyIG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbFwiKTtcbnZhciBtb2RhbFAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsID4gcFwiKTtcblxuLy8gdXNlclxudmFyIHVzZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImlucHV0VXNlcnNOYW1lSURcIik7XG52YXIgc2JtdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3VibWl0VXNlcnNOYW1lSURcIik7XG4vLyB1c2VyLWxpc3Rcbi8vIGNvbnN0IHVzZXJMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi51c2VyLWxpc3RcIik7XG4vLyBsZXQgdXNlckxpc3RTY29yZXM7XG52YXIgdXNlckxpc3RQYXJlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnVzZXItbGlzdFwiKTtcbi8vIGNvbnN0IHVzZXJOYW1lcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudXNlci1saXN0X19uYW1lXCIpO1xudmFyIHNlY3Rpb25Vc2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi51c2VyXCIpO1xudmFyIHVzZXJJZCA9IHZvaWQgMDsgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lkLVVzZXInKTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHBEYXRhID0ge1xuICAgIGN1cnJlbnRTZXR0aW5nOiB7XG4gICAgICAgIGxhbmc6ICdlbicsXG4gICAgICAgIHNldEtleWJvYXJkOiBmdW5jdGlvbiBzZXRLZXlib2FyZCgpIHtcbiAgICAgICAgICAgIHJldHVybiBhcHBEYXRhLmxhbmd1YWdlW2FwcERhdGEuY3VycmVudFNldHRpbmcubGFuZ107XG4gICAgICAgIH0sXG4gICAgICAgIHNldFR5cGluZ1RleHQ6IGZ1bmN0aW9uIHNldFR5cGluZ1RleHQoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBwRGF0YS50eXBpbmdUZXh0W2FwcERhdGEuY3VycmVudFNldHRpbmcubGFuZ107XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGN1cnJlbnRUeXBlOiB7XG4gICAgICAgIHR5cGU6IC0xLFxuICAgICAgICB0ZXh0OiAnJyxcbiAgICAgICAgZXJyb3JzOiAwLFxuICAgICAgICBwb3NpdGlvbjogMFxuICAgIH0sXG4gICAgaW50ZXJ2YWw6IDAsXG4gICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgZW46IFwicXdlcnR5dWlvcFtdYXNkZmdoamtsOyd6eGN2Ym5tLC4vIFwiLFxuICAgICAgICB1YTogXCLQudGG0YPQutC10L3Qs9GI0YnQt9GF0ZfRhNGW0LLQsNC/0YDQvtC70LTQttGU0Y/Rh9GB0LzQuNGC0YzQsdGOLiBcIixcbiAgICAgICAgcnU6IFwi0LnRhtGD0LrQtdC90LPRiNGJ0LfRhdGK0YTRi9Cy0LDQv9GA0L7Qu9C00LbRjdGP0YfRgdC80LjRgtGM0LHRji4gXCJcbiAgICB9LFxuICAgIHJlY29yZHM6IHt9LFxuICAgIHJlc3VsdHM6IFtdLFxuICAgIHRpbWVyQ3VycmVudDogMCxcbiAgICB0eXBpbmdUZXh0OiB7XG4gICAgICAgIGVuOiBcInRoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cuXCIsXG4gICAgICAgIHVhOiBcItGF0LLQsNGG0YzQutC40Lkg0Y7RiNC60L7QstCw0YAg0YTRltC70ZbQvyDRidC+0LTQvdGPINCz0L7RgtGD0ZQg0YHRltC8J9GXINCy0LXRh9C10YDRjiDQtyDQttCw0LEuXCIsXG4gICAgICAgIHJ1OiBcItGB0YrQtdGI0Ywg0LbQtSDQtdGJ0ZEg0Y3RgtC40YUg0LzRj9Cz0LrQuNGFINGE0YDQsNC90YbRg9C30YHQutC40YUg0LHRg9C70L7Quiwg0LTQsCDQstGL0L/QtdC5INGH0LDRji5cIlxuICAgIH0sXG4gICAgLy8gY3VycmVudFVzZXJcbiAgICB1c2VyQ3VycmVudDoge1xuICAgICAgICBpZDogJ2lkLVVzZXInLFxuICAgICAgICByZXN0SUQ6IC0xLFxuICAgICAgICBuYW1lOiAnVXNlcicsXG4gICAgICAgIHNjb3JlOiAwXG4gICAgfSxcbiAgICAvLyBzYXZlZFVzZXJcbiAgICB1c2VyU2F2ZWQ6IGZhbHNlLFxuICAgIHVybDogJ2h0dHA6Ly9mZWNvcmUubmV0LnVhL3Jlc3QvJ1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuaW5pdCgpO1xuLy8gYWRkTGlzdGVuZXJzKCk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciB0aW1lciA9IHtcbiAgICBzdGFydFRpbWU6IDAsXG4gICAgc3RvcFRpbWU6IDAsXG4gICAgaW50ZXJ2YWw6IDAsXG5cbiAgICBzdGFydDogZnVuY3Rpb24gc3RhcnQoKSB7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gbmV3IERhdGUoKTtcbiAgICAgICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0bXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdmFyIGRlbHRhID0gdG1wLmdldFRpbWUoKSAtIHRpbWVyLnN0YXJ0VGltZS5nZXRUaW1lKCk7XG4gICAgICAgICAgICB2YXIgc2VjID0gZGF0ZUZvcm1hdChkZWx0YSk7XG4gICAgICAgICAgICBzaG93VGltZXIoc2VjKTtcbiAgICAgICAgfSwgNDApO1xuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbiBzdG9wKCkge1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gbmV3IERhdGUoKTtcbiAgICAgICAgdmFyIGRlbHRhID0gdGhpcy5zdG9wVGltZS5nZXRUaW1lKCkgLSB0aGlzLnN0YXJ0VGltZS5nZXRUaW1lKCk7XG4gICAgICAgIHZhciBzZWMgPSBkYXRlRm9ybWF0KGRlbHRhKTtcbiAgICAgICAgc2hvd1RpbWVyKHNlYyk7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gMDtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDA7XG4gICAgICAgIHRoaXMuaW50ZXJ2YWwgPSAwO1xuICAgICAgICByZXR1cm4gc2VjO1xuICAgIH1cbn07IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBhZGRMaXN0ZW5lcnMoKSB7XG5cbiAgICBhY3RpdmVCdG4oKTtcblxuICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PSDRgdC80LXQvdCwINGP0LfRi9C60LAg0YDQsNGB0LrQu9Cw0LTQutC4ID09PT09PT09PT09PT09PT09PT09PT0gKi9cbiAgICBsYW5ndWFnZUJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZXNldEtleWJvYXJkTGV0dGVycyk7XG5cbiAgICAvKiA9PT09PT09PT09PT09INC00L7QsdCw0LLQuNGC0Ywg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPID09PT09PT09PT09PT09PT09PT09PT0gKi9cbiAgICBzYm10LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWRkVXNlcik7XG5cbiAgICAvKiA9PT09PT09PT09PT09INC/0L7QutCw0LfQsNGC0Ywg0YHQutGA0YvRgtC+0LUg0L7QutC90L4g0LTQu9GPINCy0LLQvtC00LAg0YLQtdC60YHRgtCwID09PT09PT09PT09PT0gKi9cbiAgICBidG5TaG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2hvd1RleHRBcmVhKTtcblxuICAgIC8qID09PT09PT09PT09PT0g0LTQvtCx0LDQstC40YLRjCDQvdC+0LLRi9C5INGC0LXQutGB0YIgPT09PT09PT09PT09PSAqL1xuICAgIGJ0blRleHRBZGRpbmcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZXROZXdQaHJhc2UpO1xuXG4gICAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PSDQvdCw0YfQuNC90LDQtdC8INGB0YDQsNCy0L3QtdC90LjQtSDQutC70LjQutC+0LIg0LrQu9Cw0LLQuNGIINGBINGC0LXQutGB0YLQvtC8ID09PT09PT09PT0gKi9cbiAgICBiZWdpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGJlZ2luVHlwZSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBhZGRVc2VyKGUpIHtcbiAgICAvLyBUT0RPINGB0LTQtdC70LDRgtGMINC/0YDQvtCy0LXRgNC60YMg0L3QsCDRg9C90LjQutCw0LvRjNC90L7RgdGC0Ywg0LjQvNC10L3QuFxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB2YXIgbmFtZSA9IHVzZXIudmFsdWU7XG4gICAgc2VjdGlvblVzZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB1c2VySWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWQtVXNlcicpO1xuICAgIHVzZXJJZC50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgcGFpbnRVc2VyU2NvcmUoKTtcbiAgICBhcHBEYXRhLnVzZXJDdXJyZW50Lm5hbWUgPSBuYW1lO1xuICAgIGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmUgPSB1c2VySWQubmV4dFNpYmxpbmcudGV4dENvbnRlbnQ7XG4gICAgY3JlYXRlUkVTVChhcHBEYXRhLnVzZXJDdXJyZW50KTtcbiAgICBzYXZlKCd0aGlzVXNlcicsIGFwcERhdGEudXNlckN1cnJlbnQpO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gYmVnaW5UeXBlKCkge1xuICAgIC8vIGJlZ2luVHlwZSAoKSBmbGFnID0gdHJ1ZSAgLT4gc3RvcFR5cGUoKSBmbGFnID0gZmFsc2VcbiAgICAvLyBhcHBEYXRhLmN1cnJlbnRUeXBlLnR5cGluZyA9IHRydWU7XG5cbiAgICAvLyBiZWdpblR5cGUoKSBhZGQgbGlzdGVuZXIgLT4gc3RvcFR5cGUoKSByZW1vdmUgbGlzdGVuZXJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIGNoZWNrS2V5KTtcblxuICAgIC8vXG4gICAgcmVtb3ZlTGlzdGVuZXJzKCk7XG5cbiAgICAvLyBiZWdpblR5cGUgKCkgYXBwRGF0YS50aW1lci5zdGFydCAtPiBzdG9wVHlwZSgpIGFwcERhdGEudGltZXIuc3RvcFxuICAgIC8vIGFwcERhdGEudGltZXIuc3RhcnQgPSB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCk7XG4gICAgLy8gY29uc29sZS5sb2coYXBwRGF0YS50aW1lci5zdGFydCk7XG5cblxuICAgIC8vIGFycmF5INC40Lcg0YHRgtGA0L7QutC4INC00LvRjyDQv9GA0L7QstC10YDQutC4IC0gcG9wKClcbiAgICB2YXIgdG1wID0gYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCk7XG4gICAgYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0ID0gdG1wLnNwbGl0KCcnKS5yZXZlcnNlKCk7XG4gICAgLy8gY29uc29sZS5sb2coYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0KTtcblxuICAgIC8vdGltZXJcbiAgICB0aW1lci5zdGFydCgpO1xuXG4gICAgLy8gRXJyb3JzIC0g0L/QvtC60LDQt9Cw0YLRjCDRgtC10LrRg9GJ0LXQtSDRgdC+0YHRgtC+0Y/QvdC40LVcbiAgICBlcnJvcnMudGV4dENvbnRlbnQgPSBhcHBEYXRhLmN1cnJlbnRUeXBlLmVycm9ycztcblxuICAgIG1vZGFsLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKC0xMTAlKSc7XG4gICAgbW9kYWxQLnRleHRDb250ZW50ID0gJyc7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBjaGVja0tleShldmVudCkge1xuICAgIC8vIGV2ZW50LmtleVxuXG4gICAgdmFyIGxlbmd0aCA9IGFwcERhdGEuY3VycmVudFR5cGUudGV4dC5sZW5ndGg7XG5cbiAgICBpZiAobGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQpO1xuICAgICAgICBpZiAoYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0W2xlbmd0aCAtIDFdID09PSBldmVudC5rZXkpIHtcbiAgICAgICAgICAgIG5leHRUeXBlU3ltYm9sKCk7XG4gICAgICAgICAgICBhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQucG9wKCk7XG4gICAgICAgICAgICB2YXIgbGFzdCA9IGFwcERhdGEuY3VycmVudFR5cGUudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0bXApO1xuICAgICAgICAgICAgbGlnaHRCdXR0b24oYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0W2xhc3QgLSAxXSk7XG4gICAgICAgICAgICBpZiAobGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgc3RvcFR5cGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICsrYXBwRGF0YS5jdXJyZW50VHlwZS5lcnJvcnM7XG4gICAgICAgICAgICBlcnJvclR5cGVTeW1ib2woKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gJ0Vycm9yOiBhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQubGVuZ3RoID0gJyArIGFwcERhdGEuY3VycmVudFR5cGUudGV4dC5sZW5ndGg7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiByZW1vdmVMaXN0ZW5lcnMoKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ3JlbW92ZSBsaXN0ZW5lcnMnKTtcblxuICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PSDRgdC80LXQvdCwINGP0LfRi9C60LAg0YDQsNGB0LrQu9Cw0LTQutC4ID09PT09PT09PT09PT09PT09PT09PT0gKi9cbiAgICBsYW5ndWFnZUJ1dHRvbnMucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZXNldEtleWJvYXJkTGV0dGVycyk7XG5cbiAgICAvKiA9PT09PT09PT09PT09INC00L7QsdCw0LLQuNGC0Ywg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPID09PT09PT09PT09PT09PT09PT09PT0gKi9cbiAgICBzYm10LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWRkVXNlcik7XG5cbiAgICAvKiA9PT09PT09PT09PT09INC/0L7QutCw0LfQsNGC0Ywg0YHQutGA0YvRgtC+0LUg0L7QutC90L4g0LTQu9GPINCy0LLQvtC00LAg0YLQtdC60YHRgtCwID09PT09PT09PT09PT0gKi9cbiAgICBidG5TaG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2hvd1RleHRBcmVhKTtcblxuICAgIC8qID09PT09PT09PT09PT0g0LTQvtCx0LDQstC40YLRjCDQvdC+0LLRi9C5INGC0LXQutGB0YIgPT09PT09PT09PT09PSAqL1xuICAgIGJ0blRleHRBZGRpbmcucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZXROZXdQaHJhc2UpO1xuXG4gICAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PSDQvdCw0YfQuNC90LDQtdC8INGB0YDQsNCy0L3QtdC90LjQtSDQutC70LjQutC+0LIg0LrQu9Cw0LLQuNGIINGBINGC0LXQutGB0YLQvtC8ID09PT09PT09PT0gKi9cbiAgICBiZWdpbkJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGJlZ2luVHlwZSk7XG5cbiAgICBkZXNhY3RpdmVCdG4oKTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIHJlc2V0S2V5Ym9hcmRMZXR0ZXJzKGUpIHtcbiAgICBhcHBEYXRhLmN1cnJlbnRTZXR0aW5nLmxhbmcgPSBlLnRhcmdldC50ZXh0Q29udGVudDtcbiAgICBzZXRLZXlib2FyZExldHRlcnMoYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRLZXlib2FyZCgpLCBrZXlib2FyZEJ1dHRvbnMpO1xuICAgIEFycmF5LmZyb20obGFuZ0J0bnMsIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHJldHVybiBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2xhbmctY3RybHNfX2J0bi0tYWN0aXZlJyk7XG4gICAgfSk7XG4gICAgZS50YXJnZXQuY2xhc3NMaXN0LmFkZCgnbGFuZy1jdHJsc19fYnRuLS1hY3RpdmUnKTtcbiAgICBmaWxsVHlwYWJsZUNoYXJzKHR5cGFibGVDaGFycywgYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCkpO1xuICAgIGhpZGVUeXBlRWxlbWVudHModHlwYWJsZUNoYXJzLCBhcHBEYXRhLmN1cnJlbnRTZXR0aW5nLnNldFR5cGluZ1RleHQoKSk7XG4gICAgLy8gY2xlYXIoKTtcblxuICAgIHZhciB0ZXh0ID0gYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCk7XG4gICAgLy8g0L/QvtC00YHQstC10YLQutCwINGC0LXQutGD0YnQtdC5INCx0YPQutCy0YtcbiAgICAvLyBjb25zb2xlLmxvZyh0ZXh0KTtcbiAgICBsaWdodEJ1dHRvbih0ZXh0WzBdKTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIHN0b3BUeXBlKCkge1xuXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBjaGVja0tleSk7XG5cbiAgICBhZGRMaXN0ZW5lcnMoKTtcblxuICAgIC8vdGltZXJcbiAgICB2YXIgcmVzdWx0VGltZSA9IHRpbWVyLnN0b3AoKS5zcGxpdCgnOicpO1xuICAgIGFwcERhdGEudGltZXJDdXJyZW50ID0gK3Jlc3VsdFRpbWVbMF0gKyArcmVzdWx0VGltZVsxXSAvIDEwMDA7XG5cbiAgICAvLyDQoNCw0YHRh9C40YLQsNGC0YwgU2NvcmUgINC4INC/0L7QutCw0LfQsNGC0Ywg0L3QsCDRgdGC0YDQsNC90LjRhtC1LFxuICAgIHZhciBjdXJyZW50VGV4dExlbmd0aCA9IGFwcERhdGEudHlwaW5nVGV4dFthcHBEYXRhLmN1cnJlbnRTZXR0aW5nLmxhbmddLmxlbmd0aDtcbiAgICB2YXIgY3VycmVudFNjb3JlID0gZ2V0U2NvcmUoYXBwRGF0YS50aW1lckN1cnJlbnQsIGN1cnJlbnRUZXh0TGVuZ3RoKTtcbiAgICBzcGVlZC50ZXh0Q29udGVudCA9IGN1cnJlbnRTY29yZTtcblxuICAgIC8vINGB0YDQsNCy0L3QuNGC0YwgU2NvcmUsINC/0LXRgNC10LfQsNC/0LjRgdCw0YLRjCDRgNC10LfRg9C70YzRgtCw0YLRi1xuICAgIGlmIChhcHBEYXRhLmN1cnJlbnRUeXBlLmVycm9ycyA9PT0gMCkge1xuICAgICAgICAvLyB1c2VyU2NvcmUuc2NvcmUgPSBzY3IgPiB1c2VyU2NvcmUuc2NvcmUgPyBzY3IgOiB1c2VyU2NvcmUuc2NvcmU7XG4gICAgICAgIGlmIChjdXJyZW50U2NvcmUgPiBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlKSB7XG4gICAgICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlID0gY3VycmVudFNjb3JlO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYCR7Y3VycmVudFNjb3JlfWApO1xuICAgICAgICAgICAgZ2V0UkVTVElkVXNlcigpO1xuICAgICAgICAgICAgc2F2ZSgndGhpc1VzZXInLCBhcHBEYXRhLnVzZXJDdXJyZW50KTtcbiAgICAgICAgICAgIHVwZGF0ZVJFU1QoYXBwRGF0YS51c2VyQ3VycmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgdXNlcklkLm5leHRTaWJsaW5nLnRleHRDb250ZW50ID0gYXBwRGF0YS51c2VyQ3VycmVudC5zY29yZTtcbiAgICAgICAgLy8g0L/RgNC+0LnRgtC40YHRjCDQv9C+INGB0L/QuNGB0LrRgyDQv9GA0L7QstC10YDQuNGC0Ywgc2NvcmUgLCDQv9C10YDQtdC80LXRgdGC0LjRgtGMXG4gICAgICAgIHVwZGF0ZUxpc3RCeVNjb3JlKCk7XG4gICAgfVxuXG4gICAgLy8g0JzQvtC00LDQu9GM0L3QvtC1INC+0LrQvdC+INC/0YDQuCDQt9Cw0LLQtdGA0YjQtdC90LjQuFxuICAgIG1vZGFsLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKC0yNSUpJztcbiAgICBtb2RhbFAudGV4dENvbnRlbnQgPSAnRmluJztcblxuICAgIC8vINCf0L7QutCw0LfQsNGC0YwgRXJyb3JzINC90LAg0YHRgtGA0LDQvdC40YbQtSDQuCDQvtCx0L3Rg9C70LjRgtGMXG4gICAgYXBwRGF0YS5jdXJyZW50VHlwZS5lcnJvcnMgPSAwO1xuXG4gICAgcmVzdG9yZVZpZXcoKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuLy8ga2V5ID0gICd0aGlzVXNlcidcblxuZnVuY3Rpb24gbG9hZChrZXkpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuLy8ga2V5ID0gICd0aGlzVXNlcidcblxuZnVuY3Rpb24gcmVtb3ZlKGtleSkge1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgLy8gbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3RoaXNVc2VyJyk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIGtleSA9ICAndGhpc1VzZXInXG5cbmZ1bmN0aW9uIHNhdmUoa2V5LCBvYmopIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KG9iaikpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBSZXN1bHQoKSB7XG4gICAgdGhpcy50aW1lID0gMDtcbiAgICB0aGlzLmVyciA9IDA7XG4gICAgdGhpcy5lcnJvcnNMZXR0ZXJzID0gW107XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBVc2VyKCkge1xuICAgIHZhciBuYW1lID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnVXNlcic7XG4gICAgdmFyIHNwZWVkID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAwO1xuXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnNwZWVkID0gc3BlZWQ7XG4gICAgdGhpcy5yZXN1bHQgPSBuZXcgUmVzdWx0KCk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIFVzZXJSZXN1bHQobmFtZSwgc2NvcmUpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuc2NvcmUgPSBzY29yZTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gYWRkdG9SZXN1bHRzQXJyYXkoYXJyYXksIG9iamVjdCkge1xuICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgaWYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICBhcnJheS5wdXNoKG5ldyBVc2VyUmVzdWx0KGtleSwgb2JqZWN0W2tleV0pKTtcbiAgICAgICAgfVxuICAgIH1cbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gYXJyYXlUb09iaihhcnIpIHtcbiAgICB2YXIgb2JqID0ge307XG4gICAgYXJyLm1hcChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gb2JqW2VsZW1bXCJuYW1lXCJdXSA9IGVsZW1bXCJzY29yZVwiXTtcbiAgICB9KTtcbiAgICByZXR1cm4gb2JqO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gZGF0ZUZvcm1hdChkaWdpdHMpIHtcbiAgICB2YXIgbXNjID0gdm9pZCAwLFxuICAgICAgICBzZWMgPSB2b2lkIDAsXG4gICAgICAgIG1pbiA9IHZvaWQgMCxcbiAgICAgICAgaG91ciA9IHZvaWQgMDtcblxuICAgIG1zYyA9IE1hdGguZmxvb3IoZGlnaXRzICUgMTAwMCk7XG4gICAgaWYgKG1zYyA+IDk5KSB7XG4gICAgICAgIG1zYyA9ICc6JyArIG1zYztcbiAgICB9IGVsc2UgaWYgKG1zYyA+IDkpIHtcbiAgICAgICAgbXNjID0gJzonICsgJzAnICsgbXNjO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG1zYyA9ICc6JyArICcwMCcgKyBtc2M7XG4gICAgfVxuXG4gICAgc2VjID0gTWF0aC5mbG9vcihkaWdpdHMgLyAxMDAwICUgNjApO1xuICAgIGlmIChzZWMgPiA5KSB7XG4gICAgICAgIHNlYyA9IHNlYztcbiAgICB9IGVsc2Uge1xuICAgICAgICBzZWMgPSAnMCcgKyBzZWM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlYyArIG1zYztcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gZmlsdGVyVG9wUmVzdWx0KGFycikge1xuICAgIHZhciB0bXAgPSBbXTtcbiAgICBpZiAoYXJyLmxlbmd0aCA+IDEwKSB7XG4gICAgICAgIHRtcCA9IGFyci5zbGljZSgwLCA5KTtcbiAgICAgICAgcmV0dXJuIHRtcDtcbiAgICB9XG4gICAgcmV0dXJuIGFycjtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gZ2V0U2NvcmUoc2VjLCB0ZXh0TGVuZ3RoKSB7XG4gICAgcmV0dXJuIE1hdGgucm91bmQoNjAgKiB0ZXh0TGVuZ3RoIC8gc2VjKTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gICAgYWRkTGlzdGVuZXJzKCk7XG4gICAgc2hvd01vZGFsKCk7XG4gICAgLypcbiAgICDQt9Cw0LTQsNC10Lwg0LTQtdGE0L7Qu9GC0L3Ri9C1INC30L3QsNGH0LXQvdC40Y8g0LLRi9Cx0L7RgNGDINGP0LfRi9C60LBcbiAgICAgKi9cbiAgICBzZXRLZXlib2FyZExldHRlcnMoYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRLZXlib2FyZCgpLCBrZXlib2FyZEJ1dHRvbnMpO1xuXG4gICAgLypcbiAgICAgINC00L7QsdCw0LLQu9GP0LXRgiDRgtC10LrRgdGCINCyICB0eXBhYmxlXG4gICAgKi9cbiAgICBmaWxsVHlwYWJsZUNoYXJzKHR5cGFibGVDaGFycywgYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCkpO1xuICAgIGhpZGVUeXBlRWxlbWVudHModHlwYWJsZUNoYXJzLCBhcHBEYXRhLmN1cnJlbnRTZXR0aW5nLnNldFR5cGluZ1RleHQoKSk7XG4gICAgY29uc29sZS5sb2coJzEgJyArIGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmUpO1xuICAgIGFwcERhdGEudXNlclNhdmVkID0gbG9hZCgndGhpc1VzZXInKTtcblxuICAgIGlmIChhcHBEYXRhLnVzZXJTYXZlZCkge1xuICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50LmlkID0gYXBwRGF0YS51c2VyU2F2ZWQuaWQ7XG4gICAgICAgIGFwcERhdGEudXNlckN1cnJlbnQubmFtZSA9IGFwcERhdGEudXNlclNhdmVkLm5hbWU7XG4gICAgICAgIGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmUgPSBhcHBEYXRhLnVzZXJTYXZlZC5zY29yZTtcbiAgICAgICAgY29uc29sZS5sb2coJzIgJyArIGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmUpO1xuICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50LnJlc3RJRCA9IGFwcERhdGEudXNlclNhdmVkLnJlc3RJRDtcbiAgICAgICAgYXBwRGF0YS5yZWNvcmRzW2FwcERhdGEudXNlckN1cnJlbnQubmFtZV0gPSBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlO1xuICAgICAgICBzYm10LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWRkVXNlcik7XG4gICAgICAgIGhpZGVFbGVtKHNlY3Rpb25Vc2VyKTtcbiAgICAgICAgYXBwRGF0YS51c2VyQ3VycmVudC5pZCA9ICdpZC0nICsgYXBwRGF0YS51c2VyQ3VycmVudC5uYW1lO1xuICAgICAgICBnZXRSRVNUSWRVc2VyKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJzMgJyArIGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmUpO1xuICAgICAgICBhcHBEYXRhLnJlY29yZHNbYXBwRGF0YS51c2VyQ3VycmVudC5uYW1lXSA9IGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmU7XG4gICAgfVxuXG4gICAgcmVhZFJFU1QoKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gc2V0SWRSRVNUQnlOYW1lKGFycikge1xuICAgIGFyci5tYXAoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgaWYgKGVsZW0ubmFtZSA9PT0gYXBwRGF0YS51c2VyQ3VycmVudC5uYW1lKSB7XG4gICAgICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50LnJlc3RJRCA9IGVsZW1bXCJpZFwiXTtcbiAgICAgICAgfVxuICAgIH0pO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBzb3J0QnlTY29yZShhcnIpIHtcbiAgICBhcnIuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBjcmVhdGVSRVNUKG9iaikge1xuICAgIHZhciBjcmVhdGVVcmwgPSBhcHBEYXRhLnVybCArICc/YWN0aW9uPTEmbmFtZT0nICsgb2JqLm5hbWUgKyAnJnNjb3JlPScgKyBvYmouc2NvcmU7XG4gICAgY29uc29sZS5sb2coY3JlYXRlVXJsKTtcblxuICAgIGZldGNoKGNyZWF0ZVVybCwge1xuICAgICAgICBtZXRvZDogXCJwb3N0XCIsXG4gICAgICAgIG1vZGU6ICdjb3JzJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJ1xuICAgICAgICB9XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDcmVhdGVSRVNUOiBGZXRjaCBFcnJvciA6LVMnLCBlcnJvcik7XG4gICAgfSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGRlbGV0ZVJFU1Qob2JqKSB7XG4gICAgdmFyIHVwZGF0ZVVybCA9IGFwcERhdGEudXJsICsgXCI/YWN0aW9uPTMkaWQ9XCIgKyBvYmoucmVzdElEO1xuXG4gICAgLy8gaHR0cDovL2ZlY29yZS5uZXQudWEvcmVzdC8/YWN0aW9uPTMmaWQ9NjNcblxuICAgIGZldGNoKHVwZGF0ZVVybCwge1xuICAgICAgICBtZXRvZDogXCJwb3N0XCJcbiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZVJFU1Q6IEZldGNoIEVycm9yIDogJywgZXJyb3IpO1xuICAgIH0pO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gZ2V0UkVTVElkVXNlcigpIHtcbiAgICBmZXRjaChhcHBEYXRhLnVybCwge1xuICAgICAgICBtZXRvZDogXCJnZXRcIixcbiAgICAgICAgbW9kZTogJ2NvcnMnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonXG4gICAgICAgIH1cbiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB2YXIganNvbiA9IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA+PSAyMDAgJiYgcmVzcG9uc2Uuc3RhdHVzIDwgMzAwKSB7XG4gICAgICAgICAgICByZXR1cm4ganNvbjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvcjtcbiAgICAgICAgfVxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgc2V0SWRSRVNUQnlOYW1lKGpzb24pO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2ggRXJyb3IgOi1TJywgZXJyb3IpO1xuICAgIH0pO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gcmVhZFJFU1QoKSB7XG4gICAgZmV0Y2goYXBwRGF0YS51cmwsIHtcbiAgICAgICAgbWV0b2Q6IFwiZ2V0XCIsXG4gICAgICAgIG1vZGU6ICdjb3JzJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJ1xuICAgICAgICB9XG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIGpzb24gPSByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDMwMCkge1xuICAgICAgICAgICAgcmV0dXJuIGpzb247XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3I7XG4gICAgICAgIH1cbiAgICB9KS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgIHZhciB0bXAgPSBhcnJheVRvT2JqKGpzb24pO1xuICAgICAgICAvLyDQtdGB0LvQuCDRgdC/0LjRgdC+0Log0LHQvtC70YzRiNC1IDEwLCDRgtC+INGB0L7RhdGA0LDQvdC40LwgdXNlclJlY1xuICAgICAgICB2YXIgdXNlclJlYyA9IGFwcERhdGEucmVjb3JkcztcbiAgICAgICAgYXBwRGF0YS5yZWNvcmRzID0gT2JqZWN0LmFzc2lnbihhcHBEYXRhLnJlY29yZHMsIHRtcCk7XG5cbiAgICAgICAgYWRkdG9SZXN1bHRzQXJyYXkoYXBwRGF0YS5yZXN1bHRzLCBhcHBEYXRhLnJlY29yZHMpO1xuICAgICAgICBzb3J0QnlTY29yZShhcHBEYXRhLnJlc3VsdHMpO1xuICAgICAgICAvLyDQv9C+0LvRg9GH0LjRgtGMINGB0L/QuNGB0L7QuiDQvNCw0LrRgdC40LzRg9C8INC40LcgMTAt0YLQuCDRgtC+0L8g0YDQtdC30YPQu9GM0YLQsNGC0L7QslxuICAgICAgICBmaWx0ZXJUb3BSZXN1bHQoYXBwRGF0YS5yZXN1bHRzKTtcblxuICAgICAgICBhcHBEYXRhLnJlY29yZHMgPSBPYmplY3QuYXNzaWduKGFwcERhdGEucmVjb3JkcywgdXNlclJlYyk7XG4gICAgICAgIHNvcnRCeVNjb3JlKGFwcERhdGEucmVzdWx0cyk7XG5cbiAgICAgICAgYXBwRGF0YS5yZXN1bHRzLm1hcChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGFkZFRvU2NvcmVMaXN0KGVsZW0ubmFtZSwgZWxlbS5zY29yZSwgdXNlckxpc3RQYXJlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ2FwcERhdGEudXNlckN1cnJlbnQuaWQgPSAnLCBhcHBEYXRhLnVzZXJDdXJyZW50LmlkKTtcbiAgICAgICAgdXNlcklkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYXBwRGF0YS51c2VyQ3VycmVudC5pZCk7XG4gICAgICAgIHBhaW50VXNlclNjb3JlKCk7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBFcnJvciA6LVMnLCBlcnJvcik7XG4gICAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiB1cGRhdGVSRVNUKG9iaikge1xuXG4gICAgdmFyIHVwZGF0ZVVybCA9IGFwcERhdGEudXJsICsgJz9hY3Rpb249MiZpZD0nICsgb2JqLnJlc3RJRCArICcmbmFtZT0nICsgb2JqLm5hbWUgKyAnJnNjb3JlPScgKyBvYmouc2NvcmU7XG4gICAgY29uc29sZS5sb2codXBkYXRlVXJsKTtcbiAgICBmZXRjaCh1cGRhdGVVcmwsIHtcbiAgICAgICAgbWV0b2Q6IFwicG9zdFwiLFxuICAgICAgICBtb2RlOiAnY29ycycsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKidcbiAgICAgICAgfVxuXG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVSRVNUOiBGZXRjaCBFcnJvciA6ICcsIGVycm9yKTtcbiAgICB9KTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gYWN0aXZlQnRuKCkge1xuICAgIGxhbmd1YWdlQnV0dG9ucy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICBzYm10LnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgIGJ0blNob3cuc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgYnRuVGV4dEFkZGluZy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICBiZWdpbkJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gMTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbi8vIGFkZFRvTGlzdFxuZnVuY3Rpb24gYWRkVG9TY29yZUxpc3QobmFtZSwgc2NvcmUsIHBhcmVudCkge1xuICAgIHZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgdmFyIHBOYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIHZhciBwU2NvcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbGkuY2xhc3NOYW1lID0gJ3VzZXItbGlzdF9faXRlbSc7XG4gICAgcE5hbWUuY2xhc3NOYW1lID0gJ3VzZXItbGlzdF9fbmFtZSc7XG4gICAgcE5hbWUuaWQgPSAnaWQtJyArIG5hbWU7XG4gICAgcFNjb3JlLmNsYXNzTmFtZSA9ICd1c2VyLWxpc3RfX3Njb3JlJztcbiAgICBwTmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgcFNjb3JlLnRleHRDb250ZW50ID0gc2NvcmU7XG4gICAgbGkuYXBwZW5kQ2hpbGQocE5hbWUpO1xuICAgIGxpLmFwcGVuZENoaWxkKHBTY29yZSk7XG4gICAgcGFyZW50LmFwcGVuZENoaWxkKGxpKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gZGVzYWN0aXZlQnRuKCkge1xuICAgIGxhbmd1YWdlQnV0dG9ucy5zdHlsZS5vcGFjaXR5ID0gMC41O1xuICAgIHNibXQuc3R5bGUub3BhY2l0eSA9IDAuNTtcbiAgICBidG5TaG93LnN0eWxlLm9wYWNpdHkgPSAwLjU7XG4gICAgYnRuVGV4dEFkZGluZy5zdHlsZS5vcGFjaXR5ID0gMC41O1xuICAgIGJlZ2luQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAwLjU7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBlcnJvclR5cGVTeW1ib2woKSB7XG4gICAgdHlwYWJsZUNoYXJzW2FwcERhdGEuY3VycmVudFR5cGUucG9zaXRpb25dLmNsYXNzTGlzdC5hZGQoJ3R5cGFibGVfX2NoYXItLWVycm9yJyk7XG4gICAgZXJyb3JzLnRleHRDb250ZW50ID0gYXBwRGF0YS5jdXJyZW50VHlwZS5lcnJvcnM7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qXG4g0JfQsNC/0L7Qu9C90LXQvdC40LUgVFlQQUJMRSBBUkVBINGC0LXQutGB0YLQvtC8INC00LvRjyDQvdCw0LHQvtGA0LBcbiAqL1xuZnVuY3Rpb24gZmlsbFR5cGFibGVDaGFycyhhcnIsIHN0cikge1xuICBBcnJheS5mcm9tKGFyciwgZnVuY3Rpb24gKGVsZW0sIGkpIHtcbiAgICByZXR1cm4gZWxlbS50ZXh0Q29udGVudCA9IHN0cltpXTtcbiAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG4vKlxuICAgaGlkZVRleHRBcmVhLCBtb2RhbFxuICovXG5mdW5jdGlvbiBoaWRlRWxlbShlbGVtKSB7XG4gICAgZWxlbS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xufSIsIid1c2Ugc3RyaWN0JztcblxuLypcbiAg0KHQutGA0YvRgtC40LUg0Y3Qu9C10LzQtdC90YLQvtCyINCx0LXQtyDRgtC10LrRgdGC0LBcbiAqL1xuXG5mdW5jdGlvbiBoaWRlVHlwZUVsZW1lbnRzKGFyciwgc3RyKSB7XG4gICAgQXJyYXkuZnJvbShhcnIsIGZ1bmN0aW9uIChlbGVtLCBpKSB7XG4gICAgICAgIGlmIChpIDwgc3RyLmxlbmd0aCkge1xuICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgICAgICBlbGVtLnRleHRDb250ZW50ID0gc3RyW2ldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbS5jbGFzc0xpc3RhZGQgPSAnaGlkZSc7XG4gICAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG4vKlxuICAg0J/QvtC00YHQstC10YLQutCwINC60LvQsNCy0LjQsNGC0YPRgNGLOiDQutC70LDQstC40YjQsCwg0LrQvtGC0L7RgNGD0Y4g0YHQu9C10LTRg9C10YIg0L3QsNC20LDRgtGMLlxuICovXG5cbmZ1bmN0aW9uIGxpZ2h0QnV0dG9uKGNoYXJUZXh0KSB7XG4gICAgQXJyYXkuZnJvbShrZXlib2FyZEJ1dHRvbnMsIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGlmIChlbGVtLmNsYXNzTGlzdC5jb250YWlucygna2V5Ym9hcmRfX2J0bi0tYWN0aXZlJykpIHtcbiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgna2V5Ym9hcmRfX2J0bi0tYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW0udGV4dENvbnRlbnQgPT09IGNoYXJUZXh0KSB7XG4gICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2tleWJvYXJkX19idG4tLWFjdGl2ZScpO1xuICAgICAgICB9XG4gICAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBuZXh0VHlwZVN5bWJvbCgpIHtcbiAgICAvLyDQvtCx0LvQsNGB0YLRjCDQvdCw0LHQvtGA0LBcbiAgICAvLyBjb25zb2xlLmxvZyh0eXBhYmxlQ2hhcnNbYXBwRGF0YS5jdXJyZW50VHlwZS5wb3NpdGlvbl0udGV4dENvbnRlbnQpO1xuICAgIHR5cGFibGVDaGFyc1thcHBEYXRhLmN1cnJlbnRUeXBlLnBvc2l0aW9uXS5jbGFzc0xpc3QuYWRkKCd0eXBhYmxlX19jaGFyLS1zdWNjZXNzJyk7XG4gICAgdHlwYWJsZUNoYXJzW2FwcERhdGEuY3VycmVudFR5cGUucG9zaXRpb25dLmNsYXNzTGlzdC5yZW1vdmUoJ3R5cGFibGVfX2NoYXItLWN1cnJlbnQnKTtcbiAgICB0eXBhYmxlQ2hhcnNbKythcHBEYXRhLmN1cnJlbnRUeXBlLnBvc2l0aW9uXS5jbGFzc0xpc3QuYWRkKCd0eXBhYmxlX19jaGFyLS1jdXJyZW50Jyk7XG5cbiAgICAvLyDQvtCx0LvQsNGB0YLRjCDQutC70LDQstC40LDRgtGD0YDRi1xuXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIHBhaW50VXNlclNjb3JlKCkge1xuICAgIHVzZXJJZC5zdHlsZS5jb2xvciA9IFwiIzAzQTlGNFwiO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gcmVzdG9yZVZpZXcoKSB7XG4gICAgYXBwRGF0YS5jdXJyZW50VHlwZS5wb3NpdGlvbiA9IDA7XG4gICAgLy8gcmVtb3ZlIG9sZFxuICAgIEFycmF5LmZyb20oa2V5Ym9hcmRCdXR0b25zLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2tleWJvYXJkX19idG4tLWFjdGl2ZScpO1xuICAgICAgICAvLyBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2tleWJvYXJkX19idG4tLWFjdGl2ZScpO1xuICAgIH0pO1xuICAgIEFycmF5LmZyb20odHlwYWJsZUNoYXJzLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3R5cGFibGVfX2NoYXItLWVycm9yJyk7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgndHlwYWJsZV9fY2hhci0tc3VjY2VzcycpO1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3R5cGFibGVfX2NoYXItLWN1cnJlbnQnKTtcbiAgICB9KTtcbiAgICAvLyBkZWZhdWx0XG4gICAgdHlwYWJsZUNoYXJzWzBdLmNsYXNzTGlzdC5hZGQoJ3R5cGFibGVfX2NoYXItLWN1cnJlbnQnKTtcbiAgICAvLyBsZXQgY3VycmVudENoYXIgPSBhcHBEYXRhLnR5cGluZ1RleHRbYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nXTtcbiAgICAvLyBjb25zb2xlLmxvZygpXG4gICAgbGlnaHRCdXR0b24oYXBwRGF0YS50eXBpbmdUZXh0W2FwcERhdGEuY3VycmVudFNldHRpbmcubGFuZ11bMF0pO1xuICAgIC8vIGtleWJvYXJkQnV0dG9uc1swXS5jbGFzc0xpc3QuYWRkKCdrZXlib2FyZF9fYnRuLS1hY3RpdmUnKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuLypcbiAg0JfQsNC/0L7QvdC10L3QuNC1INC60LvQsNCy0LjQsNGC0YDRg9GLINGB0LjQvNCy0L7Qu9Cw0LzQuCDQstGL0LHRgNCw0L3QvdC+0LPQviDRj9C30YvQutCwXG4gKi9cblxuZnVuY3Rpb24gc2V0S2V5Ym9hcmRMZXR0ZXJzKGxhbmd1YWdlLCBidXR0b25zKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxpbWl0ID0gYnV0dG9ucy5sZW5ndGg7IGkgPCBsaW1pdDsgaSA9IGkgKyAxKSB7XG4gICAgICAgIGJ1dHRvbnNbaV0udGV4dENvbnRlbnQgPSBsYW5ndWFnZVtpXTtcbiAgICB9XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBzZXROZXdQaHJhc2UoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnNvbGUubG9nKCdzZXROZXdQaHJhc2UnKTtcbiAgICB2YXIgbG5nID0gJ2VuJztcblxuICAgIEFycmF5LmZyb20ocmFkaW9MYW5nLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBpZiAoZWxlbS5jaGVja2VkKSB7XG4gICAgICAgICAgICBsbmcgPSBlbGVtLnZhbHVlO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBhcHBEYXRhLnR5cGluZ1RleHRbbG5nXSA9IGVsZW1UZXh0QXJlYS52YWx1ZS50b0xvY2FsZUxvd2VyQ2FzZSgpO1xuXG4gICAgaGlkZUVsZW0od3JwVGV4dEFyZWEpO1xuXG4gICAgLyogPT09PT09PT09PT09PT09PT09INC80LXQvdGP0LXQvCDRgNCw0YHQutC70LDQtNC60YMg0LrQu9Cw0LLQuNCw0YLRg9GA0YsgPT09PT09PT09PT09PT09PSovXG4gICAgc2V0S2V5Ym9hcmRMZXR0ZXJzKGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0S2V5Ym9hcmQoKSwga2V5Ym9hcmRCdXR0b25zKTtcbiAgICAvKiA9PT09PT09PT09PT09PT09PSAg0LTQvtCx0LDQstC70Y/QtdGCINGC0LXQutGB0YIg0LIgIHR5cGFibGUgPT09PT09PT09PT09PT09PT09PT09PSAqL1xuICAgIHZhciB0ZXh0ID0gYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCk7XG5cbiAgICAvLyDQv9C+0LTRgdCy0LXRgtC60LAg0YLQtdC60YPRidC10Lkg0LHRg9C60LLRi1xuICAgIGxpZ2h0QnV0dG9uKHRleHRbMF0pO1xuXG4gICAgZmlsbFR5cGFibGVDaGFycyh0eXBhYmxlQ2hhcnMsIHRleHQpO1xuICAgIGhpZGVUeXBlRWxlbWVudHModHlwYWJsZUNoYXJzLCB0ZXh0KTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIHNob3dFbGVtKGVsZW0pIHtcbiAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gc2hvd01vZGFsKCkge1xuICAgIG1vZGFsLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKC0yNSUpJztcbiAgICBtb2RhbFAudGV4dENvbnRlbnQgPSAnUFJFU1MgQlVUVE9OIFwiU1RBUlQgVFlQRVwiJztcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gc2hvd1RleHRBcmVhKCkge1xuICBzaG93RWxlbSh3cnBUZXh0QXJlYSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIHNob3dUaW1lcih0eHQpIHtcbiAgICBjbG9jay50ZXh0Q29udGVudCA9IHR4dDtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIHVwZGF0ZUxpc3RCeVNjb3JlKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCd1cGRhdGVMaXN0QnlTY29yZScpO1xuICAgIHZhciB1c2VyTGlzdFNjb3JlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy51c2VyLWxpc3RfX2l0ZW0nKTtcbiAgICB2YXIgdG1wID0gQXJyYXkuZnJvbSh1c2VyTGlzdFNjb3Jlcyk7XG4gICAgdG1wLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIGIubGFzdENoaWxkLnRleHRDb250ZW50IC0gYS5sYXN0Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgfSk7XG4gICAgQXJyYXkuZnJvbSh1c2VyTGlzdFNjb3JlcywgZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgcmV0dXJuIGVsZW0ucmVtb3ZlKCk7XG4gICAgfSk7XG4gICAgdG1wLm1hcChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gdXNlckxpc3RQYXJlbnQuYXBwZW5kQ2hpbGQoZWxlbSk7XG4gICAgfSk7XG59Il19
