"use strict";

// keyboard
var keyboardButtons = document.querySelectorAll(".keyboard__btn");

// TYPABLE AREA
var typableChars = document.querySelectorAll(".typable__char");

// lang btn
var langBtns = document.querySelectorAll(".lang-ctrls__btn");
var languageButtons = document.querySelector(".lang-ctrls__body");

// START TYPING btn
var beginButton = document.getElementById("beginBtn");

// TEXT AREA
// textArea wrapper
var wrpTextArea = document.querySelector(".inputText");
// show textArea
var btnShow = document.getElementById("btnTextArea");
// insert from textArea
var btnTextAdding = document.getElementById("btnAddText");
// radio
var radioLang = document.querySelectorAll('input[name="langSelect"]');
// textarea
var elemTextArea = document.querySelector("textarea");

// clock
var clock = document.querySelector(".clock__time");
// timer
var speed = document.querySelector(".results__value--speed");
var errors = document.querySelector(".results__value--errors");

// modal
var modal = document.querySelector(".modal");
var modalP = document.querySelector(".modal > p");

// user
var user = document.getElementById("inputUsersNameID");
var sbmt = document.getElementById("submitUsersNameID");
// user-list
// const userList = document.querySelectorAll(".user-list");
// let userListScores;
var userListParent = document.querySelector(".user-list");
// const userNames = document.querySelectorAll(".user-list__name");
var sectionUser = document.querySelector(".user");
var userId = void 0; // document.getElementById('id-User');
'use strict';

var appData = {
    currentSetting: {
        lang: 'en',
        setKeyboard: function setKeyboard() {
            return appData.language[appData.currentSetting.lang];
        },
        setTypingText: function setTypingText() {
            return appData.typingText[appData.currentSetting.lang];
        }
    },
    currentType: {
        type: -1,
        text: '',
        errors: 0,
        position: 0
    },
    interval: 0,
    language: {
        en: "qwertyuiop[]asdfghjkl;'zxcvbnm,./ ",
        ua: "йцукенгшщзхїфівапролджєячсмитьбю. ",
        ru: "йцукенгшщзхъфывапролджэячсмитьбю. "
    },
    records: {},
    results: [],
    timerCurrent: 0,
    typingText: {
        en: "q we",
        ua: "хвацький юшковар філіп щодня готує сім'ї вечерю з жаб.",
        ru: "съешь же ещё этих мягких французских булок, да выпей чаю."
    },
    // currentUser
    userCurrent: {
        id: 'id-User',
        restID: -1,
        name: 'User',
        score: 0
    },
    // savedUser
    userSaved: false,
    url: 'http://fecore.net.ua/rest/'
};
"use strict";

init();
// addListeners();
"use strict";

var timer = {
    startTime: 0,
    stopTime: 0,
    interval: 0,

    start: function start() {
        this.startTime = new Date();
        this.interval = setInterval(function () {
            var tmp = new Date();
            var delta = tmp.getTime() - timer.startTime.getTime();
            var sec = dateFormat(delta);
            showTimer(sec);
        }, 40);
    },

    stop: function stop() {
        this.stopTime = new Date();
        var delta = this.stopTime.getTime() - this.startTime.getTime();
        var sec = dateFormat(delta);
        showTimer(sec);
        clearInterval(this.interval);
        this.startTime = 0;
        this.stopTime = 0;
        this.interval = 0;
        return sec;
    }
};
'use strict';

function addListeners() {

    activeBtn();

    /* ======================== смена языка раскладки ====================== */
    languageButtons.addEventListener('click', resetKeyboardLetters);

    /* ============= добавить пользователя ====================== */
    sbmt.addEventListener('click', addUser);

    /* ============= показать скрытое окно для ввода текста ============= */
    btnShow.addEventListener('click', showTextArea);

    /* ============= добавить новый текст ============= */
    btnTextAdding.addEventListener('click', setNewPhrase);

    /* ========================= начинаем сравнение кликов клавиш с текстом ========== */
    beginButton.addEventListener('click', beginType);
}
'use strict';

function addUser(e) {
    // TODO сделать проверку на уникальность имени
    e.preventDefault();
    var name = user.value;
    sectionUser.style.display = 'none';
    userId = document.getElementById('id-User');
    userId.textContent = name;
    paintUserScore();
    appData.userCurrent.name = name;
    appData.userCurrent.score = userId.nextSibling.textContent;
    createREST(appData.userCurrent);
    save('thisUser', appData.userCurrent);
}
'use strict';

function beginType() {
    // beginType () flag = true  -> stopType() flag = false
    // appData.currentType.typing = true;

    // beginType() add listener -> stopType() remove listener
    document.addEventListener('keypress', checkKey);

    //
    removeListeners();

    // beginType () appData.timer.start -> stopType() appData.timer.stop
    // appData.timer.start = window.performance.now();
    // console.log(appData.timer.start);


    // array из строки для проверки - pop()
    var tmp = appData.currentSetting.setTypingText();
    appData.currentType.text = tmp.split('').reverse();
    // console.log(appData.currentType.text);

    //timer
    timer.start();

    // Errors - показать текущее состояние
    errors.textContent = appData.currentType.errors;

    modal.style.transform = 'translateY(-110%)';
    modalP.textContent = '';
}
'use strict';

function checkKey(event) {
    // event.key

    var length = appData.currentType.text.length;

    if (length > 0) {
        // console.log(appData.currentType.text);
        if (appData.currentType.text[length - 1] === event.key) {
            nextTypeSymbol();
            appData.currentType.text.pop();
            var last = appData.currentType.text.length;
            // console.log(tmp);
            lightButton(appData.currentType.text[last - 1]);
            if (length === 1) {
                stopType();
            }
        } else {
            ++appData.currentType.errors;
            errorTypeSymbol();
        }

        return true;
    }
    return 'Error: appData.currentType.text.length = ' + appData.currentType.text.length;
}
'use strict';

function removeListeners() {
    // console.log('remove listeners');

    /* ======================== смена языка раскладки ====================== */
    languageButtons.removeEventListener('click', resetKeyboardLetters);

    /* ============= добавить пользователя ====================== */
    sbmt.removeEventListener('click', addUser);

    /* ============= показать скрытое окно для ввода текста ============= */
    btnShow.removeEventListener('click', showTextArea);

    /* ============= добавить новый текст ============= */
    btnTextAdding.removeEventListener('click', setNewPhrase);

    /* ========================= начинаем сравнение кликов клавиш с текстом ========== */
    beginButton.removeEventListener('click', beginType);

    desactiveBtn();
}
'use strict';

function resetKeyboardLetters(e) {
    appData.currentSetting.lang = e.target.textContent;
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);
    Array.from(langBtns, function (elem) {
        return elem.classList.remove('lang-ctrls__btn--active');
    });
    e.target.classList.add('lang-ctrls__btn--active');
    fillTypableChars(typableChars, appData.currentSetting.setTypingText());
    hideTypeElements(typableChars, appData.currentSetting.setTypingText());
    // clear();

    var text = appData.currentSetting.setTypingText();
    // подсветка текущей буквы
    // console.log(text);
    lightButton(text[0]);
}
'use strict';

function stopType() {

    document.removeEventListener('keypress', checkKey);

    addListeners();

    //timer
    var resultTime = timer.stop().split(':');
    appData.timerCurrent = +resultTime[0] + +resultTime[1] / 1000;

    // Расчитать Score  и показать на странице,
    var currentTextLength = appData.typingText[appData.currentSetting.lang].length;
    var currentScore = getScore(appData.timerCurrent, currentTextLength);
    speed.textContent = currentScore;

    // сравнить Score, перезаписать результаты
    if (appData.currentType.errors === 0) {
        // userScore.score = scr > userScore.score ? scr : userScore.score;
        if (currentScore > appData.userCurrent.score) {
            appData.userCurrent.score = currentScore;
            // console.log(`${currentScore}`);
            getRESTIdUser();
            save('thisUser', appData.userCurrent);
            updateREST(appData.userCurrent);
        }
        userId.nextSibling.textContent = appData.userCurrent.score;
        // пройтись по списку проверить score , переместить
        updateListByScore();
    }

    // Модальное окно при завершении
    modal.style.transform = 'translateY(-25%)';
    modalP.textContent = 'Fin';

    // Показать Errors на странице и обнулить
    appData.currentType.errors = 0;

    restoreView();
}
"use strict";

// key =  'thisUser'

function load(key) {
    return JSON.parse(localStorage.getItem(key));
}
"use strict";

// key =  'thisUser'

function remove(key) {
    localStorage.removeItem(key);
    // localStorage.removeItem('thisUser');
}
"use strict";

// key =  'thisUser'

function save(key, obj) {
    localStorage.setItem(key, JSON.stringify(obj));
}
"use strict";

function Result() {
    this.time = 0;
    this.err = 0;
    this.errorsLetters = [];
}
'use strict';

function User() {
    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'User';
    var speed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

    this.name = name;
    this.speed = speed;
    this.result = new Result();
}
"use strict";

function UserResult(name, score) {
    this.name = name;
    this.score = score;
}
"use strict";

function addtoResultsArray(array, object) {
    for (var key in object) {
        if (object.hasOwnProperty(key)) {
            array.push(new UserResult(key, object[key]));
        }
    }
}
"use strict";

function arrayToObj(arr) {
    var obj = {};
    arr.map(function (elem) {
        return obj[elem["name"]] = elem["score"];
    });
    return obj;
}
'use strict';

function dateFormat(digits) {
    var msc = void 0,
        sec = void 0,
        min = void 0,
        hour = void 0;

    msc = Math.floor(digits % 1000);
    if (msc > 99) {
        msc = ':' + msc;
    } else if (msc > 9) {
        msc = ':' + '0' + msc;
    } else {
        msc = ':' + '00' + msc;
    }

    sec = Math.floor(digits / 1000 % 60);
    if (sec > 9) {
        sec = sec;
    } else {
        sec = '0' + sec;
    }

    return sec + msc;
}
"use strict";

function filterTopResult(arr) {
    var tmp = [];
    if (arr.length > 10) {
        tmp = arr.slice(0, 9);
        return tmp;
    }
    return arr;
}
"use strict";

function getScore(sec, textLength) {
    return Math.round(60 * textLength / sec);
}
'use strict';

function init() {
    addListeners();
    showModal();
    /*
    задаем дефолтные значения выбору языка
     */
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);

    /*
      добавляет текст в  typable
    */
    fillTypableChars(typableChars, appData.currentSetting.setTypingText());
    hideTypeElements(typableChars, appData.currentSetting.setTypingText());
    console.log('1 ' + appData.userCurrent.score);
    appData.userSaved = load('thisUser');

    if (appData.userSaved) {
        appData.userCurrent.id = appData.userSaved.id;
        appData.userCurrent.name = appData.userSaved.name;
        appData.userCurrent.score = appData.userSaved.score;
        console.log('2 ' + appData.userCurrent.score);
        appData.userCurrent.restID = appData.userSaved.restID;
        appData.records[appData.userCurrent.name] = appData.userCurrent.score;
        sbmt.removeEventListener('click', addUser);
        hideElem(sectionUser);
        appData.userCurrent.id = 'id-' + appData.userCurrent.name;
        getRESTIdUser();
    } else {
        console.log('3 ' + appData.userCurrent.score);
        appData.records[appData.userCurrent.name] = appData.userCurrent.score;
    }

    readREST();
}
"use strict";

function setIdRESTByName(arr) {
    arr.map(function (elem) {
        if (elem.name === appData.userCurrent.name) {
            appData.userCurrent.restID = elem["id"];
        }
    });
}
"use strict";

function sortByScore(arr) {
    arr.sort(function (a, b) {
        return b.score - a.score;
    });
}
"use strict";

function createREST(obj) {
    var createUrl = appData.url + "?action=1&name=" + obj.name + "&score=" + obj.score;
    console.log(createUrl);

    fetch(createUrl, {
        metod: "post"
    }).catch(function (error) {
        console.log('CreateREST: Fetch Error :-S', error);
    });
}
"use strict";

function deleteREST(obj) {
    var updateUrl = appData.url + "?action=3$id=" + obj.restID;
    // http://fecore.net.ua/rest/?action=3$id=63
    // http://fecore.net.ua/rest/?action=3&id=63
    fetch(updateUrl, {
        metod: "post"
    }).catch(function (error) {
        console.log('deleteREST: Fetch Error : ', error);
    });
}
"use strict";

function getRESTIdUser() {
    fetch(appData.url, {
        metod: "get"
    }).then(function (response) {
        var json = response.json();
        if (response.status >= 200 && response.status < 300) {
            return json;
        } else {
            return error;
        }
    }).then(function (json) {
        setIdRESTByName(json);
    }).catch(function (error) {
        console.log('Fetch Error :-S', error);
    });
}
"use strict";

function readREST() {
    fetch(appData.url, {
        metod: "get"
    }).then(function (response) {
        var json = response.json();
        if (response.status >= 200 && response.status < 300) {
            return json;
        } else {
            return error;
        }
    }).then(function (json) {
        var tmp = arrayToObj(json);
        // если список больше 10, то сохраним userRec
        var userRec = appData.records;
        appData.records = Object.assign(appData.records, tmp);

        addtoResultsArray(appData.results, appData.records);
        sortByScore(appData.results);
        // получить список максимум из 10-ти топ результатов
        filterTopResult(appData.results);

        appData.records = Object.assign(appData.records, userRec);
        sortByScore(appData.results);

        appData.results.map(function (elem) {
            return addToScoreList(elem.name, elem.score, userListParent);
        });
        // console.log('appData.userCurrent.id = ', appData.userCurrent.id);
        userId = document.getElementById(appData.userCurrent.id);
        paintUserScore();
    }).catch(function (error) {
        console.log('Fetch Error :-S', error);
    });
}
"use strict";

function updateREST(obj) {

    var updateUrl = appData.url + "?action=2&id=" + obj.restID + "&name=" + obj.name + "&score=" + obj.score;
    console.log(updateUrl);
    fetch(updateUrl, {
        metod: "post"
    }).catch(function (error) {
        console.log('updateREST: Fetch Error : ', error);
    });
}
"use strict";

function activeBtn() {
    languageButtons.style.opacity = 1;
    sbmt.style.opacity = 1;
    btnShow.style.opacity = 1;
    btnTextAdding.style.opacity = 1;
    beginButton.style.opacity = 1;
}
'use strict';

// addToList
function addToScoreList(name, score, parent) {
    var li = document.createElement('li');
    var pName = document.createElement('p');
    var pScore = document.createElement('p');
    li.className = 'user-list__item';
    pName.className = 'user-list__name';
    pName.id = 'id-' + name;
    pScore.className = 'user-list__score';
    pName.textContent = name;
    pScore.textContent = score;
    li.appendChild(pName);
    li.appendChild(pScore);
    parent.appendChild(li);
}
"use strict";

function desactiveBtn() {
    languageButtons.style.opacity = 0.5;
    sbmt.style.opacity = 0.5;
    btnShow.style.opacity = 0.5;
    btnTextAdding.style.opacity = 0.5;
    beginButton.style.opacity = 0.5;
}
'use strict';

function errorTypeSymbol() {
    typableChars[appData.currentType.position].classList.add('typable__char--error');
    errors.textContent = appData.currentType.errors;
}
"use strict";

/*
 Заполнение TYPABLE AREA текстом для набора
 */
function fillTypableChars(arr, str) {
  Array.from(arr, function (elem, i) {
    return elem.textContent = str[i];
  });
}
'use strict';

/*
   hideTextArea, modal
 */
function hideElem(elem) {
    elem.style.display = 'none';
}
'use strict';

/*
  Скрытие элементов без текста
 */

function hideTypeElements(arr, str) {
    Array.from(arr, function (elem, i) {
        if (i < str.length) {
            elem.classList.remove('hide');
            elem.textContent = str[i];
        } else {
            elem.classList.add('hide');
        }
        elem.classListadd = 'hide';
    });
}
'use strict';

/*
   Подсветка клавиатуры: клавиша, которую следует нажать.
 */

function lightButton(charText) {
    Array.from(keyboardButtons, function (elem) {
        if (elem.classList.contains('keyboard__btn--active')) {
            elem.classList.remove('keyboard__btn--active');
        }
        if (elem.textContent === charText) {
            elem.classList.add('keyboard__btn--active');
        }
    });
}
'use strict';

function nextTypeSymbol() {
    // область набора
    // console.log(typableChars[appData.currentType.position].textContent);
    typableChars[appData.currentType.position].classList.add('typable__char--success');
    typableChars[appData.currentType.position].classList.remove('typable__char--current');
    typableChars[++appData.currentType.position].classList.add('typable__char--current');

    // область клавиатуры

}
"use strict";

function paintUserScore() {
    userId.style.color = "#03A9F4";
}
'use strict';

function restoreView() {
    appData.currentType.position = 0;
    // remove old
    Array.from(keyboardButtons, function (elem) {
        elem.classList.remove('keyboard__btn--active');
        // elem.classList.remove('keyboard__btn--active');
    });
    Array.from(typableChars, function (elem) {
        elem.classList.remove('typable__char--error');
        elem.classList.remove('typable__char--success');
        elem.classList.remove('typable__char--current');
    });
    // default
    typableChars[0].classList.add('typable__char--current');
    // let currentChar = appData.typingText[appData.currentSetting.lang];
    // console.log()
    lightButton(appData.typingText[appData.currentSetting.lang][0]);
    // keyboardButtons[0].classList.add('keyboard__btn--active');
}
"use strict";

/*
  Запонение клавиатруы символами выбранного языка
 */

function setKeyboardLetters(language, buttons) {
    for (var i = 0, limit = buttons.length; i < limit; i = i + 1) {
        buttons[i].textContent = language[i];
    }
}
'use strict';

function setNewPhrase(event) {
    event.preventDefault();
    console.log('setNewPhrase');
    var lng = 'en';

    Array.from(radioLang, function (elem) {
        if (elem.checked) {
            lng = elem.value;
        }
    });

    appData.typingText[lng] = elemTextArea.value.toLocaleLowerCase();

    hideElem(wrpTextArea);

    /* ================== меняем раскладку клавиатуры ================*/
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);
    /* =================  добавляет текст в  typable ====================== */
    var text = appData.currentSetting.setTypingText();

    // подсветка текущей буквы
    lightButton(text[0]);

    fillTypableChars(typableChars, text);
    hideTypeElements(typableChars, text);
}
'use strict';

function showElem(elem) {
    elem.style.display = 'block';
}
'use strict';

function showModal() {
    modal.style.transform = 'translateY(-25%)';
    modalP.textContent = 'PRESS BUTTON "START TYPE"';
}
"use strict";

function showTextArea() {
  showElem(wrpTextArea);
}
"use strict";

function showTimer(txt) {
    clock.textContent = txt;
}
'use strict';

function updateListByScore() {
    // console.log('updateListByScore');
    var userListScores = document.querySelectorAll('.user-list__item');
    var tmp = Array.from(userListScores);
    tmp.sort(function (a, b) {
        return b.lastChild.textContent - a.lastChild.textContent;
    });
    Array.from(userListScores, function (elem) {
        return elem.remove();
    });
    tmp.map(function (elem) {
        return userListParent.appendChild(elem);
    });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbEVsZW1lbnRzLmpzIiwiYXBwRGF0YS5qcyIsImFwcFN0YXJ0LmpzIiwidGltZXIuanMiLCJDT05UUk9MTEVSL2FkZExpc3RlbmVycy5qcyIsIkNPTlRST0xMRVIvYWRkVXNlci5qcyIsIkNPTlRST0xMRVIvYmVnaW5UeXBlLmpzIiwiQ09OVFJPTExFUi9jaGVja0tleS5qcyIsIkNPTlRST0xMRVIvcmVtb3ZlTGlzdGVuZXJzLmpzIiwiQ09OVFJPTExFUi9yZXNldEtleWJvYXJkTGV0dGVycy5qcyIsIkNPTlRST0xMRVIvc3RvcFR5cGUuanMiLCJMT0NBTFNUT1JBR0UvbG9hZC5qcyIsIkxPQ0FMU1RPUkFHRS9yZW1vdmUuanMiLCJMT0NBTFNUT1JBR0Uvc2F2ZS5qcyIsIk1PREVML1Jlc3VsdC5qcyIsIk1PREVML1VzZXIuanMiLCJNT0RFTC9Vc2VyUmVzdWx0LmpzIiwiTU9ERUwvYWRkdG9SZXN1bHRzQXJyYXkuanMiLCJNT0RFTC9hcnJheVRvT2JqLmpzIiwiTU9ERUwvZGF0ZUZvcm1hdC5qcyIsIk1PREVML2ZpbHRlclRvcFJlc3VsdC5qcyIsIk1PREVML2dldFNjb3JlLmpzIiwiTU9ERUwvaW5pdC5qcyIsIk1PREVML3NldElkUkVTVEJ5TmFtZS5qcyIsIk1PREVML3NvcnRCeVNjb3JlLmpzIiwiUkVTVC9jcmVhdGVSRVNULmpzIiwiUkVTVC9kZWxldGVSRVNULmpzIiwiUkVTVC9nZXRSRVNUSWRVc2VyLmpzIiwiUkVTVC9yZWFkUkVTVC5qcyIsIlJFU1QvdXBkYXRlUkVTVC5qcyIsIlZJRVcvYWN0aXZlQnRuLmpzIiwiVklFVy9hZGRUb1Njb3JlTGlzdC5qcyIsIlZJRVcvZGVzYWN0aXZlQnRuLmpzIiwiVklFVy9lcnJvclR5cGVTeW1ib2wuanMiLCJWSUVXL2ZpbGxUeXBhYmxlQ2hhcnMuanMiLCJWSUVXL2hpZGVFbGVtLmpzIiwiVklFVy9oaWRlVHlwZUVsZW1lbnRzLmpzIiwiVklFVy9saWdodG5CdXR0b24uanMiLCJWSUVXL25leHRUeXBlU3ltYm9sLmpzIiwiVklFVy9wYWludFVzZXJTY29yZS5qcyIsIlZJRVcvcmVzdG9yZVZpZXcuanMiLCJWSUVXL3NldEtleWJvYXJkTGV0dGVycy5qcyIsIlZJRVcvc2V0TmV3UGhyYXNlLmpzIiwiVklFVy9zaG93RWxlbS5qcyIsIlZJRVcvc2hvd01vZGFsLmpzIiwiVklFVy9zaG93VGV4dEFyZWEuanMiLCJWSUVXL3Nob3dUaW1lci5qcyIsIlZJRVcvdXBkYXRlTGlzdEJ5U2NvcmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLy8ga2V5Ym9hcmRcbnZhciBrZXlib2FyZEJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmtleWJvYXJkX19idG5cIik7XG5cbi8vIFRZUEFCTEUgQVJFQVxudmFyIHR5cGFibGVDaGFycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudHlwYWJsZV9fY2hhclwiKTtcblxuLy8gbGFuZyBidG5cbnZhciBsYW5nQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubGFuZy1jdHJsc19fYnRuXCIpO1xudmFyIGxhbmd1YWdlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubGFuZy1jdHJsc19fYm9keVwiKTtcblxuLy8gU1RBUlQgVFlQSU5HIGJ0blxudmFyIGJlZ2luQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiZWdpbkJ0blwiKTtcblxuLy8gVEVYVCBBUkVBXG4vLyB0ZXh0QXJlYSB3cmFwcGVyXG52YXIgd3JwVGV4dEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmlucHV0VGV4dFwiKTtcbi8vIHNob3cgdGV4dEFyZWFcbnZhciBidG5TaG93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJidG5UZXh0QXJlYVwiKTtcbi8vIGluc2VydCBmcm9tIHRleHRBcmVhXG52YXIgYnRuVGV4dEFkZGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYnRuQWRkVGV4dFwiKTtcbi8vIHJhZGlvXG52YXIgcmFkaW9MYW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbbmFtZT1cImxhbmdTZWxlY3RcIl0nKTtcbi8vIHRleHRhcmVhXG52YXIgZWxlbVRleHRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcInRleHRhcmVhXCIpO1xuXG4vLyBjbG9ja1xudmFyIGNsb2NrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jbG9ja19fdGltZVwiKTtcbi8vIHRpbWVyXG52YXIgc3BlZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3ZhbHVlLS1zcGVlZFwiKTtcbnZhciBlcnJvcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3ZhbHVlLS1lcnJvcnNcIik7XG5cbi8vIG1vZGFsXG52YXIgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsXCIpO1xudmFyIG1vZGFsUCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwgPiBwXCIpO1xuXG4vLyB1c2VyXG52YXIgdXNlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW5wdXRVc2Vyc05hbWVJRFwiKTtcbnZhciBzYm10ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdWJtaXRVc2Vyc05hbWVJRFwiKTtcbi8vIHVzZXItbGlzdFxuLy8gY29uc3QgdXNlckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnVzZXItbGlzdFwiKTtcbi8vIGxldCB1c2VyTGlzdFNjb3JlcztcbnZhciB1c2VyTGlzdFBhcmVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudXNlci1saXN0XCIpO1xuLy8gY29uc3QgdXNlck5hbWVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi51c2VyLWxpc3RfX25hbWVcIik7XG52YXIgc2VjdGlvblVzZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnVzZXJcIik7XG52YXIgdXNlcklkID0gdm9pZCAwOyAvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWQtVXNlcicpOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcERhdGEgPSB7XG4gICAgY3VycmVudFNldHRpbmc6IHtcbiAgICAgICAgbGFuZzogJ2VuJyxcbiAgICAgICAgc2V0S2V5Ym9hcmQ6IGZ1bmN0aW9uIHNldEtleWJvYXJkKCkge1xuICAgICAgICAgICAgcmV0dXJuIGFwcERhdGEubGFuZ3VhZ2VbYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0VHlwaW5nVGV4dDogZnVuY3Rpb24gc2V0VHlwaW5nVGV4dCgpIHtcbiAgICAgICAgICAgIHJldHVybiBhcHBEYXRhLnR5cGluZ1RleHRbYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nXTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgY3VycmVudFR5cGU6IHtcbiAgICAgICAgdHlwZTogLTEsXG4gICAgICAgIHRleHQ6ICcnLFxuICAgICAgICBlcnJvcnM6IDAsXG4gICAgICAgIHBvc2l0aW9uOiAwXG4gICAgfSxcbiAgICBpbnRlcnZhbDogMCxcbiAgICBsYW5ndWFnZToge1xuICAgICAgICBlbjogXCJxd2VydHl1aW9wW11hc2RmZ2hqa2w7J3p4Y3Zibm0sLi8gXCIsXG4gICAgICAgIHVhOiBcItC50YbRg9C60LXQvdCz0YjRidC30YXRl9GE0ZbQstCw0L/RgNC+0LvQtNC20ZTRj9GH0YHQvNC40YLRjNCx0Y4uIFwiLFxuICAgICAgICBydTogXCLQudGG0YPQutC10L3Qs9GI0YnQt9GF0YrRhNGL0LLQsNC/0YDQvtC70LTQttGN0Y/Rh9GB0LzQuNGC0YzQsdGOLiBcIlxuICAgIH0sXG4gICAgcmVjb3Jkczoge30sXG4gICAgcmVzdWx0czogW10sXG4gICAgdGltZXJDdXJyZW50OiAwLFxuICAgIHR5cGluZ1RleHQ6IHtcbiAgICAgICAgZW46IFwicSB3ZVwiLFxuICAgICAgICB1YTogXCLRhdCy0LDRhtGM0LrQuNC5INGO0YjQutC+0LLQsNGAINGE0ZbQu9GW0L8g0YnQvtC00L3RjyDQs9C+0YLRg9GUINGB0ZbQvCfRlyDQstC10YfQtdGA0Y4g0Lcg0LbQsNCxLlwiLFxuICAgICAgICBydTogXCLRgdGK0LXRiNGMINC20LUg0LXRidGRINGN0YLQuNGFINC80Y/Qs9C60LjRhSDRhNGA0LDQvdGG0YPQt9GB0LrQuNGFINCx0YPQu9C+0LosINC00LAg0LLRi9C/0LXQuSDRh9Cw0Y4uXCJcbiAgICB9LFxuICAgIC8vIGN1cnJlbnRVc2VyXG4gICAgdXNlckN1cnJlbnQ6IHtcbiAgICAgICAgaWQ6ICdpZC1Vc2VyJyxcbiAgICAgICAgcmVzdElEOiAtMSxcbiAgICAgICAgbmFtZTogJ1VzZXInLFxuICAgICAgICBzY29yZTogMFxuICAgIH0sXG4gICAgLy8gc2F2ZWRVc2VyXG4gICAgdXNlclNhdmVkOiBmYWxzZSxcbiAgICB1cmw6ICdodHRwOi8vZmVjb3JlLm5ldC51YS9yZXN0Lydcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmluaXQoKTtcbi8vIGFkZExpc3RlbmVycygpOyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgdGltZXIgPSB7XG4gICAgc3RhcnRUaW1lOiAwLFxuICAgIHN0b3BUaW1lOiAwLFxuICAgIGludGVydmFsOiAwLFxuXG4gICAgc3RhcnQ6IGZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdG1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IHRtcC5nZXRUaW1lKCkgLSB0aW1lci5zdGFydFRpbWUuZ2V0VGltZSgpO1xuICAgICAgICAgICAgdmFyIHNlYyA9IGRhdGVGb3JtYXQoZGVsdGEpO1xuICAgICAgICAgICAgc2hvd1RpbWVyKHNlYyk7XG4gICAgICAgIH0sIDQwKTtcbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHZhciBkZWx0YSA9IHRoaXMuc3RvcFRpbWUuZ2V0VGltZSgpIC0gdGhpcy5zdGFydFRpbWUuZ2V0VGltZSgpO1xuICAgICAgICB2YXIgc2VjID0gZGF0ZUZvcm1hdChkZWx0YSk7XG4gICAgICAgIHNob3dUaW1lcihzZWMpO1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IDA7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmludGVydmFsID0gMDtcbiAgICAgICAgcmV0dXJuIHNlYztcbiAgICB9XG59OyIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gYWRkTGlzdGVuZXJzKCkge1xuXG4gICAgYWN0aXZlQnRuKCk7XG5cbiAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT0g0YHQvNC10L3QsCDRj9C30YvQutCwINGA0LDRgdC60LvQsNC00LrQuCA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgbGFuZ3VhZ2VCdXR0b25zLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVzZXRLZXlib2FyZExldHRlcnMpO1xuXG4gICAgLyogPT09PT09PT09PT09PSDQtNC+0LHQsNCy0LjRgtGMINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgc2JtdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFkZFVzZXIpO1xuXG4gICAgLyogPT09PT09PT09PT09PSDQv9C+0LrQsNC30LDRgtGMINGB0LrRgNGL0YLQvtC1INC+0LrQvdC+INC00LvRjyDQstCy0L7QtNCwINGC0LXQutGB0YLQsCA9PT09PT09PT09PT09ICovXG4gICAgYnRuU2hvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNob3dUZXh0QXJlYSk7XG5cbiAgICAvKiA9PT09PT09PT09PT09INC00L7QsdCw0LLQuNGC0Ywg0L3QvtCy0YvQuSDRgtC10LrRgdGCID09PT09PT09PT09PT0gKi9cbiAgICBidG5UZXh0QWRkaW5nLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2V0TmV3UGhyYXNlKTtcblxuICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PT0g0L3QsNGH0LjQvdCw0LXQvCDRgdGA0LDQstC90LXQvdC40LUg0LrQu9C40LrQvtCyINC60LvQsNCy0LjRiCDRgSDRgtC10LrRgdGC0L7QvCA9PT09PT09PT09ICovXG4gICAgYmVnaW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBiZWdpblR5cGUpO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gYWRkVXNlcihlKSB7XG4gICAgLy8gVE9ETyDRgdC00LXQu9Cw0YLRjCDQv9GA0L7QstC10YDQutGDINC90LAg0YPQvdC40LrQsNC70YzQvdC+0YHRgtGMINC40LzQtdC90LhcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdmFyIG5hbWUgPSB1c2VyLnZhbHVlO1xuICAgIHNlY3Rpb25Vc2VyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgdXNlcklkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lkLVVzZXInKTtcbiAgICB1c2VySWQudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHBhaW50VXNlclNjb3JlKCk7XG4gICAgYXBwRGF0YS51c2VyQ3VycmVudC5uYW1lID0gbmFtZTtcbiAgICBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlID0gdXNlcklkLm5leHRTaWJsaW5nLnRleHRDb250ZW50O1xuICAgIGNyZWF0ZVJFU1QoYXBwRGF0YS51c2VyQ3VycmVudCk7XG4gICAgc2F2ZSgndGhpc1VzZXInLCBhcHBEYXRhLnVzZXJDdXJyZW50KTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGJlZ2luVHlwZSgpIHtcbiAgICAvLyBiZWdpblR5cGUgKCkgZmxhZyA9IHRydWUgIC0+IHN0b3BUeXBlKCkgZmxhZyA9IGZhbHNlXG4gICAgLy8gYXBwRGF0YS5jdXJyZW50VHlwZS50eXBpbmcgPSB0cnVlO1xuXG4gICAgLy8gYmVnaW5UeXBlKCkgYWRkIGxpc3RlbmVyIC0+IHN0b3BUeXBlKCkgcmVtb3ZlIGxpc3RlbmVyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBjaGVja0tleSk7XG5cbiAgICAvL1xuICAgIHJlbW92ZUxpc3RlbmVycygpO1xuXG4gICAgLy8gYmVnaW5UeXBlICgpIGFwcERhdGEudGltZXIuc3RhcnQgLT4gc3RvcFR5cGUoKSBhcHBEYXRhLnRpbWVyLnN0b3BcbiAgICAvLyBhcHBEYXRhLnRpbWVyLnN0YXJ0ID0gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpO1xuICAgIC8vIGNvbnNvbGUubG9nKGFwcERhdGEudGltZXIuc3RhcnQpO1xuXG5cbiAgICAvLyBhcnJheSDQuNC3INGB0YLRgNC+0LrQuCDQtNC70Y8g0L/RgNC+0LLQtdGA0LrQuCAtIHBvcCgpXG4gICAgdmFyIHRtcCA9IGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0VHlwaW5nVGV4dCgpO1xuICAgIGFwcERhdGEuY3VycmVudFR5cGUudGV4dCA9IHRtcC5zcGxpdCgnJykucmV2ZXJzZSgpO1xuICAgIC8vIGNvbnNvbGUubG9nKGFwcERhdGEuY3VycmVudFR5cGUudGV4dCk7XG5cbiAgICAvL3RpbWVyXG4gICAgdGltZXIuc3RhcnQoKTtcblxuICAgIC8vIEVycm9ycyAtINC/0L7QutCw0LfQsNGC0Ywg0YLQtdC60YPRidC10LUg0YHQvtGB0YLQvtGP0L3QuNC1XG4gICAgZXJyb3JzLnRleHRDb250ZW50ID0gYXBwRGF0YS5jdXJyZW50VHlwZS5lcnJvcnM7XG5cbiAgICBtb2RhbC5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgtMTEwJSknO1xuICAgIG1vZGFsUC50ZXh0Q29udGVudCA9ICcnO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gY2hlY2tLZXkoZXZlbnQpIHtcbiAgICAvLyBldmVudC5rZXlcblxuICAgIHZhciBsZW5ndGggPSBhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQubGVuZ3RoO1xuXG4gICAgaWYgKGxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0KTtcbiAgICAgICAgaWYgKGFwcERhdGEuY3VycmVudFR5cGUudGV4dFtsZW5ndGggLSAxXSA9PT0gZXZlbnQua2V5KSB7XG4gICAgICAgICAgICBuZXh0VHlwZVN5bWJvbCgpO1xuICAgICAgICAgICAgYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0LnBvcCgpO1xuICAgICAgICAgICAgdmFyIGxhc3QgPSBhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2codG1wKTtcbiAgICAgICAgICAgIGxpZ2h0QnV0dG9uKGFwcERhdGEuY3VycmVudFR5cGUudGV4dFtsYXN0IC0gMV0pO1xuICAgICAgICAgICAgaWYgKGxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHN0b3BUeXBlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICArK2FwcERhdGEuY3VycmVudFR5cGUuZXJyb3JzO1xuICAgICAgICAgICAgZXJyb3JUeXBlU3ltYm9sKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuICdFcnJvcjogYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0Lmxlbmd0aCA9ICcgKyBhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQubGVuZ3RoO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gcmVtb3ZlTGlzdGVuZXJzKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCdyZW1vdmUgbGlzdGVuZXJzJyk7XG5cbiAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT0g0YHQvNC10L3QsCDRj9C30YvQutCwINGA0LDRgdC60LvQsNC00LrQuCA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgbGFuZ3VhZ2VCdXR0b25zLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVzZXRLZXlib2FyZExldHRlcnMpO1xuXG4gICAgLyogPT09PT09PT09PT09PSDQtNC+0LHQsNCy0LjRgtGMINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgc2JtdC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGFkZFVzZXIpO1xuXG4gICAgLyogPT09PT09PT09PT09PSDQv9C+0LrQsNC30LDRgtGMINGB0LrRgNGL0YLQvtC1INC+0LrQvdC+INC00LvRjyDQstCy0L7QtNCwINGC0LXQutGB0YLQsCA9PT09PT09PT09PT09ICovXG4gICAgYnRuU2hvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHNob3dUZXh0QXJlYSk7XG5cbiAgICAvKiA9PT09PT09PT09PT09INC00L7QsdCw0LLQuNGC0Ywg0L3QvtCy0YvQuSDRgtC10LrRgdGCID09PT09PT09PT09PT0gKi9cbiAgICBidG5UZXh0QWRkaW5nLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2V0TmV3UGhyYXNlKTtcblxuICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PT0g0L3QsNGH0LjQvdCw0LXQvCDRgdGA0LDQstC90LXQvdC40LUg0LrQu9C40LrQvtCyINC60LvQsNCy0LjRiCDRgSDRgtC10LrRgdGC0L7QvCA9PT09PT09PT09ICovXG4gICAgYmVnaW5CdXR0b24ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBiZWdpblR5cGUpO1xuXG4gICAgZGVzYWN0aXZlQnRuKCk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiByZXNldEtleWJvYXJkTGV0dGVycyhlKSB7XG4gICAgYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nID0gZS50YXJnZXQudGV4dENvbnRlbnQ7XG4gICAgc2V0S2V5Ym9hcmRMZXR0ZXJzKGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0S2V5Ym9hcmQoKSwga2V5Ym9hcmRCdXR0b25zKTtcbiAgICBBcnJheS5mcm9tKGxhbmdCdG5zLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdsYW5nLWN0cmxzX19idG4tLWFjdGl2ZScpO1xuICAgIH0pO1xuICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2xhbmctY3RybHNfX2J0bi0tYWN0aXZlJyk7XG4gICAgZmlsbFR5cGFibGVDaGFycyh0eXBhYmxlQ2hhcnMsIGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0VHlwaW5nVGV4dCgpKTtcbiAgICBoaWRlVHlwZUVsZW1lbnRzKHR5cGFibGVDaGFycywgYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCkpO1xuICAgIC8vIGNsZWFyKCk7XG5cbiAgICB2YXIgdGV4dCA9IGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0VHlwaW5nVGV4dCgpO1xuICAgIC8vINC/0L7QtNGB0LLQtdGC0LrQsCDRgtC10LrRg9GJ0LXQuSDQsdGD0LrQstGLXG4gICAgLy8gY29uc29sZS5sb2codGV4dCk7XG4gICAgbGlnaHRCdXR0b24odGV4dFswXSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBzdG9wVHlwZSgpIHtcblxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgY2hlY2tLZXkpO1xuXG4gICAgYWRkTGlzdGVuZXJzKCk7XG5cbiAgICAvL3RpbWVyXG4gICAgdmFyIHJlc3VsdFRpbWUgPSB0aW1lci5zdG9wKCkuc3BsaXQoJzonKTtcbiAgICBhcHBEYXRhLnRpbWVyQ3VycmVudCA9ICtyZXN1bHRUaW1lWzBdICsgK3Jlc3VsdFRpbWVbMV0gLyAxMDAwO1xuXG4gICAgLy8g0KDQsNGB0YfQuNGC0LDRgtGMIFNjb3JlICDQuCDQv9C+0LrQsNC30LDRgtGMINC90LAg0YHRgtGA0LDQvdC40YbQtSxcbiAgICB2YXIgY3VycmVudFRleHRMZW5ndGggPSBhcHBEYXRhLnR5cGluZ1RleHRbYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nXS5sZW5ndGg7XG4gICAgdmFyIGN1cnJlbnRTY29yZSA9IGdldFNjb3JlKGFwcERhdGEudGltZXJDdXJyZW50LCBjdXJyZW50VGV4dExlbmd0aCk7XG4gICAgc3BlZWQudGV4dENvbnRlbnQgPSBjdXJyZW50U2NvcmU7XG5cbiAgICAvLyDRgdGA0LDQstC90LjRgtGMIFNjb3JlLCDQv9C10YDQtdC30LDQv9C40YHQsNGC0Ywg0YDQtdC30YPQu9GM0YLQsNGC0YtcbiAgICBpZiAoYXBwRGF0YS5jdXJyZW50VHlwZS5lcnJvcnMgPT09IDApIHtcbiAgICAgICAgLy8gdXNlclNjb3JlLnNjb3JlID0gc2NyID4gdXNlclNjb3JlLnNjb3JlID8gc2NyIDogdXNlclNjb3JlLnNjb3JlO1xuICAgICAgICBpZiAoY3VycmVudFNjb3JlID4gYXBwRGF0YS51c2VyQ3VycmVudC5zY29yZSkge1xuICAgICAgICAgICAgYXBwRGF0YS51c2VyQ3VycmVudC5zY29yZSA9IGN1cnJlbnRTY29yZTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGAke2N1cnJlbnRTY29yZX1gKTtcbiAgICAgICAgICAgIGdldFJFU1RJZFVzZXIoKTtcbiAgICAgICAgICAgIHNhdmUoJ3RoaXNVc2VyJywgYXBwRGF0YS51c2VyQ3VycmVudCk7XG4gICAgICAgICAgICB1cGRhdGVSRVNUKGFwcERhdGEudXNlckN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIHVzZXJJZC5uZXh0U2libGluZy50ZXh0Q29udGVudCA9IGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmU7XG4gICAgICAgIC8vINC/0YDQvtC50YLQuNGB0Ywg0L/QviDRgdC/0LjRgdC60YMg0L/RgNC+0LLQtdGA0LjRgtGMIHNjb3JlICwg0L/QtdGA0LXQvNC10YHRgtC40YLRjFxuICAgICAgICB1cGRhdGVMaXN0QnlTY29yZSgpO1xuICAgIH1cblxuICAgIC8vINCc0L7QtNCw0LvRjNC90L7QtSDQvtC60L3QviDQv9GA0Lgg0LfQsNCy0LXRgNGI0LXQvdC40LhcbiAgICBtb2RhbC5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgtMjUlKSc7XG4gICAgbW9kYWxQLnRleHRDb250ZW50ID0gJ0Zpbic7XG5cbiAgICAvLyDQn9C+0LrQsNC30LDRgtGMIEVycm9ycyDQvdCwINGB0YLRgNCw0L3QuNGG0LUg0Lgg0L7QsdC90YPQu9C40YLRjFxuICAgIGFwcERhdGEuY3VycmVudFR5cGUuZXJyb3JzID0gMDtcblxuICAgIHJlc3RvcmVWaWV3KCk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIGtleSA9ICAndGhpc1VzZXInXG5cbmZ1bmN0aW9uIGxvYWQoa2V5KSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIGtleSA9ICAndGhpc1VzZXInXG5cbmZ1bmN0aW9uIHJlbW92ZShrZXkpIHtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgIC8vIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0aGlzVXNlcicpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG4vLyBrZXkgPSAgJ3RoaXNVc2VyJ1xuXG5mdW5jdGlvbiBzYXZlKGtleSwgb2JqKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShvYmopKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gUmVzdWx0KCkge1xuICAgIHRoaXMudGltZSA9IDA7XG4gICAgdGhpcy5lcnIgPSAwO1xuICAgIHRoaXMuZXJyb3JzTGV0dGVycyA9IFtdO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gVXNlcigpIHtcbiAgICB2YXIgbmFtZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJ1VzZXInO1xuICAgIHZhciBzcGVlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMDtcblxuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zcGVlZCA9IHNwZWVkO1xuICAgIHRoaXMucmVzdWx0ID0gbmV3IFJlc3VsdCgpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBVc2VyUmVzdWx0KG5hbWUsIHNjb3JlKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnNjb3JlID0gc2NvcmU7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGFkZHRvUmVzdWx0c0FycmF5KGFycmF5LCBvYmplY3QpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7XG4gICAgICAgIGlmIChvYmplY3QuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgYXJyYXkucHVzaChuZXcgVXNlclJlc3VsdChrZXksIG9iamVjdFtrZXldKSk7XG4gICAgICAgIH1cbiAgICB9XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGFycmF5VG9PYmooYXJyKSB7XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgIGFyci5tYXAoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgcmV0dXJuIG9ialtlbGVtW1wibmFtZVwiXV0gPSBlbGVtW1wic2NvcmVcIl07XG4gICAgfSk7XG4gICAgcmV0dXJuIG9iajtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGRhdGVGb3JtYXQoZGlnaXRzKSB7XG4gICAgdmFyIG1zYyA9IHZvaWQgMCxcbiAgICAgICAgc2VjID0gdm9pZCAwLFxuICAgICAgICBtaW4gPSB2b2lkIDAsXG4gICAgICAgIGhvdXIgPSB2b2lkIDA7XG5cbiAgICBtc2MgPSBNYXRoLmZsb29yKGRpZ2l0cyAlIDEwMDApO1xuICAgIGlmIChtc2MgPiA5OSkge1xuICAgICAgICBtc2MgPSAnOicgKyBtc2M7XG4gICAgfSBlbHNlIGlmIChtc2MgPiA5KSB7XG4gICAgICAgIG1zYyA9ICc6JyArICcwJyArIG1zYztcbiAgICB9IGVsc2Uge1xuICAgICAgICBtc2MgPSAnOicgKyAnMDAnICsgbXNjO1xuICAgIH1cblxuICAgIHNlYyA9IE1hdGguZmxvb3IoZGlnaXRzIC8gMTAwMCAlIDYwKTtcbiAgICBpZiAoc2VjID4gOSkge1xuICAgICAgICBzZWMgPSBzZWM7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2VjID0gJzAnICsgc2VjO1xuICAgIH1cblxuICAgIHJldHVybiBzZWMgKyBtc2M7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGZpbHRlclRvcFJlc3VsdChhcnIpIHtcbiAgICB2YXIgdG1wID0gW107XG4gICAgaWYgKGFyci5sZW5ndGggPiAxMCkge1xuICAgICAgICB0bXAgPSBhcnIuc2xpY2UoMCwgOSk7XG4gICAgICAgIHJldHVybiB0bXA7XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGdldFNjb3JlKHNlYywgdGV4dExlbmd0aCkge1xuICAgIHJldHVybiBNYXRoLnJvdW5kKDYwICogdGV4dExlbmd0aCAvIHNlYyk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBpbml0KCkge1xuICAgIGFkZExpc3RlbmVycygpO1xuICAgIHNob3dNb2RhbCgpO1xuICAgIC8qXG4gICAg0LfQsNC00LDQtdC8INC00LXRhNC+0LvRgtC90YvQtSDQt9C90LDRh9C10L3QuNGPINCy0YvQsdC+0YDRgyDRj9C30YvQutCwXG4gICAgICovXG4gICAgc2V0S2V5Ym9hcmRMZXR0ZXJzKGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0S2V5Ym9hcmQoKSwga2V5Ym9hcmRCdXR0b25zKTtcblxuICAgIC8qXG4gICAgICDQtNC+0LHQsNCy0LvRj9C10YIg0YLQtdC60YHRgiDQsiAgdHlwYWJsZVxuICAgICovXG4gICAgZmlsbFR5cGFibGVDaGFycyh0eXBhYmxlQ2hhcnMsIGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0VHlwaW5nVGV4dCgpKTtcbiAgICBoaWRlVHlwZUVsZW1lbnRzKHR5cGFibGVDaGFycywgYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCkpO1xuICAgIGNvbnNvbGUubG9nKCcxICcgKyBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlKTtcbiAgICBhcHBEYXRhLnVzZXJTYXZlZCA9IGxvYWQoJ3RoaXNVc2VyJyk7XG5cbiAgICBpZiAoYXBwRGF0YS51c2VyU2F2ZWQpIHtcbiAgICAgICAgYXBwRGF0YS51c2VyQ3VycmVudC5pZCA9IGFwcERhdGEudXNlclNhdmVkLmlkO1xuICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50Lm5hbWUgPSBhcHBEYXRhLnVzZXJTYXZlZC5uYW1lO1xuICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlID0gYXBwRGF0YS51c2VyU2F2ZWQuc2NvcmU7XG4gICAgICAgIGNvbnNvbGUubG9nKCcyICcgKyBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlKTtcbiAgICAgICAgYXBwRGF0YS51c2VyQ3VycmVudC5yZXN0SUQgPSBhcHBEYXRhLnVzZXJTYXZlZC5yZXN0SUQ7XG4gICAgICAgIGFwcERhdGEucmVjb3Jkc1thcHBEYXRhLnVzZXJDdXJyZW50Lm5hbWVdID0gYXBwRGF0YS51c2VyQ3VycmVudC5zY29yZTtcbiAgICAgICAgc2JtdC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGFkZFVzZXIpO1xuICAgICAgICBoaWRlRWxlbShzZWN0aW9uVXNlcik7XG4gICAgICAgIGFwcERhdGEudXNlckN1cnJlbnQuaWQgPSAnaWQtJyArIGFwcERhdGEudXNlckN1cnJlbnQubmFtZTtcbiAgICAgICAgZ2V0UkVTVElkVXNlcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCczICcgKyBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlKTtcbiAgICAgICAgYXBwRGF0YS5yZWNvcmRzW2FwcERhdGEudXNlckN1cnJlbnQubmFtZV0gPSBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlO1xuICAgIH1cblxuICAgIHJlYWRSRVNUKCk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIHNldElkUkVTVEJ5TmFtZShhcnIpIHtcbiAgICBhcnIubWFwKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGlmIChlbGVtLm5hbWUgPT09IGFwcERhdGEudXNlckN1cnJlbnQubmFtZSkge1xuICAgICAgICAgICAgYXBwRGF0YS51c2VyQ3VycmVudC5yZXN0SUQgPSBlbGVtW1wiaWRcIl07XG4gICAgICAgIH1cbiAgICB9KTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gc29ydEJ5U2NvcmUoYXJyKSB7XG4gICAgYXJyLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgIH0pO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBjcmVhdGVSRVNUKG9iaikge1xuICAgIHZhciBjcmVhdGVVcmwgPSBhcHBEYXRhLnVybCArIFwiP2FjdGlvbj0xJm5hbWU9XCIgKyBvYmoubmFtZSArIFwiJnNjb3JlPVwiICsgb2JqLnNjb3JlO1xuICAgIGNvbnNvbGUubG9nKGNyZWF0ZVVybCk7XG5cbiAgICBmZXRjaChjcmVhdGVVcmwsIHtcbiAgICAgICAgbWV0b2Q6IFwicG9zdFwiXG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDcmVhdGVSRVNUOiBGZXRjaCBFcnJvciA6LVMnLCBlcnJvcik7XG4gICAgfSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGRlbGV0ZVJFU1Qob2JqKSB7XG4gICAgdmFyIHVwZGF0ZVVybCA9IGFwcERhdGEudXJsICsgXCI/YWN0aW9uPTMkaWQ9XCIgKyBvYmoucmVzdElEO1xuICAgIC8vIGh0dHA6Ly9mZWNvcmUubmV0LnVhL3Jlc3QvP2FjdGlvbj0zJGlkPTYzXG4gICAgLy8gaHR0cDovL2ZlY29yZS5uZXQudWEvcmVzdC8/YWN0aW9uPTMmaWQ9NjNcbiAgICBmZXRjaCh1cGRhdGVVcmwsIHtcbiAgICAgICAgbWV0b2Q6IFwicG9zdFwiXG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGVSRVNUOiBGZXRjaCBFcnJvciA6ICcsIGVycm9yKTtcbiAgICB9KTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gZ2V0UkVTVElkVXNlcigpIHtcbiAgICBmZXRjaChhcHBEYXRhLnVybCwge1xuICAgICAgICBtZXRvZDogXCJnZXRcIlxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBqc29uID0gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID49IDIwMCAmJiByZXNwb25zZS5zdGF0dXMgPCAzMDApIHtcbiAgICAgICAgICAgIHJldHVybiBqc29uO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yO1xuICAgICAgICB9XG4gICAgfSkudGhlbihmdW5jdGlvbiAoanNvbikge1xuICAgICAgICBzZXRJZFJFU1RCeU5hbWUoanNvbik7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBFcnJvciA6LVMnLCBlcnJvcik7XG4gICAgfSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIHJlYWRSRVNUKCkge1xuICAgIGZldGNoKGFwcERhdGEudXJsLCB7XG4gICAgICAgIG1ldG9kOiBcImdldFwiXG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIGpzb24gPSByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDMwMCkge1xuICAgICAgICAgICAgcmV0dXJuIGpzb247XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3I7XG4gICAgICAgIH1cbiAgICB9KS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgIHZhciB0bXAgPSBhcnJheVRvT2JqKGpzb24pO1xuICAgICAgICAvLyDQtdGB0LvQuCDRgdC/0LjRgdC+0Log0LHQvtC70YzRiNC1IDEwLCDRgtC+INGB0L7RhdGA0LDQvdC40LwgdXNlclJlY1xuICAgICAgICB2YXIgdXNlclJlYyA9IGFwcERhdGEucmVjb3JkcztcbiAgICAgICAgYXBwRGF0YS5yZWNvcmRzID0gT2JqZWN0LmFzc2lnbihhcHBEYXRhLnJlY29yZHMsIHRtcCk7XG5cbiAgICAgICAgYWRkdG9SZXN1bHRzQXJyYXkoYXBwRGF0YS5yZXN1bHRzLCBhcHBEYXRhLnJlY29yZHMpO1xuICAgICAgICBzb3J0QnlTY29yZShhcHBEYXRhLnJlc3VsdHMpO1xuICAgICAgICAvLyDQv9C+0LvRg9GH0LjRgtGMINGB0L/QuNGB0L7QuiDQvNCw0LrRgdC40LzRg9C8INC40LcgMTAt0YLQuCDRgtC+0L8g0YDQtdC30YPQu9GM0YLQsNGC0L7QslxuICAgICAgICBmaWx0ZXJUb3BSZXN1bHQoYXBwRGF0YS5yZXN1bHRzKTtcblxuICAgICAgICBhcHBEYXRhLnJlY29yZHMgPSBPYmplY3QuYXNzaWduKGFwcERhdGEucmVjb3JkcywgdXNlclJlYyk7XG4gICAgICAgIHNvcnRCeVNjb3JlKGFwcERhdGEucmVzdWx0cyk7XG5cbiAgICAgICAgYXBwRGF0YS5yZXN1bHRzLm1hcChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGFkZFRvU2NvcmVMaXN0KGVsZW0ubmFtZSwgZWxlbS5zY29yZSwgdXNlckxpc3RQYXJlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ2FwcERhdGEudXNlckN1cnJlbnQuaWQgPSAnLCBhcHBEYXRhLnVzZXJDdXJyZW50LmlkKTtcbiAgICAgICAgdXNlcklkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYXBwRGF0YS51c2VyQ3VycmVudC5pZCk7XG4gICAgICAgIHBhaW50VXNlclNjb3JlKCk7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBFcnJvciA6LVMnLCBlcnJvcik7XG4gICAgfSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIHVwZGF0ZVJFU1Qob2JqKSB7XG5cbiAgICB2YXIgdXBkYXRlVXJsID0gYXBwRGF0YS51cmwgKyBcIj9hY3Rpb249MiZpZD1cIiArIG9iai5yZXN0SUQgKyBcIiZuYW1lPVwiICsgb2JqLm5hbWUgKyBcIiZzY29yZT1cIiArIG9iai5zY29yZTtcbiAgICBjb25zb2xlLmxvZyh1cGRhdGVVcmwpO1xuICAgIGZldGNoKHVwZGF0ZVVybCwge1xuICAgICAgICBtZXRvZDogXCJwb3N0XCJcbiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3VwZGF0ZVJFU1Q6IEZldGNoIEVycm9yIDogJywgZXJyb3IpO1xuICAgIH0pO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBhY3RpdmVCdG4oKSB7XG4gICAgbGFuZ3VhZ2VCdXR0b25zLnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgIHNibXQuc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgYnRuU2hvdy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICBidG5UZXh0QWRkaW5nLnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgIGJlZ2luQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAxO1xufSIsIid1c2Ugc3RyaWN0JztcblxuLy8gYWRkVG9MaXN0XG5mdW5jdGlvbiBhZGRUb1Njb3JlTGlzdChuYW1lLCBzY29yZSwgcGFyZW50KSB7XG4gICAgdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgICB2YXIgcE5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgdmFyIHBTY29yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBsaS5jbGFzc05hbWUgPSAndXNlci1saXN0X19pdGVtJztcbiAgICBwTmFtZS5jbGFzc05hbWUgPSAndXNlci1saXN0X19uYW1lJztcbiAgICBwTmFtZS5pZCA9ICdpZC0nICsgbmFtZTtcbiAgICBwU2NvcmUuY2xhc3NOYW1lID0gJ3VzZXItbGlzdF9fc2NvcmUnO1xuICAgIHBOYW1lLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICBwU2NvcmUudGV4dENvbnRlbnQgPSBzY29yZTtcbiAgICBsaS5hcHBlbmRDaGlsZChwTmFtZSk7XG4gICAgbGkuYXBwZW5kQ2hpbGQocFNjb3JlKTtcbiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQobGkpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBkZXNhY3RpdmVCdG4oKSB7XG4gICAgbGFuZ3VhZ2VCdXR0b25zLnN0eWxlLm9wYWNpdHkgPSAwLjU7XG4gICAgc2JtdC5zdHlsZS5vcGFjaXR5ID0gMC41O1xuICAgIGJ0blNob3cuc3R5bGUub3BhY2l0eSA9IDAuNTtcbiAgICBidG5UZXh0QWRkaW5nLnN0eWxlLm9wYWNpdHkgPSAwLjU7XG4gICAgYmVnaW5CdXR0b24uc3R5bGUub3BhY2l0eSA9IDAuNTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGVycm9yVHlwZVN5bWJvbCgpIHtcbiAgICB0eXBhYmxlQ2hhcnNbYXBwRGF0YS5jdXJyZW50VHlwZS5wb3NpdGlvbl0uY2xhc3NMaXN0LmFkZCgndHlwYWJsZV9fY2hhci0tZXJyb3InKTtcbiAgICBlcnJvcnMudGV4dENvbnRlbnQgPSBhcHBEYXRhLmN1cnJlbnRUeXBlLmVycm9ycztcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuLypcbiDQl9Cw0L/QvtC70L3QtdC90LjQtSBUWVBBQkxFIEFSRUEg0YLQtdC60YHRgtC+0Lwg0LTQu9GPINC90LDQsdC+0YDQsFxuICovXG5mdW5jdGlvbiBmaWxsVHlwYWJsZUNoYXJzKGFyciwgc3RyKSB7XG4gIEFycmF5LmZyb20oYXJyLCBmdW5jdGlvbiAoZWxlbSwgaSkge1xuICAgIHJldHVybiBlbGVtLnRleHRDb250ZW50ID0gc3RyW2ldO1xuICB9KTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbi8qXG4gICBoaWRlVGV4dEFyZWEsIG1vZGFsXG4gKi9cbmZ1bmN0aW9uIGhpZGVFbGVtKGVsZW0pIHtcbiAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG4vKlxuICDQodC60YDRi9GC0LjQtSDRjdC70LXQvNC10L3RgtC+0LIg0LHQtdC3INGC0LXQutGB0YLQsFxuICovXG5cbmZ1bmN0aW9uIGhpZGVUeXBlRWxlbWVudHMoYXJyLCBzdHIpIHtcbiAgICBBcnJheS5mcm9tKGFyciwgZnVuY3Rpb24gKGVsZW0sIGkpIHtcbiAgICAgICAgaWYgKGkgPCBzdHIubGVuZ3RoKSB7XG4gICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgICAgIGVsZW0udGV4dENvbnRlbnQgPSBzdHJbaV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtLmNsYXNzTGlzdGFkZCA9ICdoaWRlJztcbiAgICB9KTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbi8qXG4gICDQn9C+0LTRgdCy0LXRgtC60LAg0LrQu9Cw0LLQuNCw0YLRg9GA0Ys6INC60LvQsNCy0LjRiNCwLCDQutC+0YLQvtGA0YPRjiDRgdC70LXQtNGD0LXRgiDQvdCw0LbQsNGC0YwuXG4gKi9cblxuZnVuY3Rpb24gbGlnaHRCdXR0b24oY2hhclRleHQpIHtcbiAgICBBcnJheS5mcm9tKGtleWJvYXJkQnV0dG9ucywgZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgaWYgKGVsZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdrZXlib2FyZF9fYnRuLS1hY3RpdmUnKSkge1xuICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdrZXlib2FyZF9fYnRuLS1hY3RpdmUnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbS50ZXh0Q29udGVudCA9PT0gY2hhclRleHQpIHtcbiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgna2V5Ym9hcmRfX2J0bi0tYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIG5leHRUeXBlU3ltYm9sKCkge1xuICAgIC8vINC+0LHQu9Cw0YHRgtGMINC90LDQsdC+0YDQsFxuICAgIC8vIGNvbnNvbGUubG9nKHR5cGFibGVDaGFyc1thcHBEYXRhLmN1cnJlbnRUeXBlLnBvc2l0aW9uXS50ZXh0Q29udGVudCk7XG4gICAgdHlwYWJsZUNoYXJzW2FwcERhdGEuY3VycmVudFR5cGUucG9zaXRpb25dLmNsYXNzTGlzdC5hZGQoJ3R5cGFibGVfX2NoYXItLXN1Y2Nlc3MnKTtcbiAgICB0eXBhYmxlQ2hhcnNbYXBwRGF0YS5jdXJyZW50VHlwZS5wb3NpdGlvbl0uY2xhc3NMaXN0LnJlbW92ZSgndHlwYWJsZV9fY2hhci0tY3VycmVudCcpO1xuICAgIHR5cGFibGVDaGFyc1srK2FwcERhdGEuY3VycmVudFR5cGUucG9zaXRpb25dLmNsYXNzTGlzdC5hZGQoJ3R5cGFibGVfX2NoYXItLWN1cnJlbnQnKTtcblxuICAgIC8vINC+0LHQu9Cw0YHRgtGMINC60LvQsNCy0LjQsNGC0YPRgNGLXG5cbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gcGFpbnRVc2VyU2NvcmUoKSB7XG4gICAgdXNlcklkLnN0eWxlLmNvbG9yID0gXCIjMDNBOUY0XCI7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiByZXN0b3JlVmlldygpIHtcbiAgICBhcHBEYXRhLmN1cnJlbnRUeXBlLnBvc2l0aW9uID0gMDtcbiAgICAvLyByZW1vdmUgb2xkXG4gICAgQXJyYXkuZnJvbShrZXlib2FyZEJ1dHRvbnMsIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgna2V5Ym9hcmRfX2J0bi0tYWN0aXZlJyk7XG4gICAgICAgIC8vIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgna2V5Ym9hcmRfX2J0bi0tYWN0aXZlJyk7XG4gICAgfSk7XG4gICAgQXJyYXkuZnJvbSh0eXBhYmxlQ2hhcnMsIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgndHlwYWJsZV9fY2hhci0tZXJyb3InKTtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCd0eXBhYmxlX19jaGFyLS1zdWNjZXNzJyk7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgndHlwYWJsZV9fY2hhci0tY3VycmVudCcpO1xuICAgIH0pO1xuICAgIC8vIGRlZmF1bHRcbiAgICB0eXBhYmxlQ2hhcnNbMF0uY2xhc3NMaXN0LmFkZCgndHlwYWJsZV9fY2hhci0tY3VycmVudCcpO1xuICAgIC8vIGxldCBjdXJyZW50Q2hhciA9IGFwcERhdGEudHlwaW5nVGV4dFthcHBEYXRhLmN1cnJlbnRTZXR0aW5nLmxhbmddO1xuICAgIC8vIGNvbnNvbGUubG9nKClcbiAgICBsaWdodEJ1dHRvbihhcHBEYXRhLnR5cGluZ1RleHRbYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nXVswXSk7XG4gICAgLy8ga2V5Ym9hcmRCdXR0b25zWzBdLmNsYXNzTGlzdC5hZGQoJ2tleWJvYXJkX19idG4tLWFjdGl2ZScpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG4vKlxuICDQl9Cw0L/QvtC90LXQvdC40LUg0LrQu9Cw0LLQuNCw0YLRgNGD0Ysg0YHQuNC80LLQvtC70LDQvNC4INCy0YvQsdGA0LDQvdC90L7Qs9C+INGP0LfRi9C60LBcbiAqL1xuXG5mdW5jdGlvbiBzZXRLZXlib2FyZExldHRlcnMobGFuZ3VhZ2UsIGJ1dHRvbnMpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgbGltaXQgPSBidXR0b25zLmxlbmd0aDsgaSA8IGxpbWl0OyBpID0gaSArIDEpIHtcbiAgICAgICAgYnV0dG9uc1tpXS50ZXh0Q29udGVudCA9IGxhbmd1YWdlW2ldO1xuICAgIH1cbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIHNldE5ld1BocmFzZShldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc29sZS5sb2coJ3NldE5ld1BocmFzZScpO1xuICAgIHZhciBsbmcgPSAnZW4nO1xuXG4gICAgQXJyYXkuZnJvbShyYWRpb0xhbmcsIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGlmIChlbGVtLmNoZWNrZWQpIHtcbiAgICAgICAgICAgIGxuZyA9IGVsZW0udmFsdWU7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGFwcERhdGEudHlwaW5nVGV4dFtsbmddID0gZWxlbVRleHRBcmVhLnZhbHVlLnRvTG9jYWxlTG93ZXJDYXNlKCk7XG5cbiAgICBoaWRlRWxlbSh3cnBUZXh0QXJlYSk7XG5cbiAgICAvKiA9PT09PT09PT09PT09PT09PT0g0LzQtdC90Y/QtdC8INGA0LDRgdC60LvQsNC00LrRgyDQutC70LDQstC40LDRgtGD0YDRiyA9PT09PT09PT09PT09PT09Ki9cbiAgICBzZXRLZXlib2FyZExldHRlcnMoYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRLZXlib2FyZCgpLCBrZXlib2FyZEJ1dHRvbnMpO1xuICAgIC8qID09PT09PT09PT09PT09PT09ICDQtNC+0LHQsNCy0LvRj9C10YIg0YLQtdC60YHRgiDQsiAgdHlwYWJsZSA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgdmFyIHRleHQgPSBhcHBEYXRhLmN1cnJlbnRTZXR0aW5nLnNldFR5cGluZ1RleHQoKTtcblxuICAgIC8vINC/0L7QtNGB0LLQtdGC0LrQsCDRgtC10LrRg9GJ0LXQuSDQsdGD0LrQstGLXG4gICAgbGlnaHRCdXR0b24odGV4dFswXSk7XG5cbiAgICBmaWxsVHlwYWJsZUNoYXJzKHR5cGFibGVDaGFycywgdGV4dCk7XG4gICAgaGlkZVR5cGVFbGVtZW50cyh0eXBhYmxlQ2hhcnMsIHRleHQpO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gc2hvd0VsZW0oZWxlbSkge1xuICAgIGVsZW0uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBzaG93TW9kYWwoKSB7XG4gICAgbW9kYWwuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoLTI1JSknO1xuICAgIG1vZGFsUC50ZXh0Q29udGVudCA9ICdQUkVTUyBCVVRUT04gXCJTVEFSVCBUWVBFXCInO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBzaG93VGV4dEFyZWEoKSB7XG4gIHNob3dFbGVtKHdycFRleHRBcmVhKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gc2hvd1RpbWVyKHR4dCkge1xuICAgIGNsb2NrLnRleHRDb250ZW50ID0gdHh0O1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gdXBkYXRlTGlzdEJ5U2NvcmUoKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ3VwZGF0ZUxpc3RCeVNjb3JlJyk7XG4gICAgdmFyIHVzZXJMaXN0U2NvcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnVzZXItbGlzdF9faXRlbScpO1xuICAgIHZhciB0bXAgPSBBcnJheS5mcm9tKHVzZXJMaXN0U2NvcmVzKTtcbiAgICB0bXAuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICByZXR1cm4gYi5sYXN0Q2hpbGQudGV4dENvbnRlbnQgLSBhLmxhc3RDaGlsZC50ZXh0Q29udGVudDtcbiAgICB9KTtcbiAgICBBcnJheS5mcm9tKHVzZXJMaXN0U2NvcmVzLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gZWxlbS5yZW1vdmUoKTtcbiAgICB9KTtcbiAgICB0bXAubWFwKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHJldHVybiB1c2VyTGlzdFBhcmVudC5hcHBlbmRDaGlsZChlbGVtKTtcbiAgICB9KTtcbn0iXX0=
