"use strict";

// keyboard
var keyboardButtons = document.querySelectorAll(".keyboard__btn");

// TYPABLE AREA
var typableChars = document.querySelectorAll(".typable__char");

// lang btn
var langBtns = document.querySelectorAll(".lang-ctrls__btn");
var languageButtons = document.querySelector(".lang-ctrls__body");

// START TYPING btn
var beginButton = document.getElementById("beginBtn");

// TEXT AREA
// textArea wrapper
var wrpTextArea = document.querySelector(".inputText");
// show textArea
var btnShow = document.getElementById("btnTextArea");
// insert from textArea
var btnTextAdding = document.getElementById("btnAddText");
// radio
var radioLang = document.querySelectorAll('input[name="langSelect"]');
// textarea
var elemTextArea = document.querySelector("textarea");

// clock
var clock = document.querySelector(".clock__time");
// timer
var speed = document.querySelector(".results__value--speed");
var errors = document.querySelector(".results__value--errors");

// modal
var modal = document.querySelector(".modal");
var modalP = document.querySelector(".modal > p");

// user
var user = document.getElementById("inputUsersNameID");
var sbmt = document.getElementById("submitUsersNameID");
// user-list
// const userList = document.querySelectorAll(".user-list");
// let userListScores;
var userListParent = document.querySelector(".user-list");
// const userNames = document.querySelectorAll(".user-list__name");
var sectionUser = document.querySelector(".user");
var userId = void 0; // document.getElementById('id-User');
'use strict';

var appData = {
    currentSetting: {
        lang: 'en',
        setKeyboard: function setKeyboard() {
            return appData.language[appData.currentSetting.lang];
        },
        setTypingText: function setTypingText() {
            return appData.typingText[appData.currentSetting.lang];
        }
    },
    currentType: {
        type: -1,
        text: '',
        errors: 0,
        position: 0
    },
    interval: 0,
    language: {
        en: "qwertyuiop[]asdfghjkl;'zxcvbnm,./ ",
        ua: "йцукенгшщзхїфівапролджєячсмитьбю. ",
        ru: "йцукенгшщзхъфывапролджэячсмитьбю. "
    },
    records: {},
    results: [],
    timerCurrent: 0,
    typingText: {
        en: "the quick brown fox jumps over the lazy dog.",
        ua: "хвацький юшковар філіп щодня готує сім'ї вечерю з жаб.",
        ru: "съешь же ещё этих мягких французских булок, да выпей чаю."
    },
    userCurrent: {
        id: 'id-User',
        restID: -1,
        name: 'User',
        score: 0
    },
    // savedUser
    userSaved: false,
    url: 'http://fecore.net.ua/api/'
};
"use strict";

init();
"use strict";

var timer = {
    startTime: 0,
    stopTime: 0,
    interval: 0,

    start: function start() {
        this.startTime = new Date();
        this.interval = setInterval(function () {
            var tmp = new Date();
            var delta = tmp.getTime() - timer.startTime.getTime();
            var sec = dateFormat(delta);
            showTimer(sec);
        }, 40);
    },

    stop: function stop() {
        this.stopTime = new Date();
        var delta = this.stopTime.getTime() - this.startTime.getTime();
        var sec = dateFormat(delta);
        showTimer(sec);
        clearInterval(this.interval);
        this.startTime = 0;
        this.stopTime = 0;
        this.interval = 0;
        return sec;
    }
};
'use strict';

function addListeners() {

    activeBtn();

    /* ======================== смена языка раскладки ====================== */
    languageButtons.addEventListener('click', resetKeyboardLetters);

    /* ============= добавить пользователя ====================== */
    sbmt.addEventListener('click', addUser);

    /* ============= показать скрытое окно для ввода текста ============= */
    btnShow.addEventListener('click', showTextArea);

    /* ============= добавить новый текст ============= */
    btnTextAdding.addEventListener('click', setNewPhrase);

    /* ========================= начинаем сравнение кликов клавиш с текстом ========== */
    beginButton.addEventListener('click', beginType);
}
'use strict';

function addUser(e) {
    // TODO сделать проверку на уникальность имени
    e.preventDefault();
    var name = user.value;
    sectionUser.style.display = 'none';
    userId = document.getElementById('id-User');
    userId.textContent = name;
    paintUserScore();
    appData.userCurrent.name = name;
    appData.userCurrent.score = userId.nextSibling.textContent;
    createREST(appData.userCurrent);
    save('thisUser', appData.userCurrent);
}
'use strict';

function beginType() {
    // beginType () flag = true  -> stopType() flag = false
    // appData.currentType.typing = true;

    // beginType() add listener -> stopType() remove listener
    document.addEventListener('keypress', checkKey);

    //
    removeListeners();

    // beginType () appData.timer.start -> stopType() appData.timer.stop
    // appData.timer.start = window.performance.now();
    // console.log(appData.timer.start);


    // array из строки для проверки - pop()
    var tmp = appData.currentSetting.setTypingText();
    appData.currentType.text = tmp.split('').reverse();
    // console.log(appData.currentType.text);

    //timer
    timer.start();

    // Errors - показать текущее состояние
    errors.textContent = appData.currentType.errors;

    modal.style.transform = 'translateY(-110%)';
    modalP.textContent = '';
}
'use strict';

function checkKey(event) {
    // event.key

    var length = appData.currentType.text.length;

    if (length > 0) {
        // console.log(appData.currentType.text);
        if (appData.currentType.text[length - 1] === event.key) {
            nextTypeSymbol();
            appData.currentType.text.pop();
            var last = appData.currentType.text.length;
            // console.log(tmp);
            lightButton(appData.currentType.text[last - 1]);
            if (length === 1) {
                stopType();
            }
        } else {
            ++appData.currentType.errors;
            errorTypeSymbol();
        }

        return true;
    }
    return 'Error: appData.currentType.text.length = ' + appData.currentType.text.length;
}
'use strict';

function removeListeners() {
    // console.log('remove listeners');

    /* ======================== смена языка раскладки ====================== */
    languageButtons.removeEventListener('click', resetKeyboardLetters);

    /* ============= добавить пользователя ====================== */
    sbmt.removeEventListener('click', addUser);

    /* ============= показать скрытое окно для ввода текста ============= */
    btnShow.removeEventListener('click', showTextArea);

    /* ============= добавить новый текст ============= */
    btnTextAdding.removeEventListener('click', setNewPhrase);

    /* ========================= начинаем сравнение кликов клавиш с текстом ========== */
    beginButton.removeEventListener('click', beginType);

    desactiveBtn();
}
'use strict';

function resetKeyboardLetters(e) {
    appData.currentSetting.lang = e.target.textContent;
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);
    Array.from(langBtns, function (elem) {
        return elem.classList.remove('lang-ctrls__btn--active');
    });
    e.target.classList.add('lang-ctrls__btn--active');
    fillTypableChars(typableChars, appData.currentSetting.setTypingText());
    hideTypeElements(typableChars, appData.currentSetting.setTypingText());
    // clear();

    var text = appData.currentSetting.setTypingText();
    // подсветка текущей буквы
    // console.log(text);
    lightButton(text[0]);
}
'use strict';

function stopType() {

    document.removeEventListener('keypress', checkKey);

    addListeners();

    //timer
    var resultTime = timer.stop().split(':');
    appData.timerCurrent = +resultTime[0] + +resultTime[1] / 1000;

    // Расчитать Score  и показать на странице,
    var currentTextLength = appData.typingText[appData.currentSetting.lang].length;
    var currentScore = getScore(appData.timerCurrent, currentTextLength);
    speed.textContent = currentScore;

    // сравнить Score, перезаписать результаты
    if (appData.currentType.errors === 0) {
        // userScore.score = scr > userScore.score ? scr : userScore.score;
        if (currentScore > appData.userCurrent.score) {
            appData.userCurrent.score = currentScore;
            // console.log(`${currentScore}`);
            getRESTIdUser();
            save('thisUser', appData.userCurrent);
            updateREST(appData.userCurrent);
        }
        userId.nextSibling.textContent = appData.userCurrent.score;
        // пройтись по списку проверить score , переместить
        updateListByScore();
    }

    // Модальное окно при завершении
    modal.style.transform = 'translateY(-25%)';
    modalP.textContent = 'Fin';

    // Показать Errors на странице и обнулить
    appData.currentType.errors = 0;

    restoreView();
}
"use strict";

// key =  'thisUser'

function load(key) {
    return JSON.parse(localStorage.getItem(key));
}
"use strict";

// key =  'thisUser'

function remove(key) {
    localStorage.removeItem(key);
    // localStorage.removeItem('thisUser');
}
"use strict";

// key =  'thisUser'

function save(key, obj) {
    localStorage.setItem(key, JSON.stringify(obj));
}
"use strict";

function Result() {
    this.time = 0;
    this.err = 0;
    this.errorsLetters = [];
}
'use strict';

function User() {
    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'User';
    var speed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

    this.name = name;
    this.speed = speed;
    this.result = new Result();
}
"use strict";

function UserResult(name, score) {
    this.name = name;
    this.score = score;
}
"use strict";

function addtoResultsArray(array, object) {
    for (var key in object) {
        if (object.hasOwnProperty(key)) {
            array.push(new UserResult(key, object[key]));
        }
    }
}
"use strict";

function arrayToObj(arr) {
    var obj = {};
    arr.map(function (elem) {
        return obj[elem["name"]] = elem["score"];
    });
    return obj;
}
'use strict';

function dateFormat(digits) {
    var msc = void 0,
        sec = void 0,
        min = void 0,
        hour = void 0;

    msc = Math.floor(digits % 1000);
    if (msc > 99) {
        msc = ':' + msc;
    } else if (msc > 9) {
        msc = ':' + '0' + msc;
    } else {
        msc = ':' + '00' + msc;
    }

    sec = Math.floor(digits / 1000 % 60);
    if (sec > 9) {
        sec = sec;
    } else {
        sec = '0' + sec;
    }

    return sec + msc;
}
"use strict";

function filterTopResult(arr) {
    var tmp = [];
    if (arr.length > 10) {
        tmp = arr.slice(0, 9);
        return tmp;
    }
    return arr;
}
"use strict";

function getScore(sec, textLength) {
    return Math.round(60 * textLength / sec);
}
'use strict';

function init() {
    addListeners();
    showModal();
    /*
    задаем дефолтные значения клавиатуре
     */
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);

    /*
      добавляет текст в  typable
    */
    fillTypableChars(typableChars, appData.currentSetting.setTypingText());
    hideTypeElements(typableChars, appData.currentSetting.setTypingText());
    // console.log('1 ' + appData.userCurrent.score );

    // подсветка текущей буквы
    lightButton(appData.typingText[appData.currentSetting.lang][0]);

    // local storage
    appData.userSaved = load('thisUser');

    if (appData.userSaved) {
        appData.userCurrent.id = appData.userSaved.id;
        appData.userCurrent.name = appData.userSaved.name;
        appData.userCurrent.score = appData.userSaved.score;
        // console.log('2 ' + appData.userCurrent.score );
        appData.userCurrent.restID = appData.userSaved.restID;
        appData.records[appData.userCurrent.name] = appData.userCurrent.score;
        sbmt.removeEventListener('click', addUser);
        hideElem(sectionUser);
        appData.userCurrent.id = 'id-' + appData.userCurrent.name;
        getRESTIdUser();
    } else {
        // console.log('3 ' + appData.userCurrent.score );
        appData.records[appData.userCurrent.name] = appData.userCurrent.score;
    }

    readREST();
}
"use strict";

function setIdRESTByName(arr) {
    arr.map(function (elem) {
        if (elem.name === appData.userCurrent.name) {
            appData.userCurrent.restID = elem["id"];
        }
    });
}
"use strict";

function sortByScore(arr) {
    arr.sort(function (a, b) {
        return b.score - a.score;
    });
}
'use strict';

function createREST(obj) {
    var createUrl = appData.url + '?action=1&name=' + obj.name + '&score=' + obj.score;
    console.log(createUrl);

    fetch(createUrl, {
        metod: "post",
        mode: 'cors',
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    }).catch(function (error) {
        console.log('CreateREST: Fetch Error :-S', error);
    });
}
"use strict";

function deleteREST(obj) {
    var updateUrl = appData.url + "?action=3$id=" + obj.restID;

    // http://fecore.net.ua/rest/?action=3&id=63

    fetch(updateUrl, {
        metod: "post"
    }).catch(function (error) {
        console.log('deleteREST: Fetch Error : ', error);
    });
}
'use strict';

function getRESTIdUser() {
    fetch(appData.url, {
        metod: "get",
        mode: 'cors',
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    }).then(function (response) {
        var json = response.json();
        if (response.status >= 200 && response.status < 300) {
            return json;
        } else {
            return error;
        }
    }).then(function (json) {
        setIdRESTByName(json);
    }).catch(function (error) {
        console.log('Fetch Error :-S', error);
    });
}
'use strict';

function readREST() {
    fetch(appData.url, {
        metod: "get",
        mode: 'cors',
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    }).then(function (response) {
        var json = response.json();
        if (response.status >= 200 && response.status < 300) {
            return json;
        } else {
            return error;
        }
    }).then(function (json) {
        var tmp = arrayToObj(json);
        // если список больше 10, то сохраним userRec
        var userRec = appData.records;
        appData.records = Object.assign(appData.records, tmp);

        addtoResultsArray(appData.results, appData.records);
        sortByScore(appData.results);
        // получить список максимум из 10-ти топ результатов
        filterTopResult(appData.results);

        appData.records = Object.assign(appData.records, userRec);
        sortByScore(appData.results);

        appData.results.map(function (elem) {
            return addToScoreList(elem.name, elem.score, userListParent);
        });
        // console.log('appData.userCurrent.id = ', appData.userCurrent.id);
        userId = document.getElementById(appData.userCurrent.id);
        paintUserScore();
    }).catch(function (error) {
        console.log('Fetch Error :-S', error);
    });
}
'use strict';

function updateREST(obj) {

    var updateUrl = appData.url + '?action=2&id=' + obj.restID + '&name=' + obj.name + '&score=' + obj.score;
    console.log(updateUrl);
    fetch(updateUrl, {
        metod: "post",
        mode: 'cors',
        headers: {
            'Access-Control-Allow-Origin': '*'
        }

    }).catch(function (error) {
        console.log('updateREST: Fetch Error : ', error);
    });
}
"use strict";

function activeBtn() {
    languageButtons.style.opacity = 1;
    sbmt.style.opacity = 1;
    btnShow.style.opacity = 1;
    btnTextAdding.style.opacity = 1;
    beginButton.style.opacity = 1;
}
'use strict';

// addToList
function addToScoreList(name, score, parent) {
    var li = document.createElement('li');
    var pName = document.createElement('p');
    var pScore = document.createElement('p');
    li.className = 'user-list__item';
    pName.className = 'user-list__name';
    pName.id = 'id-' + name;
    pScore.className = 'user-list__score';
    pName.textContent = name;
    pScore.textContent = score;
    li.appendChild(pName);
    li.appendChild(pScore);
    parent.appendChild(li);
}
"use strict";

function desactiveBtn() {
    languageButtons.style.opacity = 0.5;
    sbmt.style.opacity = 0.5;
    btnShow.style.opacity = 0.5;
    btnTextAdding.style.opacity = 0.5;
    beginButton.style.opacity = 0.5;
}
'use strict';

function errorTypeSymbol() {
    typableChars[appData.currentType.position].classList.add('typable__char--error');
    errors.textContent = appData.currentType.errors;
}
"use strict";

/*
 Заполнение TYPABLE AREA текстом для набора
 */
function fillTypableChars(arr, str) {
  Array.from(arr, function (elem, i) {
    return elem.textContent = str[i];
  });
}
'use strict';

/*
   hideTextArea, modal
 */
function hideElem(elem) {
    elem.style.display = 'none';
}
'use strict';

/*
  Скрытие элементов без текста
 */

function hideTypeElements(arr, str) {
    Array.from(arr, function (elem, i) {
        if (i < str.length) {
            elem.classList.remove('hide');
            elem.textContent = str[i];
        } else {
            elem.classList.add('hide');
        }
        elem.classListadd = 'hide';
    });
}
'use strict';

/*
   Подсветка клавиатуры: клавиша, которую следует нажать.
 */

function lightButton(charText) {
    Array.from(keyboardButtons, function (elem) {
        if (elem.classList.contains('keyboard__btn--active')) {
            elem.classList.remove('keyboard__btn--active');
        }
        if (elem.textContent === charText) {
            elem.classList.add('keyboard__btn--active');
        }
    });
}
'use strict';

function nextTypeSymbol() {
    // область набора
    // console.log(typableChars[appData.currentType.position].textContent);
    typableChars[appData.currentType.position].classList.add('typable__char--success');
    typableChars[appData.currentType.position].classList.remove('typable__char--current');
    typableChars[++appData.currentType.position].classList.add('typable__char--current');

    // область клавиатуры

}
"use strict";

function paintUserScore() {
    userId.style.color = "#03A9F4";
}
'use strict';

function restoreView() {
    appData.currentType.position = 0;
    // remove old
    Array.from(keyboardButtons, function (elem) {
        elem.classList.remove('keyboard__btn--active');
        // elem.classList.remove('keyboard__btn--active');
    });
    Array.from(typableChars, function (elem) {
        elem.classList.remove('typable__char--error');
        elem.classList.remove('typable__char--success');
        elem.classList.remove('typable__char--current');
    });
    // default
    typableChars[0].classList.add('typable__char--current');
    // let currentChar = appData.typingText[appData.currentSetting.lang];
    // console.log()
    lightButton(appData.typingText[appData.currentSetting.lang][0]);
    // keyboardButtons[0].classList.add('keyboard__btn--active');
}
"use strict";

/*
  Запонение клавиатруы символами выбранного языка
 */

function setKeyboardLetters(language, buttons) {
    for (var i = 0, limit = buttons.length; i < limit; i = i + 1) {
        buttons[i].textContent = language[i];
    }
}
'use strict';

function setNewPhrase(event) {
    event.preventDefault();
    // console.log('setNewPhrase');
    var lng = 'en';

    Array.from(radioLang, function (elem) {
        if (elem.checked) {
            lng = elem.value;
        }
    });

    appData.typingText[lng] = elemTextArea.value.toLocaleLowerCase();

    hideElem(wrpTextArea);

    /* ================== меняем раскладку клавиатуры ================*/
    setKeyboardLetters(appData.currentSetting.setKeyboard(), keyboardButtons);
    /* =================  добавляет текст в  typable ====================== */
    var text = appData.currentSetting.setTypingText();

    // подсветка текущей буквы
    lightButton(text[0]);

    fillTypableChars(typableChars, text);
    hideTypeElements(typableChars, text);
}
'use strict';

function showElem(elem) {
    elem.style.display = 'block';
}
'use strict';

function showModal() {
    modal.style.transform = 'translateY(-25%)';
    modalP.textContent = 'PRESS BUTTON "START TYPE"';
}
"use strict";

function showTextArea() {
  showElem(wrpTextArea);
}
"use strict";

function showTimer(txt) {
    clock.textContent = txt;
}
'use strict';

function updateListByScore() {
    // console.log('updateListByScore');
    var userListScores = document.querySelectorAll('.user-list__item');
    var tmp = Array.from(userListScores);
    tmp.sort(function (a, b) {
        return b.lastChild.textContent - a.lastChild.textContent;
    });
    Array.from(userListScores, function (elem) {
        return elem.remove();
    });
    tmp.map(function (elem) {
        return userListParent.appendChild(elem);
    });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbEVsZW1lbnRzLmpzIiwiYXBwRGF0YS5qcyIsImFwcFN0YXJ0LmpzIiwidGltZXIuanMiLCJDT05UUk9MTEVSL2FkZExpc3RlbmVycy5qcyIsIkNPTlRST0xMRVIvYWRkVXNlci5qcyIsIkNPTlRST0xMRVIvYmVnaW5UeXBlLmpzIiwiQ09OVFJPTExFUi9jaGVja0tleS5qcyIsIkNPTlRST0xMRVIvcmVtb3ZlTGlzdGVuZXJzLmpzIiwiQ09OVFJPTExFUi9yZXNldEtleWJvYXJkTGV0dGVycy5qcyIsIkNPTlRST0xMRVIvc3RvcFR5cGUuanMiLCJMT0NBTFNUT1JBR0UvbG9hZC5qcyIsIkxPQ0FMU1RPUkFHRS9yZW1vdmUuanMiLCJMT0NBTFNUT1JBR0Uvc2F2ZS5qcyIsIk1PREVML1Jlc3VsdC5qcyIsIk1PREVML1VzZXIuanMiLCJNT0RFTC9Vc2VyUmVzdWx0LmpzIiwiTU9ERUwvYWRkdG9SZXN1bHRzQXJyYXkuanMiLCJNT0RFTC9hcnJheVRvT2JqLmpzIiwiTU9ERUwvZGF0ZUZvcm1hdC5qcyIsIk1PREVML2ZpbHRlclRvcFJlc3VsdC5qcyIsIk1PREVML2dldFNjb3JlLmpzIiwiTU9ERUwvaW5pdC5qcyIsIk1PREVML3NldElkUkVTVEJ5TmFtZS5qcyIsIk1PREVML3NvcnRCeVNjb3JlLmpzIiwiUkVTVC9jcmVhdGVSRVNULmpzIiwiUkVTVC9kZWxldGVSRVNULmpzIiwiUkVTVC9nZXRSRVNUSWRVc2VyLmpzIiwiUkVTVC9yZWFkUkVTVC5qcyIsIlJFU1QvdXBkYXRlUkVTVC5qcyIsIlZJRVcvYWN0aXZlQnRuLmpzIiwiVklFVy9hZGRUb1Njb3JlTGlzdC5qcyIsIlZJRVcvZGVzYWN0aXZlQnRuLmpzIiwiVklFVy9lcnJvclR5cGVTeW1ib2wuanMiLCJWSUVXL2ZpbGxUeXBhYmxlQ2hhcnMuanMiLCJWSUVXL2hpZGVFbGVtLmpzIiwiVklFVy9oaWRlVHlwZUVsZW1lbnRzLmpzIiwiVklFVy9saWdodG5CdXR0b24uanMiLCJWSUVXL25leHRUeXBlU3ltYm9sLmpzIiwiVklFVy9wYWludFVzZXJTY29yZS5qcyIsIlZJRVcvcmVzdG9yZVZpZXcuanMiLCJWSUVXL3NldEtleWJvYXJkTGV0dGVycy5qcyIsIlZJRVcvc2V0TmV3UGhyYXNlLmpzIiwiVklFVy9zaG93RWxlbS5qcyIsIlZJRVcvc2hvd01vZGFsLmpzIiwiVklFVy9zaG93VGV4dEFyZWEuanMiLCJWSUVXL3Nob3dUaW1lci5qcyIsIlZJRVcvdXBkYXRlTGlzdEJ5U2NvcmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FDRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIGtleWJvYXJkXG52YXIga2V5Ym9hcmRCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5rZXlib2FyZF9fYnRuXCIpO1xuXG4vLyBUWVBBQkxFIEFSRUFcbnZhciB0eXBhYmxlQ2hhcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnR5cGFibGVfX2NoYXJcIik7XG5cbi8vIGxhbmcgYnRuXG52YXIgbGFuZ0J0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmxhbmctY3RybHNfX2J0blwiKTtcbnZhciBsYW5ndWFnZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmxhbmctY3RybHNfX2JvZHlcIik7XG5cbi8vIFNUQVJUIFRZUElORyBidG5cbnZhciBiZWdpbkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmVnaW5CdG5cIik7XG5cbi8vIFRFWFQgQVJFQVxuLy8gdGV4dEFyZWEgd3JhcHBlclxudmFyIHdycFRleHRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbnB1dFRleHRcIik7XG4vLyBzaG93IHRleHRBcmVhXG52YXIgYnRuU2hvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYnRuVGV4dEFyZWFcIik7XG4vLyBpbnNlcnQgZnJvbSB0ZXh0QXJlYVxudmFyIGJ0blRleHRBZGRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJ0bkFkZFRleHRcIik7XG4vLyByYWRpb1xudmFyIHJhZGlvTGFuZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWU9XCJsYW5nU2VsZWN0XCJdJyk7XG4vLyB0ZXh0YXJlYVxudmFyIGVsZW1UZXh0QXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ0ZXh0YXJlYVwiKTtcblxuLy8gY2xvY2tcbnZhciBjbG9jayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2xvY2tfX3RpbWVcIik7XG4vLyB0aW1lclxudmFyIHNwZWVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX192YWx1ZS0tc3BlZWRcIik7XG52YXIgZXJyb3JzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX192YWx1ZS0tZXJyb3JzXCIpO1xuXG4vLyBtb2RhbFxudmFyIG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbFwiKTtcbnZhciBtb2RhbFAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsID4gcFwiKTtcblxuLy8gdXNlclxudmFyIHVzZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImlucHV0VXNlcnNOYW1lSURcIik7XG52YXIgc2JtdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3VibWl0VXNlcnNOYW1lSURcIik7XG4vLyB1c2VyLWxpc3Rcbi8vIGNvbnN0IHVzZXJMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi51c2VyLWxpc3RcIik7XG4vLyBsZXQgdXNlckxpc3RTY29yZXM7XG52YXIgdXNlckxpc3RQYXJlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnVzZXItbGlzdFwiKTtcbi8vIGNvbnN0IHVzZXJOYW1lcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudXNlci1saXN0X19uYW1lXCIpO1xudmFyIHNlY3Rpb25Vc2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi51c2VyXCIpO1xudmFyIHVzZXJJZCA9IHZvaWQgMDsgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lkLVVzZXInKTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHBEYXRhID0ge1xuICAgIGN1cnJlbnRTZXR0aW5nOiB7XG4gICAgICAgIGxhbmc6ICdlbicsXG4gICAgICAgIHNldEtleWJvYXJkOiBmdW5jdGlvbiBzZXRLZXlib2FyZCgpIHtcbiAgICAgICAgICAgIHJldHVybiBhcHBEYXRhLmxhbmd1YWdlW2FwcERhdGEuY3VycmVudFNldHRpbmcubGFuZ107XG4gICAgICAgIH0sXG4gICAgICAgIHNldFR5cGluZ1RleHQ6IGZ1bmN0aW9uIHNldFR5cGluZ1RleHQoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBwRGF0YS50eXBpbmdUZXh0W2FwcERhdGEuY3VycmVudFNldHRpbmcubGFuZ107XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGN1cnJlbnRUeXBlOiB7XG4gICAgICAgIHR5cGU6IC0xLFxuICAgICAgICB0ZXh0OiAnJyxcbiAgICAgICAgZXJyb3JzOiAwLFxuICAgICAgICBwb3NpdGlvbjogMFxuICAgIH0sXG4gICAgaW50ZXJ2YWw6IDAsXG4gICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgZW46IFwicXdlcnR5dWlvcFtdYXNkZmdoamtsOyd6eGN2Ym5tLC4vIFwiLFxuICAgICAgICB1YTogXCLQudGG0YPQutC10L3Qs9GI0YnQt9GF0ZfRhNGW0LLQsNC/0YDQvtC70LTQttGU0Y/Rh9GB0LzQuNGC0YzQsdGOLiBcIixcbiAgICAgICAgcnU6IFwi0LnRhtGD0LrQtdC90LPRiNGJ0LfRhdGK0YTRi9Cy0LDQv9GA0L7Qu9C00LbRjdGP0YfRgdC80LjRgtGM0LHRji4gXCJcbiAgICB9LFxuICAgIHJlY29yZHM6IHt9LFxuICAgIHJlc3VsdHM6IFtdLFxuICAgIHRpbWVyQ3VycmVudDogMCxcbiAgICB0eXBpbmdUZXh0OiB7XG4gICAgICAgIGVuOiBcInRoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cuXCIsXG4gICAgICAgIHVhOiBcItGF0LLQsNGG0YzQutC40Lkg0Y7RiNC60L7QstCw0YAg0YTRltC70ZbQvyDRidC+0LTQvdGPINCz0L7RgtGD0ZQg0YHRltC8J9GXINCy0LXRh9C10YDRjiDQtyDQttCw0LEuXCIsXG4gICAgICAgIHJ1OiBcItGB0YrQtdGI0Ywg0LbQtSDQtdGJ0ZEg0Y3RgtC40YUg0LzRj9Cz0LrQuNGFINGE0YDQsNC90YbRg9C30YHQutC40YUg0LHRg9C70L7Quiwg0LTQsCDQstGL0L/QtdC5INGH0LDRji5cIlxuICAgIH0sXG4gICAgdXNlckN1cnJlbnQ6IHtcbiAgICAgICAgaWQ6ICdpZC1Vc2VyJyxcbiAgICAgICAgcmVzdElEOiAtMSxcbiAgICAgICAgbmFtZTogJ1VzZXInLFxuICAgICAgICBzY29yZTogMFxuICAgIH0sXG4gICAgLy8gc2F2ZWRVc2VyXG4gICAgdXNlclNhdmVkOiBmYWxzZSxcbiAgICB1cmw6ICdodHRwOi8vZmVjb3JlLm5ldC51YS9hcGkvJ1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuaW5pdCgpOyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgdGltZXIgPSB7XG4gICAgc3RhcnRUaW1lOiAwLFxuICAgIHN0b3BUaW1lOiAwLFxuICAgIGludGVydmFsOiAwLFxuXG4gICAgc3RhcnQ6IGZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdG1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IHRtcC5nZXRUaW1lKCkgLSB0aW1lci5zdGFydFRpbWUuZ2V0VGltZSgpO1xuICAgICAgICAgICAgdmFyIHNlYyA9IGRhdGVGb3JtYXQoZGVsdGEpO1xuICAgICAgICAgICAgc2hvd1RpbWVyKHNlYyk7XG4gICAgICAgIH0sIDQwKTtcbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHZhciBkZWx0YSA9IHRoaXMuc3RvcFRpbWUuZ2V0VGltZSgpIC0gdGhpcy5zdGFydFRpbWUuZ2V0VGltZSgpO1xuICAgICAgICB2YXIgc2VjID0gZGF0ZUZvcm1hdChkZWx0YSk7XG4gICAgICAgIHNob3dUaW1lcihzZWMpO1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IDA7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmludGVydmFsID0gMDtcbiAgICAgICAgcmV0dXJuIHNlYztcbiAgICB9XG59OyIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gYWRkTGlzdGVuZXJzKCkge1xuXG4gICAgYWN0aXZlQnRuKCk7XG5cbiAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT0g0YHQvNC10L3QsCDRj9C30YvQutCwINGA0LDRgdC60LvQsNC00LrQuCA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgbGFuZ3VhZ2VCdXR0b25zLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVzZXRLZXlib2FyZExldHRlcnMpO1xuXG4gICAgLyogPT09PT09PT09PT09PSDQtNC+0LHQsNCy0LjRgtGMINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgc2JtdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFkZFVzZXIpO1xuXG4gICAgLyogPT09PT09PT09PT09PSDQv9C+0LrQsNC30LDRgtGMINGB0LrRgNGL0YLQvtC1INC+0LrQvdC+INC00LvRjyDQstCy0L7QtNCwINGC0LXQutGB0YLQsCA9PT09PT09PT09PT09ICovXG4gICAgYnRuU2hvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNob3dUZXh0QXJlYSk7XG5cbiAgICAvKiA9PT09PT09PT09PT09INC00L7QsdCw0LLQuNGC0Ywg0L3QvtCy0YvQuSDRgtC10LrRgdGCID09PT09PT09PT09PT0gKi9cbiAgICBidG5UZXh0QWRkaW5nLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2V0TmV3UGhyYXNlKTtcblxuICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PT0g0L3QsNGH0LjQvdCw0LXQvCDRgdGA0LDQstC90LXQvdC40LUg0LrQu9C40LrQvtCyINC60LvQsNCy0LjRiCDRgSDRgtC10LrRgdGC0L7QvCA9PT09PT09PT09ICovXG4gICAgYmVnaW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBiZWdpblR5cGUpO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gYWRkVXNlcihlKSB7XG4gICAgLy8gVE9ETyDRgdC00LXQu9Cw0YLRjCDQv9GA0L7QstC10YDQutGDINC90LAg0YPQvdC40LrQsNC70YzQvdC+0YHRgtGMINC40LzQtdC90LhcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdmFyIG5hbWUgPSB1c2VyLnZhbHVlO1xuICAgIHNlY3Rpb25Vc2VyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgdXNlcklkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lkLVVzZXInKTtcbiAgICB1c2VySWQudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHBhaW50VXNlclNjb3JlKCk7XG4gICAgYXBwRGF0YS51c2VyQ3VycmVudC5uYW1lID0gbmFtZTtcbiAgICBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlID0gdXNlcklkLm5leHRTaWJsaW5nLnRleHRDb250ZW50O1xuICAgIGNyZWF0ZVJFU1QoYXBwRGF0YS51c2VyQ3VycmVudCk7XG4gICAgc2F2ZSgndGhpc1VzZXInLCBhcHBEYXRhLnVzZXJDdXJyZW50KTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGJlZ2luVHlwZSgpIHtcbiAgICAvLyBiZWdpblR5cGUgKCkgZmxhZyA9IHRydWUgIC0+IHN0b3BUeXBlKCkgZmxhZyA9IGZhbHNlXG4gICAgLy8gYXBwRGF0YS5jdXJyZW50VHlwZS50eXBpbmcgPSB0cnVlO1xuXG4gICAgLy8gYmVnaW5UeXBlKCkgYWRkIGxpc3RlbmVyIC0+IHN0b3BUeXBlKCkgcmVtb3ZlIGxpc3RlbmVyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBjaGVja0tleSk7XG5cbiAgICAvL1xuICAgIHJlbW92ZUxpc3RlbmVycygpO1xuXG4gICAgLy8gYmVnaW5UeXBlICgpIGFwcERhdGEudGltZXIuc3RhcnQgLT4gc3RvcFR5cGUoKSBhcHBEYXRhLnRpbWVyLnN0b3BcbiAgICAvLyBhcHBEYXRhLnRpbWVyLnN0YXJ0ID0gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpO1xuICAgIC8vIGNvbnNvbGUubG9nKGFwcERhdGEudGltZXIuc3RhcnQpO1xuXG5cbiAgICAvLyBhcnJheSDQuNC3INGB0YLRgNC+0LrQuCDQtNC70Y8g0L/RgNC+0LLQtdGA0LrQuCAtIHBvcCgpXG4gICAgdmFyIHRtcCA9IGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0VHlwaW5nVGV4dCgpO1xuICAgIGFwcERhdGEuY3VycmVudFR5cGUudGV4dCA9IHRtcC5zcGxpdCgnJykucmV2ZXJzZSgpO1xuICAgIC8vIGNvbnNvbGUubG9nKGFwcERhdGEuY3VycmVudFR5cGUudGV4dCk7XG5cbiAgICAvL3RpbWVyXG4gICAgdGltZXIuc3RhcnQoKTtcblxuICAgIC8vIEVycm9ycyAtINC/0L7QutCw0LfQsNGC0Ywg0YLQtdC60YPRidC10LUg0YHQvtGB0YLQvtGP0L3QuNC1XG4gICAgZXJyb3JzLnRleHRDb250ZW50ID0gYXBwRGF0YS5jdXJyZW50VHlwZS5lcnJvcnM7XG5cbiAgICBtb2RhbC5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgtMTEwJSknO1xuICAgIG1vZGFsUC50ZXh0Q29udGVudCA9ICcnO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gY2hlY2tLZXkoZXZlbnQpIHtcbiAgICAvLyBldmVudC5rZXlcblxuICAgIHZhciBsZW5ndGggPSBhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQubGVuZ3RoO1xuXG4gICAgaWYgKGxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0KTtcbiAgICAgICAgaWYgKGFwcERhdGEuY3VycmVudFR5cGUudGV4dFtsZW5ndGggLSAxXSA9PT0gZXZlbnQua2V5KSB7XG4gICAgICAgICAgICBuZXh0VHlwZVN5bWJvbCgpO1xuICAgICAgICAgICAgYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0LnBvcCgpO1xuICAgICAgICAgICAgdmFyIGxhc3QgPSBhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2codG1wKTtcbiAgICAgICAgICAgIGxpZ2h0QnV0dG9uKGFwcERhdGEuY3VycmVudFR5cGUudGV4dFtsYXN0IC0gMV0pO1xuICAgICAgICAgICAgaWYgKGxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHN0b3BUeXBlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICArK2FwcERhdGEuY3VycmVudFR5cGUuZXJyb3JzO1xuICAgICAgICAgICAgZXJyb3JUeXBlU3ltYm9sKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuICdFcnJvcjogYXBwRGF0YS5jdXJyZW50VHlwZS50ZXh0Lmxlbmd0aCA9ICcgKyBhcHBEYXRhLmN1cnJlbnRUeXBlLnRleHQubGVuZ3RoO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gcmVtb3ZlTGlzdGVuZXJzKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCdyZW1vdmUgbGlzdGVuZXJzJyk7XG5cbiAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT0g0YHQvNC10L3QsCDRj9C30YvQutCwINGA0LDRgdC60LvQsNC00LrQuCA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgbGFuZ3VhZ2VCdXR0b25zLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVzZXRLZXlib2FyZExldHRlcnMpO1xuXG4gICAgLyogPT09PT09PT09PT09PSDQtNC+0LHQsNCy0LjRgtGMINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyA9PT09PT09PT09PT09PT09PT09PT09ICovXG4gICAgc2JtdC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGFkZFVzZXIpO1xuXG4gICAgLyogPT09PT09PT09PT09PSDQv9C+0LrQsNC30LDRgtGMINGB0LrRgNGL0YLQvtC1INC+0LrQvdC+INC00LvRjyDQstCy0L7QtNCwINGC0LXQutGB0YLQsCA9PT09PT09PT09PT09ICovXG4gICAgYnRuU2hvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHNob3dUZXh0QXJlYSk7XG5cbiAgICAvKiA9PT09PT09PT09PT09INC00L7QsdCw0LLQuNGC0Ywg0L3QvtCy0YvQuSDRgtC10LrRgdGCID09PT09PT09PT09PT0gKi9cbiAgICBidG5UZXh0QWRkaW5nLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2V0TmV3UGhyYXNlKTtcblxuICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PT0g0L3QsNGH0LjQvdCw0LXQvCDRgdGA0LDQstC90LXQvdC40LUg0LrQu9C40LrQvtCyINC60LvQsNCy0LjRiCDRgSDRgtC10LrRgdGC0L7QvCA9PT09PT09PT09ICovXG4gICAgYmVnaW5CdXR0b24ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBiZWdpblR5cGUpO1xuXG4gICAgZGVzYWN0aXZlQnRuKCk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiByZXNldEtleWJvYXJkTGV0dGVycyhlKSB7XG4gICAgYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nID0gZS50YXJnZXQudGV4dENvbnRlbnQ7XG4gICAgc2V0S2V5Ym9hcmRMZXR0ZXJzKGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0S2V5Ym9hcmQoKSwga2V5Ym9hcmRCdXR0b25zKTtcbiAgICBBcnJheS5mcm9tKGxhbmdCdG5zLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdsYW5nLWN0cmxzX19idG4tLWFjdGl2ZScpO1xuICAgIH0pO1xuICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2xhbmctY3RybHNfX2J0bi0tYWN0aXZlJyk7XG4gICAgZmlsbFR5cGFibGVDaGFycyh0eXBhYmxlQ2hhcnMsIGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0VHlwaW5nVGV4dCgpKTtcbiAgICBoaWRlVHlwZUVsZW1lbnRzKHR5cGFibGVDaGFycywgYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCkpO1xuICAgIC8vIGNsZWFyKCk7XG5cbiAgICB2YXIgdGV4dCA9IGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0VHlwaW5nVGV4dCgpO1xuICAgIC8vINC/0L7QtNGB0LLQtdGC0LrQsCDRgtC10LrRg9GJ0LXQuSDQsdGD0LrQstGLXG4gICAgLy8gY29uc29sZS5sb2codGV4dCk7XG4gICAgbGlnaHRCdXR0b24odGV4dFswXSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBzdG9wVHlwZSgpIHtcblxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgY2hlY2tLZXkpO1xuXG4gICAgYWRkTGlzdGVuZXJzKCk7XG5cbiAgICAvL3RpbWVyXG4gICAgdmFyIHJlc3VsdFRpbWUgPSB0aW1lci5zdG9wKCkuc3BsaXQoJzonKTtcbiAgICBhcHBEYXRhLnRpbWVyQ3VycmVudCA9ICtyZXN1bHRUaW1lWzBdICsgK3Jlc3VsdFRpbWVbMV0gLyAxMDAwO1xuXG4gICAgLy8g0KDQsNGB0YfQuNGC0LDRgtGMIFNjb3JlICDQuCDQv9C+0LrQsNC30LDRgtGMINC90LAg0YHRgtGA0LDQvdC40YbQtSxcbiAgICB2YXIgY3VycmVudFRleHRMZW5ndGggPSBhcHBEYXRhLnR5cGluZ1RleHRbYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nXS5sZW5ndGg7XG4gICAgdmFyIGN1cnJlbnRTY29yZSA9IGdldFNjb3JlKGFwcERhdGEudGltZXJDdXJyZW50LCBjdXJyZW50VGV4dExlbmd0aCk7XG4gICAgc3BlZWQudGV4dENvbnRlbnQgPSBjdXJyZW50U2NvcmU7XG5cbiAgICAvLyDRgdGA0LDQstC90LjRgtGMIFNjb3JlLCDQv9C10YDQtdC30LDQv9C40YHQsNGC0Ywg0YDQtdC30YPQu9GM0YLQsNGC0YtcbiAgICBpZiAoYXBwRGF0YS5jdXJyZW50VHlwZS5lcnJvcnMgPT09IDApIHtcbiAgICAgICAgLy8gdXNlclNjb3JlLnNjb3JlID0gc2NyID4gdXNlclNjb3JlLnNjb3JlID8gc2NyIDogdXNlclNjb3JlLnNjb3JlO1xuICAgICAgICBpZiAoY3VycmVudFNjb3JlID4gYXBwRGF0YS51c2VyQ3VycmVudC5zY29yZSkge1xuICAgICAgICAgICAgYXBwRGF0YS51c2VyQ3VycmVudC5zY29yZSA9IGN1cnJlbnRTY29yZTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGAke2N1cnJlbnRTY29yZX1gKTtcbiAgICAgICAgICAgIGdldFJFU1RJZFVzZXIoKTtcbiAgICAgICAgICAgIHNhdmUoJ3RoaXNVc2VyJywgYXBwRGF0YS51c2VyQ3VycmVudCk7XG4gICAgICAgICAgICB1cGRhdGVSRVNUKGFwcERhdGEudXNlckN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIHVzZXJJZC5uZXh0U2libGluZy50ZXh0Q29udGVudCA9IGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmU7XG4gICAgICAgIC8vINC/0YDQvtC50YLQuNGB0Ywg0L/QviDRgdC/0LjRgdC60YMg0L/RgNC+0LLQtdGA0LjRgtGMIHNjb3JlICwg0L/QtdGA0LXQvNC10YHRgtC40YLRjFxuICAgICAgICB1cGRhdGVMaXN0QnlTY29yZSgpO1xuICAgIH1cblxuICAgIC8vINCc0L7QtNCw0LvRjNC90L7QtSDQvtC60L3QviDQv9GA0Lgg0LfQsNCy0LXRgNGI0LXQvdC40LhcbiAgICBtb2RhbC5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgtMjUlKSc7XG4gICAgbW9kYWxQLnRleHRDb250ZW50ID0gJ0Zpbic7XG5cbiAgICAvLyDQn9C+0LrQsNC30LDRgtGMIEVycm9ycyDQvdCwINGB0YLRgNCw0L3QuNGG0LUg0Lgg0L7QsdC90YPQu9C40YLRjFxuICAgIGFwcERhdGEuY3VycmVudFR5cGUuZXJyb3JzID0gMDtcblxuICAgIHJlc3RvcmVWaWV3KCk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIGtleSA9ICAndGhpc1VzZXInXG5cbmZ1bmN0aW9uIGxvYWQoa2V5KSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIGtleSA9ICAndGhpc1VzZXInXG5cbmZ1bmN0aW9uIHJlbW92ZShrZXkpIHtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgIC8vIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0aGlzVXNlcicpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG4vLyBrZXkgPSAgJ3RoaXNVc2VyJ1xuXG5mdW5jdGlvbiBzYXZlKGtleSwgb2JqKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShvYmopKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gUmVzdWx0KCkge1xuICAgIHRoaXMudGltZSA9IDA7XG4gICAgdGhpcy5lcnIgPSAwO1xuICAgIHRoaXMuZXJyb3JzTGV0dGVycyA9IFtdO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gVXNlcigpIHtcbiAgICB2YXIgbmFtZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJ1VzZXInO1xuICAgIHZhciBzcGVlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMDtcblxuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zcGVlZCA9IHNwZWVkO1xuICAgIHRoaXMucmVzdWx0ID0gbmV3IFJlc3VsdCgpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBVc2VyUmVzdWx0KG5hbWUsIHNjb3JlKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnNjb3JlID0gc2NvcmU7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGFkZHRvUmVzdWx0c0FycmF5KGFycmF5LCBvYmplY3QpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7XG4gICAgICAgIGlmIChvYmplY3QuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgYXJyYXkucHVzaChuZXcgVXNlclJlc3VsdChrZXksIG9iamVjdFtrZXldKSk7XG4gICAgICAgIH1cbiAgICB9XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGFycmF5VG9PYmooYXJyKSB7XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgIGFyci5tYXAoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgcmV0dXJuIG9ialtlbGVtW1wibmFtZVwiXV0gPSBlbGVtW1wic2NvcmVcIl07XG4gICAgfSk7XG4gICAgcmV0dXJuIG9iajtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGRhdGVGb3JtYXQoZGlnaXRzKSB7XG4gICAgdmFyIG1zYyA9IHZvaWQgMCxcbiAgICAgICAgc2VjID0gdm9pZCAwLFxuICAgICAgICBtaW4gPSB2b2lkIDAsXG4gICAgICAgIGhvdXIgPSB2b2lkIDA7XG5cbiAgICBtc2MgPSBNYXRoLmZsb29yKGRpZ2l0cyAlIDEwMDApO1xuICAgIGlmIChtc2MgPiA5OSkge1xuICAgICAgICBtc2MgPSAnOicgKyBtc2M7XG4gICAgfSBlbHNlIGlmIChtc2MgPiA5KSB7XG4gICAgICAgIG1zYyA9ICc6JyArICcwJyArIG1zYztcbiAgICB9IGVsc2Uge1xuICAgICAgICBtc2MgPSAnOicgKyAnMDAnICsgbXNjO1xuICAgIH1cblxuICAgIHNlYyA9IE1hdGguZmxvb3IoZGlnaXRzIC8gMTAwMCAlIDYwKTtcbiAgICBpZiAoc2VjID4gOSkge1xuICAgICAgICBzZWMgPSBzZWM7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2VjID0gJzAnICsgc2VjO1xuICAgIH1cblxuICAgIHJldHVybiBzZWMgKyBtc2M7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGZpbHRlclRvcFJlc3VsdChhcnIpIHtcbiAgICB2YXIgdG1wID0gW107XG4gICAgaWYgKGFyci5sZW5ndGggPiAxMCkge1xuICAgICAgICB0bXAgPSBhcnIuc2xpY2UoMCwgOSk7XG4gICAgICAgIHJldHVybiB0bXA7XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGdldFNjb3JlKHNlYywgdGV4dExlbmd0aCkge1xuICAgIHJldHVybiBNYXRoLnJvdW5kKDYwICogdGV4dExlbmd0aCAvIHNlYyk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBpbml0KCkge1xuICAgIGFkZExpc3RlbmVycygpO1xuICAgIHNob3dNb2RhbCgpO1xuICAgIC8qXG4gICAg0LfQsNC00LDQtdC8INC00LXRhNC+0LvRgtC90YvQtSDQt9C90LDRh9C10L3QuNGPINC60LvQsNCy0LjQsNGC0YPRgNC1XG4gICAgICovXG4gICAgc2V0S2V5Ym9hcmRMZXR0ZXJzKGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0S2V5Ym9hcmQoKSwga2V5Ym9hcmRCdXR0b25zKTtcblxuICAgIC8qXG4gICAgICDQtNC+0LHQsNCy0LvRj9C10YIg0YLQtdC60YHRgiDQsiAgdHlwYWJsZVxuICAgICovXG4gICAgZmlsbFR5cGFibGVDaGFycyh0eXBhYmxlQ2hhcnMsIGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0VHlwaW5nVGV4dCgpKTtcbiAgICBoaWRlVHlwZUVsZW1lbnRzKHR5cGFibGVDaGFycywgYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCkpO1xuICAgIC8vIGNvbnNvbGUubG9nKCcxICcgKyBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlICk7XG5cbiAgICAvLyDQv9C+0LTRgdCy0LXRgtC60LAg0YLQtdC60YPRidC10Lkg0LHRg9C60LLRi1xuICAgIGxpZ2h0QnV0dG9uKGFwcERhdGEudHlwaW5nVGV4dFthcHBEYXRhLmN1cnJlbnRTZXR0aW5nLmxhbmddWzBdKTtcblxuICAgIC8vIGxvY2FsIHN0b3JhZ2VcbiAgICBhcHBEYXRhLnVzZXJTYXZlZCA9IGxvYWQoJ3RoaXNVc2VyJyk7XG5cbiAgICBpZiAoYXBwRGF0YS51c2VyU2F2ZWQpIHtcbiAgICAgICAgYXBwRGF0YS51c2VyQ3VycmVudC5pZCA9IGFwcERhdGEudXNlclNhdmVkLmlkO1xuICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50Lm5hbWUgPSBhcHBEYXRhLnVzZXJTYXZlZC5uYW1lO1xuICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlID0gYXBwRGF0YS51c2VyU2F2ZWQuc2NvcmU7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCcyICcgKyBhcHBEYXRhLnVzZXJDdXJyZW50LnNjb3JlICk7XG4gICAgICAgIGFwcERhdGEudXNlckN1cnJlbnQucmVzdElEID0gYXBwRGF0YS51c2VyU2F2ZWQucmVzdElEO1xuICAgICAgICBhcHBEYXRhLnJlY29yZHNbYXBwRGF0YS51c2VyQ3VycmVudC5uYW1lXSA9IGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmU7XG4gICAgICAgIHNibXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhZGRVc2VyKTtcbiAgICAgICAgaGlkZUVsZW0oc2VjdGlvblVzZXIpO1xuICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50LmlkID0gJ2lkLScgKyBhcHBEYXRhLnVzZXJDdXJyZW50Lm5hbWU7XG4gICAgICAgIGdldFJFU1RJZFVzZXIoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnMyAnICsgYXBwRGF0YS51c2VyQ3VycmVudC5zY29yZSApO1xuICAgICAgICBhcHBEYXRhLnJlY29yZHNbYXBwRGF0YS51c2VyQ3VycmVudC5uYW1lXSA9IGFwcERhdGEudXNlckN1cnJlbnQuc2NvcmU7XG4gICAgfVxuXG4gICAgcmVhZFJFU1QoKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gc2V0SWRSRVNUQnlOYW1lKGFycikge1xuICAgIGFyci5tYXAoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgaWYgKGVsZW0ubmFtZSA9PT0gYXBwRGF0YS51c2VyQ3VycmVudC5uYW1lKSB7XG4gICAgICAgICAgICBhcHBEYXRhLnVzZXJDdXJyZW50LnJlc3RJRCA9IGVsZW1bXCJpZFwiXTtcbiAgICAgICAgfVxuICAgIH0pO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBzb3J0QnlTY29yZShhcnIpIHtcbiAgICBhcnIuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBjcmVhdGVSRVNUKG9iaikge1xuICAgIHZhciBjcmVhdGVVcmwgPSBhcHBEYXRhLnVybCArICc/YWN0aW9uPTEmbmFtZT0nICsgb2JqLm5hbWUgKyAnJnNjb3JlPScgKyBvYmouc2NvcmU7XG4gICAgY29uc29sZS5sb2coY3JlYXRlVXJsKTtcblxuICAgIGZldGNoKGNyZWF0ZVVybCwge1xuICAgICAgICBtZXRvZDogXCJwb3N0XCIsXG4gICAgICAgIG1vZGU6ICdjb3JzJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJ1xuICAgICAgICB9XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDcmVhdGVSRVNUOiBGZXRjaCBFcnJvciA6LVMnLCBlcnJvcik7XG4gICAgfSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGRlbGV0ZVJFU1Qob2JqKSB7XG4gICAgdmFyIHVwZGF0ZVVybCA9IGFwcERhdGEudXJsICsgXCI/YWN0aW9uPTMkaWQ9XCIgKyBvYmoucmVzdElEO1xuXG4gICAgLy8gaHR0cDovL2ZlY29yZS5uZXQudWEvcmVzdC8/YWN0aW9uPTMmaWQ9NjNcblxuICAgIGZldGNoKHVwZGF0ZVVybCwge1xuICAgICAgICBtZXRvZDogXCJwb3N0XCJcbiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZVJFU1Q6IEZldGNoIEVycm9yIDogJywgZXJyb3IpO1xuICAgIH0pO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gZ2V0UkVTVElkVXNlcigpIHtcbiAgICBmZXRjaChhcHBEYXRhLnVybCwge1xuICAgICAgICBtZXRvZDogXCJnZXRcIixcbiAgICAgICAgbW9kZTogJ2NvcnMnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonXG4gICAgICAgIH1cbiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB2YXIganNvbiA9IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA+PSAyMDAgJiYgcmVzcG9uc2Uuc3RhdHVzIDwgMzAwKSB7XG4gICAgICAgICAgICByZXR1cm4ganNvbjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvcjtcbiAgICAgICAgfVxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgc2V0SWRSRVNUQnlOYW1lKGpzb24pO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2ggRXJyb3IgOi1TJywgZXJyb3IpO1xuICAgIH0pO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gcmVhZFJFU1QoKSB7XG4gICAgZmV0Y2goYXBwRGF0YS51cmwsIHtcbiAgICAgICAgbWV0b2Q6IFwiZ2V0XCIsXG4gICAgICAgIG1vZGU6ICdjb3JzJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJ1xuICAgICAgICB9XG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIGpzb24gPSByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDMwMCkge1xuICAgICAgICAgICAgcmV0dXJuIGpzb247XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3I7XG4gICAgICAgIH1cbiAgICB9KS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgIHZhciB0bXAgPSBhcnJheVRvT2JqKGpzb24pO1xuICAgICAgICAvLyDQtdGB0LvQuCDRgdC/0LjRgdC+0Log0LHQvtC70YzRiNC1IDEwLCDRgtC+INGB0L7RhdGA0LDQvdC40LwgdXNlclJlY1xuICAgICAgICB2YXIgdXNlclJlYyA9IGFwcERhdGEucmVjb3JkcztcbiAgICAgICAgYXBwRGF0YS5yZWNvcmRzID0gT2JqZWN0LmFzc2lnbihhcHBEYXRhLnJlY29yZHMsIHRtcCk7XG5cbiAgICAgICAgYWRkdG9SZXN1bHRzQXJyYXkoYXBwRGF0YS5yZXN1bHRzLCBhcHBEYXRhLnJlY29yZHMpO1xuICAgICAgICBzb3J0QnlTY29yZShhcHBEYXRhLnJlc3VsdHMpO1xuICAgICAgICAvLyDQv9C+0LvRg9GH0LjRgtGMINGB0L/QuNGB0L7QuiDQvNCw0LrRgdC40LzRg9C8INC40LcgMTAt0YLQuCDRgtC+0L8g0YDQtdC30YPQu9GM0YLQsNGC0L7QslxuICAgICAgICBmaWx0ZXJUb3BSZXN1bHQoYXBwRGF0YS5yZXN1bHRzKTtcblxuICAgICAgICBhcHBEYXRhLnJlY29yZHMgPSBPYmplY3QuYXNzaWduKGFwcERhdGEucmVjb3JkcywgdXNlclJlYyk7XG4gICAgICAgIHNvcnRCeVNjb3JlKGFwcERhdGEucmVzdWx0cyk7XG5cbiAgICAgICAgYXBwRGF0YS5yZXN1bHRzLm1hcChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGFkZFRvU2NvcmVMaXN0KGVsZW0ubmFtZSwgZWxlbS5zY29yZSwgdXNlckxpc3RQYXJlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ2FwcERhdGEudXNlckN1cnJlbnQuaWQgPSAnLCBhcHBEYXRhLnVzZXJDdXJyZW50LmlkKTtcbiAgICAgICAgdXNlcklkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYXBwRGF0YS51c2VyQ3VycmVudC5pZCk7XG4gICAgICAgIHBhaW50VXNlclNjb3JlKCk7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBFcnJvciA6LVMnLCBlcnJvcik7XG4gICAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiB1cGRhdGVSRVNUKG9iaikge1xuXG4gICAgdmFyIHVwZGF0ZVVybCA9IGFwcERhdGEudXJsICsgJz9hY3Rpb249MiZpZD0nICsgb2JqLnJlc3RJRCArICcmbmFtZT0nICsgb2JqLm5hbWUgKyAnJnNjb3JlPScgKyBvYmouc2NvcmU7XG4gICAgY29uc29sZS5sb2codXBkYXRlVXJsKTtcbiAgICBmZXRjaCh1cGRhdGVVcmwsIHtcbiAgICAgICAgbWV0b2Q6IFwicG9zdFwiLFxuICAgICAgICBtb2RlOiAnY29ycycsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKidcbiAgICAgICAgfVxuXG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVSRVNUOiBGZXRjaCBFcnJvciA6ICcsIGVycm9yKTtcbiAgICB9KTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gYWN0aXZlQnRuKCkge1xuICAgIGxhbmd1YWdlQnV0dG9ucy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICBzYm10LnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgIGJ0blNob3cuc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgYnRuVGV4dEFkZGluZy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICBiZWdpbkJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gMTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbi8vIGFkZFRvTGlzdFxuZnVuY3Rpb24gYWRkVG9TY29yZUxpc3QobmFtZSwgc2NvcmUsIHBhcmVudCkge1xuICAgIHZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgdmFyIHBOYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIHZhciBwU2NvcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbGkuY2xhc3NOYW1lID0gJ3VzZXItbGlzdF9faXRlbSc7XG4gICAgcE5hbWUuY2xhc3NOYW1lID0gJ3VzZXItbGlzdF9fbmFtZSc7XG4gICAgcE5hbWUuaWQgPSAnaWQtJyArIG5hbWU7XG4gICAgcFNjb3JlLmNsYXNzTmFtZSA9ICd1c2VyLWxpc3RfX3Njb3JlJztcbiAgICBwTmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgcFNjb3JlLnRleHRDb250ZW50ID0gc2NvcmU7XG4gICAgbGkuYXBwZW5kQ2hpbGQocE5hbWUpO1xuICAgIGxpLmFwcGVuZENoaWxkKHBTY29yZSk7XG4gICAgcGFyZW50LmFwcGVuZENoaWxkKGxpKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gZGVzYWN0aXZlQnRuKCkge1xuICAgIGxhbmd1YWdlQnV0dG9ucy5zdHlsZS5vcGFjaXR5ID0gMC41O1xuICAgIHNibXQuc3R5bGUub3BhY2l0eSA9IDAuNTtcbiAgICBidG5TaG93LnN0eWxlLm9wYWNpdHkgPSAwLjU7XG4gICAgYnRuVGV4dEFkZGluZy5zdHlsZS5vcGFjaXR5ID0gMC41O1xuICAgIGJlZ2luQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAwLjU7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBlcnJvclR5cGVTeW1ib2woKSB7XG4gICAgdHlwYWJsZUNoYXJzW2FwcERhdGEuY3VycmVudFR5cGUucG9zaXRpb25dLmNsYXNzTGlzdC5hZGQoJ3R5cGFibGVfX2NoYXItLWVycm9yJyk7XG4gICAgZXJyb3JzLnRleHRDb250ZW50ID0gYXBwRGF0YS5jdXJyZW50VHlwZS5lcnJvcnM7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qXG4g0JfQsNC/0L7Qu9C90LXQvdC40LUgVFlQQUJMRSBBUkVBINGC0LXQutGB0YLQvtC8INC00LvRjyDQvdCw0LHQvtGA0LBcbiAqL1xuZnVuY3Rpb24gZmlsbFR5cGFibGVDaGFycyhhcnIsIHN0cikge1xuICBBcnJheS5mcm9tKGFyciwgZnVuY3Rpb24gKGVsZW0sIGkpIHtcbiAgICByZXR1cm4gZWxlbS50ZXh0Q29udGVudCA9IHN0cltpXTtcbiAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG4vKlxuICAgaGlkZVRleHRBcmVhLCBtb2RhbFxuICovXG5mdW5jdGlvbiBoaWRlRWxlbShlbGVtKSB7XG4gICAgZWxlbS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xufSIsIid1c2Ugc3RyaWN0JztcblxuLypcbiAg0KHQutGA0YvRgtC40LUg0Y3Qu9C10LzQtdC90YLQvtCyINCx0LXQtyDRgtC10LrRgdGC0LBcbiAqL1xuXG5mdW5jdGlvbiBoaWRlVHlwZUVsZW1lbnRzKGFyciwgc3RyKSB7XG4gICAgQXJyYXkuZnJvbShhcnIsIGZ1bmN0aW9uIChlbGVtLCBpKSB7XG4gICAgICAgIGlmIChpIDwgc3RyLmxlbmd0aCkge1xuICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgICAgICBlbGVtLnRleHRDb250ZW50ID0gc3RyW2ldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbS5jbGFzc0xpc3RhZGQgPSAnaGlkZSc7XG4gICAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG4vKlxuICAg0J/QvtC00YHQstC10YLQutCwINC60LvQsNCy0LjQsNGC0YPRgNGLOiDQutC70LDQstC40YjQsCwg0LrQvtGC0L7RgNGD0Y4g0YHQu9C10LTRg9C10YIg0L3QsNC20LDRgtGMLlxuICovXG5cbmZ1bmN0aW9uIGxpZ2h0QnV0dG9uKGNoYXJUZXh0KSB7XG4gICAgQXJyYXkuZnJvbShrZXlib2FyZEJ1dHRvbnMsIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGlmIChlbGVtLmNsYXNzTGlzdC5jb250YWlucygna2V5Ym9hcmRfX2J0bi0tYWN0aXZlJykpIHtcbiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgna2V5Ym9hcmRfX2J0bi0tYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW0udGV4dENvbnRlbnQgPT09IGNoYXJUZXh0KSB7XG4gICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2tleWJvYXJkX19idG4tLWFjdGl2ZScpO1xuICAgICAgICB9XG4gICAgfSk7XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBuZXh0VHlwZVN5bWJvbCgpIHtcbiAgICAvLyDQvtCx0LvQsNGB0YLRjCDQvdCw0LHQvtGA0LBcbiAgICAvLyBjb25zb2xlLmxvZyh0eXBhYmxlQ2hhcnNbYXBwRGF0YS5jdXJyZW50VHlwZS5wb3NpdGlvbl0udGV4dENvbnRlbnQpO1xuICAgIHR5cGFibGVDaGFyc1thcHBEYXRhLmN1cnJlbnRUeXBlLnBvc2l0aW9uXS5jbGFzc0xpc3QuYWRkKCd0eXBhYmxlX19jaGFyLS1zdWNjZXNzJyk7XG4gICAgdHlwYWJsZUNoYXJzW2FwcERhdGEuY3VycmVudFR5cGUucG9zaXRpb25dLmNsYXNzTGlzdC5yZW1vdmUoJ3R5cGFibGVfX2NoYXItLWN1cnJlbnQnKTtcbiAgICB0eXBhYmxlQ2hhcnNbKythcHBEYXRhLmN1cnJlbnRUeXBlLnBvc2l0aW9uXS5jbGFzc0xpc3QuYWRkKCd0eXBhYmxlX19jaGFyLS1jdXJyZW50Jyk7XG5cbiAgICAvLyDQvtCx0LvQsNGB0YLRjCDQutC70LDQstC40LDRgtGD0YDRi1xuXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIHBhaW50VXNlclNjb3JlKCkge1xuICAgIHVzZXJJZC5zdHlsZS5jb2xvciA9IFwiIzAzQTlGNFwiO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gcmVzdG9yZVZpZXcoKSB7XG4gICAgYXBwRGF0YS5jdXJyZW50VHlwZS5wb3NpdGlvbiA9IDA7XG4gICAgLy8gcmVtb3ZlIG9sZFxuICAgIEFycmF5LmZyb20oa2V5Ym9hcmRCdXR0b25zLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2tleWJvYXJkX19idG4tLWFjdGl2ZScpO1xuICAgICAgICAvLyBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2tleWJvYXJkX19idG4tLWFjdGl2ZScpO1xuICAgIH0pO1xuICAgIEFycmF5LmZyb20odHlwYWJsZUNoYXJzLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3R5cGFibGVfX2NoYXItLWVycm9yJyk7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgndHlwYWJsZV9fY2hhci0tc3VjY2VzcycpO1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3R5cGFibGVfX2NoYXItLWN1cnJlbnQnKTtcbiAgICB9KTtcbiAgICAvLyBkZWZhdWx0XG4gICAgdHlwYWJsZUNoYXJzWzBdLmNsYXNzTGlzdC5hZGQoJ3R5cGFibGVfX2NoYXItLWN1cnJlbnQnKTtcbiAgICAvLyBsZXQgY3VycmVudENoYXIgPSBhcHBEYXRhLnR5cGluZ1RleHRbYXBwRGF0YS5jdXJyZW50U2V0dGluZy5sYW5nXTtcbiAgICAvLyBjb25zb2xlLmxvZygpXG4gICAgbGlnaHRCdXR0b24oYXBwRGF0YS50eXBpbmdUZXh0W2FwcERhdGEuY3VycmVudFNldHRpbmcubGFuZ11bMF0pO1xuICAgIC8vIGtleWJvYXJkQnV0dG9uc1swXS5jbGFzc0xpc3QuYWRkKCdrZXlib2FyZF9fYnRuLS1hY3RpdmUnKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuLypcbiAg0JfQsNC/0L7QvdC10L3QuNC1INC60LvQsNCy0LjQsNGC0YDRg9GLINGB0LjQvNCy0L7Qu9Cw0LzQuCDQstGL0LHRgNCw0L3QvdC+0LPQviDRj9C30YvQutCwXG4gKi9cblxuZnVuY3Rpb24gc2V0S2V5Ym9hcmRMZXR0ZXJzKGxhbmd1YWdlLCBidXR0b25zKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxpbWl0ID0gYnV0dG9ucy5sZW5ndGg7IGkgPCBsaW1pdDsgaSA9IGkgKyAxKSB7XG4gICAgICAgIGJ1dHRvbnNbaV0udGV4dENvbnRlbnQgPSBsYW5ndWFnZVtpXTtcbiAgICB9XG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBzZXROZXdQaHJhc2UoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vIGNvbnNvbGUubG9nKCdzZXROZXdQaHJhc2UnKTtcbiAgICB2YXIgbG5nID0gJ2VuJztcblxuICAgIEFycmF5LmZyb20ocmFkaW9MYW5nLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBpZiAoZWxlbS5jaGVja2VkKSB7XG4gICAgICAgICAgICBsbmcgPSBlbGVtLnZhbHVlO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBhcHBEYXRhLnR5cGluZ1RleHRbbG5nXSA9IGVsZW1UZXh0QXJlYS52YWx1ZS50b0xvY2FsZUxvd2VyQ2FzZSgpO1xuXG4gICAgaGlkZUVsZW0od3JwVGV4dEFyZWEpO1xuXG4gICAgLyogPT09PT09PT09PT09PT09PT09INC80LXQvdGP0LXQvCDRgNCw0YHQutC70LDQtNC60YMg0LrQu9Cw0LLQuNCw0YLRg9GA0YsgPT09PT09PT09PT09PT09PSovXG4gICAgc2V0S2V5Ym9hcmRMZXR0ZXJzKGFwcERhdGEuY3VycmVudFNldHRpbmcuc2V0S2V5Ym9hcmQoKSwga2V5Ym9hcmRCdXR0b25zKTtcbiAgICAvKiA9PT09PT09PT09PT09PT09PSAg0LTQvtCx0LDQstC70Y/QtdGCINGC0LXQutGB0YIg0LIgIHR5cGFibGUgPT09PT09PT09PT09PT09PT09PT09PSAqL1xuICAgIHZhciB0ZXh0ID0gYXBwRGF0YS5jdXJyZW50U2V0dGluZy5zZXRUeXBpbmdUZXh0KCk7XG5cbiAgICAvLyDQv9C+0LTRgdCy0LXRgtC60LAg0YLQtdC60YPRidC10Lkg0LHRg9C60LLRi1xuICAgIGxpZ2h0QnV0dG9uKHRleHRbMF0pO1xuXG4gICAgZmlsbFR5cGFibGVDaGFycyh0eXBhYmxlQ2hhcnMsIHRleHQpO1xuICAgIGhpZGVUeXBlRWxlbWVudHModHlwYWJsZUNoYXJzLCB0ZXh0KTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIHNob3dFbGVtKGVsZW0pIHtcbiAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gc2hvd01vZGFsKCkge1xuICAgIG1vZGFsLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKC0yNSUpJztcbiAgICBtb2RhbFAudGV4dENvbnRlbnQgPSAnUFJFU1MgQlVUVE9OIFwiU1RBUlQgVFlQRVwiJztcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gc2hvd1RleHRBcmVhKCkge1xuICBzaG93RWxlbSh3cnBUZXh0QXJlYSk7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIHNob3dUaW1lcih0eHQpIHtcbiAgICBjbG9jay50ZXh0Q29udGVudCA9IHR4dDtcbn0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIHVwZGF0ZUxpc3RCeVNjb3JlKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCd1cGRhdGVMaXN0QnlTY29yZScpO1xuICAgIHZhciB1c2VyTGlzdFNjb3JlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy51c2VyLWxpc3RfX2l0ZW0nKTtcbiAgICB2YXIgdG1wID0gQXJyYXkuZnJvbSh1c2VyTGlzdFNjb3Jlcyk7XG4gICAgdG1wLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIGIubGFzdENoaWxkLnRleHRDb250ZW50IC0gYS5sYXN0Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgfSk7XG4gICAgQXJyYXkuZnJvbSh1c2VyTGlzdFNjb3JlcywgZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgcmV0dXJuIGVsZW0ucmVtb3ZlKCk7XG4gICAgfSk7XG4gICAgdG1wLm1hcChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gdXNlckxpc3RQYXJlbnQuYXBwZW5kQ2hpbGQoZWxlbSk7XG4gICAgfSk7XG59Il19
